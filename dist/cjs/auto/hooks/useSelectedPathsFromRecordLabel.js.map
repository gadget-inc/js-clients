{"version":3,"file":"useSelectedPathsFromRecordLabel.js","sourceRoot":"","sources":["../../../../src/auto/hooks/useSelectedPathsFromRecordLabel.tsx"],"names":[],"mappings":";;;AAAA,iCAAgC;AAChC,8DAMuC;AACvC,2DAAiE;AACjE,+FAIqD;AACrD,+DAA8D;AAEvD,MAAM,+BAA+B,GAAG,CAAC,KAA+D,EAAE,EAAE;IACjH,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,KAAK,CAAC;IACrC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,2CAAqB,EAAC,KAAK,CAAC,CAAC;IAElD,MAAM,aAAa,GAAG,IAAA,eAAO,EAAC,GAAG,EAAE;QACjC,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAA,gCAAmB,EAAC,QAAQ,CAAC,EAAE,CAAC;YAChE,OAAO,EAAE,CAAC;QACZ,CAAC;QACD,MAAM,WAAW,GAAG,QAAQ,CAAC,aAIJ,CAAC;QAE1B,MAAM,aAAa,GAAG,IAAI,GAAG,EAAU,CAAC;QAExC,MAAM,qBAAqB,GACzB,WAAW,CAAC,YAAY,EAAE,MAAM;aAC7B,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAA,gCAAmB,EAAC,KAAK,CAAC,IAAI,KAAK,CAAC,SAAS,KAAK,4BAAe,CAAC,QAAQ,CAAC;aAC9F,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,EAAE,CAAC;QAE/C,IAAA,8DAA8B,EAAC,WAAW,CAAC;aACxC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,IAAA,uCAA+B,EAAC,WAAW,EAAE,GAAG,EAAE,CAAC,qBAAqB,CAAC,CAAC;aACnG,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;QAE9C,OAAO,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACnC,CAAC,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC,CAAC;IAE5B,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,CAAC;AACrC,CAAC,CAAC;AA7BW,QAAA,+BAA+B,mCA6B1C;AAEK,MAAM,+BAA+B,GAAG,CAAC,WAAyB,EAAE,sCAAuD,EAAE,EAAE;IACpI,IAAI,CAAC,WAAW,EAAE,CAAC;QACjB,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,IAAI,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC;QAC/B,OAAO,WAAW,CAAC;IACrB,CAAC;IAED,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE,CAAC;QACpC,OAAO,CAAC,WAAW,CAAC,CAAC;IACvB,CAAC;IAED,yCAAyC;IACzC,OAAO,sCAAsC,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,gCAAgC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,CAAC;AAC/H,CAAC,CAAC;AAfW,QAAA,+BAA+B,mCAe1C;AAEF,MAAM,gCAAgC,GAAG,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC","sourcesContent":["import { useMemo } from \"react\";\nimport {\n  GadgetFieldType,\n  type GadgetBelongsToConfig,\n  type GadgetHasManyConfig,\n  type GadgetHasManyThroughConfig,\n  type GadgetHasOneConfig,\n} from \"../../internal/gql/graphql.js\";\nimport { isRelationshipField } from \"../../use-table/helpers.js\";\nimport {\n  getOptionLabelsFromRecordLabel,\n  type AutoRelationshipFormProps,\n  type OptionLabel,\n} from \"../interfaces/AutoRelationshipInputProps.js\";\nimport { useMaybeFieldMetadata } from \"./useFieldMetadata.js\";\n\nexport const useSelectedPathsFromRecordLabel = (props: Pick<AutoRelationshipFormProps, \"field\" | \"recordLabel\">) => {\n  const { field, recordLabel } = props;\n  const { metadata } = useMaybeFieldMetadata(field);\n\n  const selectedPaths = useMemo(() => {\n    if (!recordLabel || !metadata || !isRelationshipField(metadata)) {\n      return [];\n    }\n    const fieldConfig = metadata.configuration as\n      | GadgetHasManyConfig\n      | GadgetHasManyThroughConfig\n      | GadgetHasOneConfig\n      | GadgetBelongsToConfig;\n\n    const selectedPaths = new Set<string>();\n\n    const defaultFieldsToSelect =\n      fieldConfig.relatedModel?.fields\n        .filter((field) => !isRelationshipField(field) && field.fieldType !== GadgetFieldType.Password)\n        .map((field) => field.apiIdentifier) ?? [];\n\n    getOptionLabelsFromRecordLabel(recordLabel)\n      .flatMap((optionLabel) => getSelectedPathsFromOptionLabel(optionLabel, () => defaultFieldsToSelect))\n      .forEach((path) => selectedPaths.add(path));\n\n    return Array.from(selectedPaths);\n  }, [recordLabel, metadata]);\n\n  return { selectedPaths, metadata };\n};\n\nexport const getSelectedPathsFromOptionLabel = (optionLabel?: OptionLabel, getFieldsToSelectOnRecordLabelCallback?: () => string[]) => {\n  if (!optionLabel) {\n    return [];\n  }\n\n  if (Array.isArray(optionLabel)) {\n    return optionLabel;\n  }\n\n  if (typeof optionLabel === \"string\") {\n    return [optionLabel];\n  }\n\n  // Callback instead of explicit selection\n  return getFieldsToSelectOnRecordLabelCallback?.().filter((field) => !recordLabelCallbackOmittedFields.includes(field)) ?? [];\n};\n\nconst recordLabelCallbackOmittedFields = [\"createdAt\", \"updatedAt\"];\n"]}