{"version":3,"file":"AutoForm.js","sourceRoot":"","sources":["../../../src/auto/AutoForm.ts"],"names":[],"mappings":";;;AACA,iDAAsD;AAEtD,iCAAgC;AAIhC,gDAAiD;AAEjD,gEAA0D;AA2B1D;;GAEG;AACI,MAAM,qBAAqB,GAAG,CAAC,QAAoC,EAAE,EAAE;IAC5E,OAAO,IAAA,eAAO,EAAC,GAAG,EAAE;QAClB,IAAI,CAAC,QAAQ;YAAE,OAAO,SAAS,CAAC;QAChC,OAAO,IAAA,iBAAW,EAAC,IAAA,sCAAgB,EAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC;IACpE,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AALW,QAAA,qBAAqB,yBAKhC;AAEF;;GAEG;AACI,MAAM,aAAa,GAAG,CAC3B,QAA2C,EAC3C,OAAoG,EAC9C,EAAE;IACxD,OAAO,IAAA,eAAO,EAAC,GAAG,EAAE;QAClB,IAAI,CAAC,QAAQ;YAAE,OAAO,EAAE,CAAC;QACzB,MAAM,YAAY,GAAG,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,aAAa,CAAC,UAAU,KAAK,yBAAyB,CAAC,CAAC;QACjI,MAAM,eAAe,GAAG,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,aAAa,CAAC,UAAU,KAAK,yBAAyB,CAAC,CAAC;QAEpI,MAAM,uBAAuB,GAAG,IAAA,6BAAe,EAAC,eAAe,EAAE,OAAc,CAAC,CAAC,GAAG,CAClF,CAAC,KAAK,EAAE,EAAE,CACR,CAAC;YACC,IAAI,EAAE,KAAK,CAAC,aAAa;YACzB,QAAQ,EAAE,KAAK;SACN,CAAA,CACd,CAAC;QAEF,MAAM,oBAAoB,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE,CAChE,IAAA,6BAAe,EAAE,WAAW,CAAC,aAAoD,CAAC,MAAa,EAAE,OAAc,CAAC,CAAC,GAAG,CAClH,CAAC,UAAU,EAAE,EAAE,CACb,CAAC;YACC,IAAI,EAAE,GAAG,WAAW,CAAC,aAAa,IAAI,UAAU,CAAC,aAAa,EAAE;YAChE,QAAQ,EAAE,UAAU;SACX,CAAA,CACd,CACF,CAAC;QACF,OAAO,CAAC,GAAG,oBAAoB,EAAE,GAAG,uBAAuB,CAAC,CAAC;IAC/D,CAAC,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,CAAC;AAC1B,CAAC,CAAC;AA5BW,QAAA,aAAa,iBA4BxB","sourcesContent":["import type { ActionFunction, GadgetRecord } from \"@gadgetinc/api-client-core\";\nimport { yupResolver } from \"@hookform/resolvers/yup\";\nimport type { ReactNode } from \"react\";\nimport { useMemo } from \"react\";\nimport type { RecordIdentifier } from \"src/use-action-form/types.js\";\nimport type { GadgetObjectFieldConfig } from \"../internal/gql/graphql.js\";\nimport type { ActionMetadata, FieldMetadata } from \"../metadata.js\";\nimport { filterFieldList } from \"../metadata.js\";\nimport type { OptionsType } from \"../utils.js\";\nimport { validationSchema } from \"../validationSchema.js\";\n\n/** The props that any <AutoForm/> component accepts */\nexport type AutoFormProps<\n  GivenOptions extends OptionsType,\n  SchemaT,\n  ActionFunc extends ActionFunction<GivenOptions, any, any, SchemaT, any>,\n  Options extends ActionFunc[\"optionsType\"]\n> = {\n  /** Which action this fom will run on submit */\n  action: ActionFunc;\n  /** How to find the record this form will act on */\n  findBy?: RecordIdentifier;\n  /** A record for this form to act on */\n  record?: GadgetRecord<any>;\n  /** An allowlist of fields to render within the form. Only these fields will be rendered as inputs. */\n  include?: string[];\n  /** An allowlist of fields to render within the form. Only these fields will be rendered as inputs. */\n  fields?: string[];\n  /** A denylist of fields to render within the form. Every field except these fields will be rendered as inputs. */\n  exclude?: string[];\n  /** The label to use for the submit button at the bottom of the form */\n  submitLabel?: ReactNode;\n  /** What to show the user once the form has been submitted successfully */\n  successContent?: ReactNode;\n};\n\n/**\n * React hook for getting the validation schema for a list of fields\n */\nexport const useValidationResolver = (metadata: ActionMetadata | undefined) => {\n  return useMemo(() => {\n    if (!metadata) return undefined;\n    return yupResolver(validationSchema(metadata.action.inputFields));\n  }, [metadata]);\n};\n\n/**\n * React hook for getting a list of fields to use in a form (given include/exclude options)\n */\nexport const useFormFields = (\n  metadata: ActionMetadata | undefined | null,\n  options: { include?: string[]; exclude?: string[]; fields?: string[]; select?: Record<string, any> }\n): readonly { path: string; metadata: FieldMetadata }[] => {\n  return useMemo(() => {\n    if (!metadata) return [];\n    const objectFields = metadata.action.inputFields.filter((field) => field.configuration.__typename === \"GadgetObjectFieldConfig\");\n    const nonObjectFields = metadata.action.inputFields.filter((field) => field.configuration.__typename !== \"GadgetObjectFieldConfig\");\n\n    const includedRootLevelFields = filterFieldList(nonObjectFields, options as any).map(\n      (field) =>\n        ({\n          path: field.apiIdentifier,\n          metadata: field,\n        } as const)\n    );\n\n    const includedObjectFields = objectFields.flatMap((objectField) =>\n      filterFieldList((objectField.configuration as unknown as GadgetObjectFieldConfig).fields as any, options as any).map(\n        (innerField) =>\n          ({\n            path: `${objectField.apiIdentifier}.${innerField.apiIdentifier}`,\n            metadata: innerField,\n          } as const)\n      )\n    );\n    return [...includedObjectFields, ...includedRootLevelFields];\n  }, [metadata, options]);\n};\n"]}