{"version":3,"file":"PolarisWCAutoRolesInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris-wc/inputs/PolarisWCAutoRolesInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo, useState } from \"react\";\nimport { autoInput } from \"../../AutoInput.js\";\nimport { useRoleInputController } from \"../../hooks/useRoleInputController.js\";\nimport { type AutoRolesInputProps } from \"../../shared/AutoInputTypes.js\";\nimport { PolarisWCDismissibleBadge } from \"../commonComponents/PolarisWCDismissibleBadge.js\";\nimport { PolarisWCTruncatedTextWithTooltip } from \"../commonComponents/PolarisWCTruncatedTextWithTooltip.js\";\nimport { PolarisWCCombobox, PolarisWCComboboxOption } from \"./PolarisWCCombobox.js\";\n\nexport type PolarisWCAutoRolesInputProps = AutoRolesInputProps & {\n  placeholder?: string;\n  disabled?: boolean;\n};\n\n/**\n * A RoleList selector within AutoForm using Polaris Web Components.\n * Uses a searchable combobox for multiple role selection.\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoRolesInput field=\"roles\" />\n * </AutoForm>\n * ```\n * @param props.field - The RoleList field API identifier.\n * @param props.label - Label of the RoleList selector.\n * @returns The AutoRolesInput component\n */\nexport const PolarisWCAutoRolesInput = autoInput((props: PolarisWCAutoRolesInputProps) => {\n  const { disabled, placeholder } = props;\n  const { options, loading, rolesError, fieldError, selectedRoleKeys, fieldProps, metadata } = useRoleInputController(props);\n\n  const [searchValue, setSearchValue] = useState(\"\");\n\n  if (rolesError) {\n    throw rolesError;\n  }\n  if (fieldError) {\n    throw fieldError;\n  }\n\n  const filteredOptions = useMemo(\n    () => (options ?? []).filter((opt) => !searchValue || opt.label.toLocaleLowerCase().includes(searchValue.trim().toLocaleLowerCase())),\n    [options, searchValue]\n  );\n\n  const handleOptionClick = useCallback(\n    (roleKey: string) => {\n      const next = new Set(selectedRoleKeys);\n      if (next.has(roleKey)) {\n        next.delete(roleKey);\n      } else {\n        next.add(roleKey);\n      }\n      fieldProps.onChange([...next]);\n    },\n    [fieldProps.onChange, selectedRoleKeys]\n  );\n\n  const handleDismissBadge = useCallback(\n    (roleKey: string) => {\n      fieldProps.onChange(selectedRoleKeys.filter((k: string) => k !== roleKey));\n    },\n    [fieldProps.onChange, selectedRoleKeys]\n  );\n\n  const verticalContent = useMemo(() => {\n    if (selectedRoleKeys.length === 0) return undefined;\n    const selectedOptions = (options ?? []).filter((o) => selectedRoleKeys.includes(o.value));\n    return (\n      <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: \"4px\", marginTop: \"6px\" }}>\n        {selectedOptions.map((opt) => (\n          <div key={opt.value} style={{ maxWidth: \"128px\" }}>\n            <PolarisWCDismissibleBadge onDismiss={() => handleDismissBadge(opt.value)}>\n              <PolarisWCTruncatedTextWithTooltip text={opt.label} />\n            </PolarisWCDismissibleBadge>\n          </div>\n        ))}\n      </div>\n    );\n  }, [selectedRoleKeys, options, handleDismissBadge]);\n\n  if (loading || !options || options.length === 0) {\n    // Don't render until role options exist. There must always be at least one role option `unauthenticated`\n    return null;\n  }\n\n  const label: string = typeof props.label === \"string\" ? props.label : String(metadata.name ?? \"\");\n\n  return (\n    <>\n      <PolarisWCCombobox\n        label={label}\n        placeholder={placeholder ?? \"Search roles...\"}\n        value={searchValue}\n        onChange={setSearchValue}\n        allowMultiple\n        disabled={disabled}\n        verticalContent={verticalContent}\n      >\n        {filteredOptions.map((opt) => (\n          <PolarisWCComboboxOption\n            key={opt.value}\n            text={opt.label}\n            selected={selectedRoleKeys.includes(opt.value)}\n            multiselect\n            onClick={() => handleOptionClick(opt.value)}\n          />\n        ))}\n        {filteredOptions.length === 0 && <div style={{ padding: \"8px 12px\" }}>No roles found</div>}\n      </PolarisWCCombobox>\n    </>\n  );\n});\n"]}