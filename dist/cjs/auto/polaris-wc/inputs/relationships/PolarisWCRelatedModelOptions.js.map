{"version":3,"file":"PolarisWCRelatedModelOptions.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCRelatedModelOptions.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef } from \"react\";\nimport type { DisplayedRecordOption } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCPopover } from \"../../commonComponents/PolarisWCPopover.js\";\nimport { renderOptionLabel } from \"./utils.js\";\n\ntype RelatedModelOptionsProps = {\n  options: DisplayedRecordOption[];\n  records?: Record<string, any>[];\n  isLoading?: boolean;\n  errorMessage?: string;\n  checkSelected?: (id: string) => boolean;\n  onSelect: (record: Record<string, any>) => void;\n  actions?: React.ReactNode[];\n  renderOption?: (option: DisplayedRecordOption) => React.ReactNode;\n  listboxId?: string;\n  /** When true, shows a checkbox on each option row (e.g. for hasMany / hasManyThrough). */\n  showCheckbox?: boolean;\n  /** Whether more options can be loaded (shows a sentinel element for infinite scroll). */\n  canLoadMore?: boolean;\n  /** Callback fired when the sentinel element at the bottom becomes visible (for infinite scroll). */\n  onLoadMore?: () => void;\n};\n\nconst getErrorMessage = (errorMessage: string) => {\n  if (errorMessage.includes(\"The API key is not valid\")) {\n    return \"Invalid API key. Check the Gadget connection settings in the Provider component.\";\n  }\n  if (errorMessage.includes(\"GGT_INVALID_API_KEY\")) {\n    return \"Invalid API key. Check the Gadget connection settings in the Provider component.\";\n  }\n  return errorMessage;\n};\n\nexport const PolarisWCRelatedModelOptions = (props: RelatedModelOptionsProps) => {\n  const { checkSelected, onSelect, isLoading, errorMessage, options, records, actions, listboxId, showCheckbox } = props;\n\n  const handleClick = useCallback(\n    (id: string) => {\n      const record = records?.find((record) => record.id === id) ?? { id };\n      const { createdAt: _createdAt, updatedAt: _updatedAt, ...recordWithoutTimestamps } = record;\n      onSelect(recordWithoutTimestamps);\n    },\n    [records, onSelect]\n  );\n\n  const loadMoreRef = useRef<HTMLDivElement | null>(null);\n  useDetectScrolledToBottom({ loadMoreRef, onLoadMore: props.onLoadMore });\n\n  if (errorMessage) {\n    return (\n      <div style={{ padding: \"12px\", textAlign: \"center\" }}>\n        <s-text tone=\"critical\">{getErrorMessage(errorMessage)}</s-text>\n      </div>\n    );\n  }\n\n  return (\n    <div id={listboxId} role=\"listbox\">\n      {actions}\n      {options.map((option) => {\n        if (props.renderOption) {\n          return props.renderOption(option);\n        }\n\n        const isSelected = checkSelected?.(option.id) ?? false;\n\n        return (\n          <PolarisWCSelectableOption\n            key={option.id}\n            option={option}\n            selected={isSelected}\n            onClick={() => handleClick(option.id)}\n            showCheckbox={showCheckbox}\n          />\n        );\n      })}\n      {!isLoading && options.length === 0 && (\n        <div style={{ padding: \"12px\", textAlign: \"center\" }}>\n          <s-text>No records found</s-text>\n        </div>\n      )}\n      {isLoading ? (\n        <div style={{ display: \"flex\", justifyContent: \"center\", padding: \"12px\" }}>\n          <s-spinner size=\"base\" />\n        </div>\n      ) : props.canLoadMore ? (\n        <div ref={loadMoreRef} style={{ display: \"flex\", justifyContent: \"center\", padding: \"8px\" }}>\n          <s-spinner size=\"base\" />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nconst selectedBg = \"var(--p-color-bg-surface-selected, #f1f2f4)\";\nconst hoverBg = \"var(--p-color-bg-surface-hover, #f7f7f7)\";\n\nconst PolarisWCSelectableOption = (props: {\n  option: DisplayedRecordOption;\n  selected: boolean;\n  onClick: () => void;\n  showCheckbox?: boolean;\n}) => {\n  const { option, selected, onClick, showCheckbox } = props;\n  const showSelectedBackground = !showCheckbox && selected;\n\n  return (\n    <button\n      type=\"button\"\n      role=\"option\"\n      aria-selected={selected}\n      onClick={onClick}\n      style={{\n        display: \"flex\",\n        width: \"100%\",\n        padding: \"8px 12px\",\n        border: \"none\",\n        background: showSelectedBackground ? selectedBg : \"transparent\",\n        cursor: \"pointer\",\n        textAlign: \"left\",\n        alignItems: \"center\",\n        justifyContent: \"space-between\",\n        gap: \"8px\",\n      }}\n      onMouseEnter={(e) => {\n        if (showCheckbox || !selected) {\n          e.currentTarget.style.background = hoverBg;\n        }\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = showSelectedBackground ? selectedBg : \"transparent\";\n      }}\n    >\n      {showCheckbox && <s-checkbox checked={selected}></s-checkbox>}\n      <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"2px\", minWidth: 0, flex: 1 }}>\n        {renderOptionLabel(option.primary, \"primary\")}\n        {option.secondary && renderOptionLabel(option.secondary, \"secondary\")}\n      </div>\n      {option.tertiary && renderOptionLabel(option.tertiary, \"tertiary\")}\n    </button>\n  );\n};\n\nexport const PolarisWCRelatedModelOptionsPopover = (\n  props: RelatedModelOptionsProps & {\n    active: boolean;\n    activator: React.ReactElement;\n    onClose: () => void;\n    search?: React.ReactNode;\n    onScrolledToBottom?: () => void;\n  }\n) => {\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const { onScrolledToBottom } = props;\n\n  const handleScroll = useCallback(() => {\n    if (!scrollContainerRef.current || !onScrolledToBottom) return;\n\n    const { scrollTop, scrollHeight, clientHeight } = scrollContainerRef.current;\n    const isNearBottom = scrollTop + clientHeight >= scrollHeight - 50;\n\n    if (isNearBottom) {\n      onScrolledToBottom();\n    }\n  }, [onScrolledToBottom]);\n\n  return (\n    <PolarisWCPopover\n      open={props.active}\n      onClose={props.onClose}\n      position=\"below-end\"\n      anchor={props.activator}\n      maxHeight=\"350px\"\n      contentProps={{\n        style: {\n          width: \"310px\",\n          padding: 0,\n          overflow: \"hidden\",\n        },\n      }}\n    >\n      <div\n        style={{\n          display: \"flex\",\n          flexDirection: \"column\",\n          maxHeight: \"350px\",\n        }}\n      >\n        {props.search && (\n          <div\n            style={{\n              borderBottom: \"1px solid var(--p-color-border, #dfe3e8)\",\n              flexShrink: 0,\n            }}\n          >\n            {props.search}\n          </div>\n        )}\n        <div\n          ref={scrollContainerRef}\n          onScroll={handleScroll}\n          style={{\n            overflowY: \"auto\",\n            flex: 1,\n            maxHeight: \"292px\",\n          }}\n        >\n          <PolarisWCRelatedModelOptions\n            options={props.options}\n            records={props.records}\n            onSelect={props.onSelect}\n            isLoading={props.isLoading}\n            renderOption={props.renderOption}\n            actions={props.actions}\n            listboxId={props.listboxId}\n            showCheckbox={props.showCheckbox}\n          />\n        </div>\n      </div>\n    </PolarisWCPopover>\n  );\n};\n\nconst useDetectScrolledToBottom = (props: { loadMoreRef: React.RefObject<HTMLDivElement | null>; onLoadMore?: () => void }) => {\n  const { loadMoreRef } = props;\n  useEffect(() => {\n    if (!loadMoreRef?.current) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const [entry] = entries;\n        if (entry.isIntersecting) {\n          props.onLoadMore?.();\n        }\n      },\n      {\n        root: null,\n        threshold: 1,\n      }\n    );\n\n    observer.observe(loadMoreRef.current);\n\n    return () => observer.disconnect();\n  }, [props, loadMoreRef, props.onLoadMore]);\n};\n\nexport const PolarisWCRelatedModelOptionsSearch = (props: {\n  modelName: string;\n  value: string;\n  onChange: (value: string) => void;\n  onFocus?: () => void;\n  ariaControls?: string;\n}) => {\n  const { modelName, value, onChange, onFocus, ariaControls } = props;\n\n  const handleChange = useCallback(\n    (event: Event) => {\n      const target = event.currentTarget as HTMLInputElement;\n      onChange(target.value ?? \"\");\n    },\n    [onChange]\n  );\n\n  return (\n    <div style={{ padding: \"12px\" }} onClick={(e) => e.stopPropagation()} onTouchStart={(e) => e.stopPropagation()}>\n      <s-text-field\n        label=\"\"\n        value={value}\n        onChange={handleChange}\n        onFocus={onFocus}\n        placeholder={`Find ${modelName}`}\n        autocomplete=\"off\"\n        aria-controls={ariaControls}\n      />\n    </div>\n  );\n};\n"]}