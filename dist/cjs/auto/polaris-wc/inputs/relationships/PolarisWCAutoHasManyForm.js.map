{"version":3,"file":"PolarisWCAutoHasManyForm.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCAutoHasManyForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useFormContext } from \"../../../../useActionForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext, useAutoRelationship, useRelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport { useHasManyController } from \"../../../hooks/useHasManyController.js\";\nimport { getRecordAsOption, useOptionLabelForField } from \"../../../hooks/useRelatedModel.js\";\nimport { useRequiredChildComponentsValidator } from \"../../../hooks/useRequiredChildComponentsValidator.js\";\nimport type { AutoRelationshipFormProps } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { getRecordLabelObject } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCEditableOptionLabelButton } from \"./PolarisWCEditableOptionLabelButton.js\";\n\ntype HasManyFormProps = Omit<AutoRelationshipFormProps, \"recordFilter\">;\n\nconst useRecordLabelObjectFromProps = (props: HasManyFormProps) => {\n  const recordLabelObject = getRecordLabelObject(props.recordLabel);\n  const primaryLabel = useOptionLabelForField(props.field, recordLabelObject?.primary);\n  return { ...recordLabelObject, primary: primaryLabel };\n};\n\n/**\n * A hasMany field form component for use within <AutoForm></AutoForm> components using Polaris Web Components.\n * This component allows related model records to be created, updated, or deleted from the current model.\n * Fields on the related model record are controlled with the nested <AutoInput/> child components.\n *\n * @example\n * ```tsx\n * <AutoForm action={api.author.create}>\n *   <AutoHasManyForm field=\"books\" >\n *     <AutoInput field=\"title\" />\n *   </AutoHasManyForm>\n * </AutoForm>\n * ```\n * @param props.field - The hasMany field API identifier\n * @param props.label - The label of the hasMany form component\n * @param props.children - The child components to be rendered within the form. This is intended to be used with <AutoInput/> and will be rendered for each child record.\n * @param props.recordLabel - Controls how records on the related model are displayed as options in the relationship field input component.\n *                            When using a string, the string will indicate the field on the related model record to be displayed as the option label.\n *                            When using a function, the function will be called with the record to return a ReactNode to be displayed as the option label\n * @returns The hasMany field form component\n */\nexport const PolarisWCAutoHasManyForm = autoRelationshipForm((props: HasManyFormProps) => {\n  useRequiredChildComponentsValidator(props, \"AutoHasManyForm\");\n  const { metadata } = useAutoRelationship({ field: props.field });\n  const { getValues } = useFormContext();\n\n  const { fieldArray, fieldArrayPath } = useHasManyController({ field: props.field });\n  const { fields, append, remove } = fieldArray;\n  const relationshipContext = useRelationshipContext();\n\n  if (metadata.configuration.__typename !== \"GadgetHasManyConfig\") {\n    throw new Error(\"PolarisWCAutoHasManyForm can only be used for HasMany fields\");\n  }\n\n  const modelName = metadata.configuration.relatedModel?.name;\n\n  const recordLabel = useRecordLabelObjectFromProps(props);\n\n  const [editingIndex, setEditingIndex] = useState<number | null>(null);\n\n  return (\n    <>\n      <div style={{ marginBottom: \"8px\" }}>{props.label ?? <s-text>{metadata.name}</s-text>}</div>\n      <div\n        style={{\n          border: \"1px solid var(--p-color-border, #dfe3e8)\",\n          borderRadius: \"var(--p-border-radius-200, 8px)\",\n        }}\n      >\n        {fields.flatMap((field, idx) => {\n          // since we don't put full data in the field array when we append, we need to\n          // get the value directly from the form state\n          const record = getValues(`${fieldArrayPath}.${idx}`);\n\n          if (!record) {\n            return [];\n          }\n\n          const option = getRecordAsOption(record, recordLabel);\n\n          const pathPrefix = relationshipContext?.transformPath ? relationshipContext.transformPath(props.field) : props.field;\n          const metadataPathPrefix = relationshipContext?.transformMetadataPath\n            ? relationshipContext.transformMetadataPath(props.field)\n            : props.field;\n\n          return (\n            <div\n              key={field._fieldArrayKey}\n              id={`${pathPrefix}.${idx}`}\n              style={{\n                borderBottom: \"1px solid var(--p-color-border, #dfe3e8)\",\n              }}\n            >\n              {editingIndex === idx ? (\n                <div style={{ padding: \"12px\" }}>\n                  <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\n                    <RelationshipContext.Provider\n                      value={{\n                        transformPath: (path) => `${pathPrefix}.${idx}.${path}`,\n                        transformMetadataPath: (path) => `${metadataPathPrefix}.${path}`,\n                        fieldArray,\n                      }}\n                    >\n                      {props.children}\n                    </RelationshipContext.Provider>\n                    <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n                      <s-button tone=\"critical\" onClick={() => remove(idx)} id={`deleteButton_${metadataPathPrefix}.${idx}`}>\n                        Delete\n                      </s-button>\n                      <s-button variant=\"primary\" onClick={() => setEditingIndex(null)} id={`confirmButton_${metadataPathPrefix}.${idx}`}>\n                        Confirm\n                      </s-button>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <button\n                  type=\"button\"\n                  onClick={() => setEditingIndex(idx)}\n                  style={{\n                    display: \"flex\",\n                    width: \"100%\",\n                    padding: \"12px\",\n                    border: \"none\",\n                    background: \"transparent\",\n                    cursor: \"pointer\",\n                    textAlign: \"left\",\n                  }}\n                  onMouseEnter={(e) => {\n                    e.currentTarget.style.background = \"var(--p-color-bg-surface-hover, #f9fafb)\";\n                  }}\n                  onMouseLeave={(e) => {\n                    e.currentTarget.style.background = \"transparent\";\n                  }}\n                >\n                  <PolarisWCEditableOptionLabelButton option={option} />\n                </button>\n              )}\n            </div>\n          );\n        })}\n        <button\n          type=\"button\"\n          onClick={() => {\n            append({});\n            setEditingIndex(fields.length);\n          }}\n          style={{\n            display: \"flex\",\n            width: \"100%\",\n            padding: \"12px\",\n            border: \"none\",\n            background: \"transparent\",\n            cursor: \"pointer\",\n            textAlign: \"left\",\n            alignItems: \"center\",\n            gap: \"8px\",\n          }}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = \"var(--p-color-bg-surface-hover, #f9fafb)\";\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = \"transparent\";\n          }}\n        >\n          <s-icon type=\"plus\" />\n          <s-text>Add {modelName}</s-text>\n        </button>\n      </div>\n    </>\n  );\n});\n"]}