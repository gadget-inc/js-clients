{"version":3,"file":"PolarisWCAutoHasManyInput.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCAutoHasManyInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useMemo } from \"react\";\nimport { autoInput } from \"../../../AutoInput.js\";\nimport { useHasManyInputController } from \"../../../hooks/useHasManyController.js\";\nimport { getRecordsAsOptions, optionRecordsToLoadCount, useOptionLabelForField } from \"../../../hooks/useRelatedModel.js\";\nimport type { AutoRelationshipInputProps } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCDismissibleBadge } from \"../../commonComponents/PolarisWCDismissibleBadge.js\";\nimport { PolarisWCCombobox } from \"../PolarisWCCombobox.js\";\nimport { PolarisWCRelatedModelOptions } from \"./PolarisWCRelatedModelOptions.js\";\n\n/**\n * A hasMany field input component for use within <AutoForm></AutoForm> components using Polaris Web Components.\n * This component is used to configure relationships with records from a related model\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoHasManyInput field=\"children\" label=\"Related children\" />\n * </AutoForm>\n * ```\n * @param props.field - The hasMany field API identifier\n * @param props.label - The label of the hasMany field input component\n * @param props.optionLabel - Controls how records on the related model are displayed as options in the relationship field input component.\n *                            When using a string, the string will indicate the field on the related model record to be displayed as the option label.\n *                            When using a function, the function will be called with the record to return a ReactNode to be displayed as the option label\n * @returns The hasMany field input component\n */\nexport const PolarisWCAutoHasManyInput = autoInput((props: AutoRelationshipInputProps) => {\n  const { field, label, placeholder } = props;\n\n  const {\n    fieldMetadata: { metadata },\n    relatedModelOptions: { options, searchFilterOptions, search, pagination, relatedModel },\n\n    selectedRecords,\n    errorMessage,\n    isLoading,\n\n    onSelectRecord,\n    onRemoveRecord,\n  } = useHasManyInputController(props);\n\n  const optionLabel = useOptionLabelForField(field, props.optionLabel);\n\n  const selectedRecordIds = useMemo(() => {\n    return selectedRecords.map((record) => record.id).filter((id) => !!id) as string[];\n  }, [selectedRecords]);\n\n  // Ensure label is always a string for the web component\n  const inputLabel: string = typeof label === \"string\" ? label : typeof metadata.name === \"string\" ? metadata.name : \"\";\n\n  const verticalContent = useMemo(() => {\n    if (selectedRecords.length === 0) return undefined;\n    const recordOptions = getRecordsAsOptions(selectedRecords, { primary: optionLabel });\n    return (\n      <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: \"4px\", marginTop: \"6px\" }}>\n        {recordOptions.map((option) => (\n          <PolarisWCDismissibleBadge\n            key={`option${option.id}`}\n            onDismiss={() => {\n              const record = selectedRecords.find((r) => r.id === option.id);\n              onRemoveRecord(record ?? { id: option.id });\n            }}\n          >\n            {option.primary ?? `id: ${option.id}`}\n          </PolarisWCDismissibleBadge>\n        ))}\n      </div>\n    );\n  }, [selectedRecords, onRemoveRecord, optionLabel]);\n\n  return (\n    <PolarisWCCombobox\n      label={inputLabel}\n      placeholder={placeholder ?? \"Search\"}\n      value={search.value}\n      onChange={search.set}\n      onScrolledToBottom={pagination.loadNextPage}\n      allowMultiple\n      willLoadMoreOptions={pagination.hasNextPage && options.length >= optionRecordsToLoadCount}\n      error={errorMessage}\n      verticalContent={verticalContent}\n    >\n      <PolarisWCRelatedModelOptions\n        onSelect={onSelectRecord}\n        records={relatedModel.records}\n        options={searchFilterOptions}\n        checkSelected={(id) => selectedRecordIds.includes(id)}\n        errorMessage={errorMessage}\n        isLoading={isLoading}\n        showCheckbox\n        canLoadMore={pagination.hasNextPage && options.length >= optionRecordsToLoadCount}\n        onLoadMore={pagination.loadNextPage}\n      />\n    </PolarisWCCombobox>\n  );\n});\n"]}