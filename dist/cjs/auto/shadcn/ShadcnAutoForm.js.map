{"version":3,"file":"ShadcnAutoForm.js","sourceRoot":"","sources":["../../../../src/auto/shadcn/ShadcnAutoForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { ActionFunction, GlobalActionFunction, OptionsType } from \"@gadgetinc/api-client-core\";\nimport type { ComponentProps } from \"react\";\nimport React, { forwardRef } from \"react\";\nimport { FormProvider } from \"../../useActionForm.js\";\nimport { humanizeCamelCase } from \"../../utils.js\";\nimport type { AutoFormProps } from \"../AutoForm.js\";\nimport { useAutoForm } from \"../AutoForm.js\";\nimport { validateAutoFormProps } from \"../AutoFormActionValidators.js\";\nimport { AutoFormFieldsFromChildComponentsProvider, AutoFormMetadataContext } from \"../AutoFormContext.js\";\nimport { AutoHasManyThroughJoinModelForm } from \"../hooks/useHasManyThroughController.js\";\nimport { makeDefaultPreventedButton } from \"./ShadcnDefaultPreventedButton.js\";\nimport type { ShadcnElements } from \"./elements.js\";\nimport { makeShadcnAutoInput } from \"./inputs/ShadcnAutoInput.js\";\nimport { makeShadcnAutoBelongsToForm } from \"./inputs/relationships/ShadcnAutoBelongsToForm.js\";\nimport { makeShadcnAutoHasManyForm } from \"./inputs/relationships/ShadcnAutoHasManyForm.js\";\nimport { makeShadcnAutoHasManyThroughForm } from \"./inputs/relationships/ShadcnAutoHasManyThroughForm.js\";\nimport { makeShadcnAutoHasOneForm } from \"./inputs/relationships/ShadcnAutoHasOneForm.js\";\nimport { makeShadcnAutoSubmit } from \"./submit/ShadcnAutoSubmit.js\";\nimport { makeSubmitResultBanner } from \"./submit/ShadcnSubmitResultBanner.js\";\n\ntype FormContainerT = React.ForwardRefExoticComponent<React.FormHTMLAttributes<HTMLFormElement> & React.RefAttributes<HTMLFormElement>>;\n\nexport type ShadcnAutoFormProps<\n  GivenOptions extends OptionsType,\n  SchemaT,\n  ActionFunc extends ActionFunction<GivenOptions, any, any, SchemaT, any> | GlobalActionFunction<any>\n> = AutoFormProps<GivenOptions, SchemaT, ActionFunc> & Omit<ComponentProps<FormContainerT>, \"action\" | \"defaultValue\">;\n\n/**\n * Renders a form for an action on a model automatically using Shadcn\n */\nexport const makeAutoForm = <Elements extends ShadcnElements>(elements: Elements) => {\n  const { Skeleton, cn } = elements;\n\n  const DefaultPreventedButton = makeDefaultPreventedButton(elements);\n  const allElements = { ...elements, Button: DefaultPreventedButton };\n\n  const {\n    AutoInput,\n    AutoRolesInput,\n    AutoFileInput,\n    AutoEnumInput,\n    AutoJSONInput,\n    AutoDateTimePicker,\n    AutoPasswordInput,\n    AutoBooleanInput,\n    AutoEncryptedStringInput,\n    AutoStringInput,\n    AutoEmailInput,\n    AutoUrlInput,\n    AutoNumberInput,\n    AutoIdInput,\n    AutoHiddenInput,\n    AutoTextAreaInput,\n    AutoRichTextInput,\n\n    AutoBelongsToInput,\n    AutoHasManyInput,\n    AutoHasManyThroughInput,\n    AutoHasOneInput,\n  } = makeShadcnAutoInput(allElements);\n\n  const AutoSubmit = makeShadcnAutoSubmit(allElements);\n  const { SubmitSuccessfulBanner, SubmitErrorBanner, SubmitResultBanner } = makeSubmitResultBanner(allElements);\n\n  const AutoHasOneForm = makeShadcnAutoHasOneForm(allElements);\n  const AutoBelongsToForm = makeShadcnAutoBelongsToForm(allElements);\n  const AutoHasManyForm = makeShadcnAutoHasManyForm(allElements);\n  const AutoHasManyThroughForm = makeShadcnAutoHasManyThroughForm(allElements);\n\n  const FormContainer = forwardRef<HTMLFormElement, React.FormHTMLAttributes<HTMLFormElement>>(({ className, ...props }, ref) => {\n    return <form ref={ref} noValidate className={cn(\"space-y-6\", className)} {...props} />;\n  });\n\n  function AutoForm<\n    GivenOptions extends OptionsType,\n    SchemaT,\n    ActionFunc extends ActionFunction<GivenOptions, any, any, SchemaT, any> | GlobalActionFunction<any>\n  >(props: ShadcnAutoFormProps<GivenOptions, SchemaT, ActionFunc>) {\n    const { action, findBy } = props;\n    validateAutoFormProps(props);\n\n    // Component key to force re-render when the action or findBy changes\n    const componentKey = `${\"modelApiIdentifier\" in action ? `${action.modelApiIdentifier}.` : \"\"}${action.operationName}.${JSON.stringify(\n      findBy\n    )}`;\n\n    return (\n      <AutoFormFieldsFromChildComponentsProvider hasCustomFormChildren={React.Children.count(props.children) > 0}>\n        <AutoFormInner key={componentKey} {...props} />\n      </AutoFormFieldsFromChildComponentsProvider>\n    );\n  }\n\n  function AutoFormInner<\n    GivenOptions extends OptionsType,\n    SchemaT,\n    ActionFunc extends ActionFunction<GivenOptions, any, any, SchemaT, any> | GlobalActionFunction<any>\n  >(props: ShadcnAutoFormProps<GivenOptions, SchemaT, ActionFunc>) {\n    const { record: _record, action, findBy, ...rest } = props;\n\n    const {\n      metadata,\n      fetchingMetadata,\n      metadataError,\n      fields,\n      submit,\n      formError,\n      isSubmitting,\n      isSubmitSuccessful,\n      originalFormMethods,\n      isLoading,\n    } = useAutoForm(props);\n\n    const formTitle = \"title\" in props && props.title !== undefined ? props.title : humanizeCamelCase(action.operationName);\n\n    if (props.successContent && isSubmitSuccessful) {\n      return props.successContent;\n    }\n\n    if (fetchingMetadata) {\n      return (\n        <FormContainer {...rest} onSubmit={submit as any}>\n          {props.loadingSkeleton ?? <Skeleton />}\n        </FormContainer>\n      );\n    }\n\n    const autoFormMetadataContext: AutoFormMetadataContext = {\n      findBy,\n      submit,\n      metadata,\n      submitResult: {\n        isSuccessful: isSubmitSuccessful,\n        error: formError ?? metadataError,\n        isSubmitting,\n      },\n      model: {\n        apiIdentifier: \"modelApiIdentifier\" in action ? action.modelApiIdentifier : undefined,\n        namespace: action.namespace,\n      },\n      fields,\n    };\n\n    const formContent = props.children ?? (\n      <>\n        {formTitle && <h2 className=\"text-2xl font-bold\">{formTitle}</h2>}\n        {!props.onSuccess && <SubmitSuccessfulBanner />}\n        {!props.onFailure && <SubmitErrorBanner />}\n        {!metadataError && (\n          <>\n            {fields.map(({ metadata }) => (\n              <AutoInput field={metadata.apiIdentifier} key={metadata.apiIdentifier} />\n            ))}\n            <AutoSubmit>{\"submitLabel\" in props && props.submitLabel ? props.submitLabel : \"Submit\"}</AutoSubmit>\n          </>\n        )}\n      </>\n    );\n\n    return (\n      <AutoFormMetadataContext.Provider value={autoFormMetadataContext}>\n        <FormProvider {...originalFormMethods}>\n          <FormContainer\n            {...rest}\n            className={cn(`${isLoading || isSubmitting ? \"opacity-30\" : \"\"} ${rest.className ?? \"\"}`)}\n            onSubmit={submit as any}\n          >\n            {formContent}\n          </FormContainer>\n        </FormProvider>\n      </AutoFormMetadataContext.Provider>\n    );\n  }\n\n  return {\n    AutoForm,\n\n    AutoInput,\n    AutoBooleanInput,\n    AutoDateTimePicker,\n    AutoEmailInput,\n    AutoEncryptedStringInput,\n    AutoEnumInput,\n    AutoFileInput,\n    AutoHiddenInput,\n    AutoIdInput,\n    AutoJSONInput,\n    AutoNumberInput,\n    AutoPasswordInput,\n    AutoRichTextInput,\n    AutoRolesInput,\n    AutoStringInput,\n    AutoTextAreaInput,\n    AutoUrlInput,\n\n    AutoBelongsToInput,\n    AutoHasManyInput,\n    AutoHasManyThroughInput,\n    AutoHasOneInput,\n\n    AutoBelongsToForm,\n    AutoHasManyForm,\n    AutoHasManyThroughForm,\n    AutoHasManyThroughJoinModelForm,\n    AutoHasOneForm,\n\n    AutoSubmit,\n    SubmitErrorBanner,\n    SubmitResultBanner,\n    SubmitSuccessfulBanner,\n  };\n};\n"]}