{"version":3,"file":"ShadcnAutoFileInput.js","sourceRoot":"","sources":["../../../../../src/auto/shadcn/inputs/ShadcnAutoFileInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import { DeleteIcon, File } from \"lucide-react\";\nimport React, { useEffect, useMemo, type HtmlHTMLAttributes, type ReactNode } from \"react\";\nimport type { Control } from \"../../../useActionForm.js\";\nimport { isAutoFileFieldValue } from \"../../../validationSchema.js\";\nimport { autoInput } from \"../../AutoInput.js\";\nimport { useFileInputController } from \"../../hooks/useFileInputController.js\";\nimport { type ShadcnElements } from \"../elements.js\";\n\nexport const makeShadcnAutoFileInput = ({\n  Input,\n  Label,\n  Button,\n  Avatar,\n  AvatarImage,\n  AvatarFallback,\n}: Pick<ShadcnElements, \"Input\" | \"Label\" | \"Button\" | \"Avatar\" | \"AvatarImage\" | \"AvatarFallback\">) => {\n  function ShadcnAutoFileInput(\n    props: {\n      field: string;\n      control?: Control<any>;\n      label?: ReactNode;\n    } & HtmlHTMLAttributes<HTMLDivElement>\n  ) {\n    const { field: fieldApiIdentifier, control, ...rest } = props;\n\n    const [isFilePickerOpen, setIsFilePickerOpen] = React.useState(false);\n\n    // Handle when the system file picker is closed\n    useEffect(() => {\n      // When window regains focus, file picker must be closed\n      const handleFocus = () => setIsFilePickerOpen(false);\n      window.addEventListener(\"focus\", handleFocus);\n      return () => window.removeEventListener(\"focus\", handleFocus);\n    }, []);\n\n    const {\n      fieldProps,\n      errorMessage,\n      imageThumbnailURL,\n      onFileUpload,\n      clearFileValue,\n      canClearFileValue,\n      validations,\n      metadata,\n      actionHintParts,\n    } = useFileInputController({\n      field: fieldApiIdentifier,\n      control,\n    });\n\n    const fileUploadContainer = useMemo(() => {\n      if (!actionHintParts) {\n        return null;\n      }\n\n      return (\n        <div>\n          {actionHintParts.length > 1 && (\n            <Label>\n              <span className=\"block text-sm text-gray-500 mb-2\">\n                {actionHintParts.map((part, index) => (\n                  <span key={index} className=\"mr-1\">\n                    {part}\n                  </span>\n                ))}\n              </span>\n            </Label>\n          )}\n\n          <Input\n            className={`cursor-pointer ${isFilePickerOpen ? \"ring-1 ring-ring\" : \"\"}`}\n            type=\"file\"\n            {...props}\n            title=\"\" // to prevent the tooltip\n            accept={validations.onlyImages?.acceptedTypes?.join(\",\")}\n            onClick={() => setIsFilePickerOpen(true)}\n            onChange={(e) => {\n              if (e.target.files) {\n                void onFileUpload(Array.from(e.target.files));\n              }\n            }}\n          />\n        </div>\n      );\n    }, [actionHintParts, validations.onlyImages?.acceptedTypes, props, onFileUpload]);\n\n    const inputLabel = props.label ?? (\n      <div style={{ display: \"flex\", gap: \"4px\" }}>\n        {metadata.name}\n        {metadata.requiredArgumentForInput ? <span style={{ color: \"var(--p-color-text-critical)\" }}>{\"*\"}</span> : null}\n      </div>\n    );\n\n    const filePreview = useMemo(() => {\n      const value = fieldProps.value;\n      if (!value || !isAutoFileFieldValue(value)) return null;\n\n      return (\n        <div className=\"flex w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors\">\n          <div className=\"flex items-center gap-4\">\n            <Avatar>\n              <AvatarImage src={imageThumbnailURL} />\n              <AvatarFallback>\n                <File />\n              </AvatarFallback>\n            </Avatar>\n\n            <div className=\"text-sm\">\n              {value.$uploading ? \"(Uploading) \" : \"\"}\n              {value.fileName}\n            </div>\n          </div>\n\n          {/* Delete Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => clearFileValue()}\n            id={`clear-file-${fieldApiIdentifier}`}\n            className=\"ml-auto my-auto flex items-center\"\n          >\n            <DeleteIcon className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      );\n    }, [canClearFileValue, clearFileValue, fieldApiIdentifier, fieldProps.value, imageThumbnailURL]);\n\n    return (\n      <div>\n        {inputLabel}\n        {fileUploadContainer}\n        {filePreview}\n        <div>\n          {errorMessage && (\n            <div style={{ marginTop: \"4px\" }}>\n              <Label className=\"text-red-500\">{errorMessage}</Label>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  return autoInput(ShadcnAutoFileInput);\n};\n"]}