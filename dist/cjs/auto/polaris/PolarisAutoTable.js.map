{"version":3,"file":"PolarisAutoTable.js","sourceRoot":"","sources":["../../../../src/auto/polaris/PolarisAutoTable.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { FindManyFunction } from \"@gadgetinc/api-client-core\";\nimport { BlockStack, DataTable, EmptySearchResult, IndexTable, IndexTableProps, Pagination, SkeletonBodyText } from \"@shopify/polaris\";\nimport pluralize from \"pluralize\";\nimport React, { useMemo } from \"react\";\nimport { useTable } from \"../../useTable.js\";\nimport type { OptionsType } from \"../../utils.js\";\nimport type { AutoTableProps } from \"../AutoTable.js\";\nimport { PolarisErrorDisplay } from \"./PolarisErrorDisplay.js\";\n\nconst PolarisSkeletonTable = (props: { columns: number }) => {\n  const count = Array.from(Array(props.columns));\n  return (\n    <DataTable\n      columnContentTypes={count.map(() => \"text\")}\n      headings={count.map((i) => (\n        <SkeletonBodyText key={i} lines={1} />\n      ))}\n      rows={Array.from(Array(3)).map((_) => count.map((i) => <SkeletonBodyText key={i} lines={1} />))}\n    />\n  );\n};\n\n/**\n * Renders a table of records from the backend automatically for a given model using Polaris\n */\nexport const PolarisAutoTable = <\n  GivenOptions extends OptionsType,\n  SchemaT,\n  FinderFunction extends FindManyFunction<GivenOptions, any, SchemaT, any>,\n  Options extends FinderFunction[\"optionsType\"]\n>(\n  props: AutoTableProps<GivenOptions, SchemaT, FinderFunction, Options>\n) => {\n  const [{ rows, columns, metadata, fetching, page, error }, refresh] = useTable<GivenOptions, SchemaT, FinderFunction, Options>(\n    props.model,\n    {\n      select: props.select,\n    } as any\n  );\n\n  const polarisTableProps = useMemo(() => {\n    const headings = [] as unknown as IndexTableProps[\"headings\"];\n    const sortable: boolean[] = [];\n\n    if (columns) {\n      for (const column of columns) {\n        headings.push({ title: column.name });\n        sortable.push(column.sortable);\n      }\n    }\n\n    return { headings, sortable };\n  }, [columns]);\n\n  if (error) {\n    return <PolarisErrorDisplay error={error} retry={refresh} />;\n  }\n\n  if ((fetching && !rows) || !columns) {\n    return <PolarisSkeletonTable columns={polarisTableProps.headings.length} />;\n  }\n\n  const resourceName = {\n    singular: metadata?.name ?? \"\",\n    plural: metadata ? pluralize(metadata.name) : \"\",\n  };\n\n  return (\n    <BlockStack>\n      <IndexTable\n        {...polarisTableProps}\n        resourceName={resourceName}\n        emptyState={<EmptySearchResult title={`No ${resourceName.plural} yet`} description={\"\"} withIllustration />}\n        loading={fetching}\n        hasMoreItems={page.hasNextPage}\n        itemCount={rows?.length ?? 0}\n      >\n        {rows &&\n          columns &&\n          rows.map((row, index) => (\n            <IndexTable.Row key={row.id as string} id={row.id as string} position={index}>\n              {columns.map((column) => (\n                <IndexTable.Cell key={column.apiIdentifier}>{row[column.apiIdentifier]}</IndexTable.Cell>\n              ))}\n            </IndexTable.Row>\n          ))}\n      </IndexTable>\n      <Pagination\n        hasNext={page.hasNextPage}\n        hasPrevious={page.hasPreviousPage}\n        onNext={page.goToNextPage}\n        onPrevious={page.goToPreviousPage}\n      />\n    </BlockStack>\n  );\n};\n"]}