{"version":3,"file":"PolarisHasManyInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisHasManyInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { AnyModelManager } from \"@gadgetinc/api-client-core\";\nimport { assert } from \"@gadgetinc/api-client-core\";\nimport { Autocomplete, LegacyStack, Tag } from \"@shopify/polaris\";\nimport React, { useCallback, useState } from \"react\";\nimport { useFieldArray, useFormContext } from \"react-hook-form\";\nimport type { GadgetBelongsToConfig } from \"src/internal/gql/graphql.js\";\nimport { useApi } from \"../../../GadgetProvider.js\";\nimport { useFindMany } from \"../../../useFindMany.js\";\nimport { useFormFields } from \"../../AutoForm.js\";\nimport { useAutoFormMetadata } from \"../../AutoFormContext.js\";\n\nexport const PolarisHasManyInput = (props: { field: string }) => {\n  const { metadata } = useAutoFormMetadata();\n  const api = useApi();\n  const gadgetFields = useFormFields(metadata, {});\n\n  const fieldMetadata = gadgetFields.find((field) => field[1].apiIdentifier === props.field);\n\n  if (!fieldMetadata) {\n    throw new Error(`Field ${props.field} not found in metadata`);\n  }\n\n  const path = fieldMetadata[0];\n  const _field = fieldMetadata[1];\n\n  const { getValues } = useFormContext();\n\n  const { fields, remove, replace } = useFieldArray({\n    name: path,\n  });\n\n  const config = _field.configuration as GadgetBelongsToConfig;\n\n  if (!config || !config.relatedModel) {\n    throw new Error(`Field ${props.field} not found in metadata`);\n  }\n\n  const modelManager = assert(\n    (api as any)[config.relatedModel.apiIdentifier] as AnyModelManager,\n    \"no model manager found for action function\"\n  );\n\n  const [{ data, fetching, error }, _refetch] = useFindMany(modelManager as any, { first: 25 });\n\n  const [inputValue, setInputValue] = useState(\"\");\n\n  const updateText = useCallback((value: string) => {\n    setInputValue(value);\n  }, []);\n\n  if (fetching || !data) {\n    return <p>Loading...</p>;\n  }\n\n  const options = data.map((record: Record<string, any>) => {\n    return { label: record.name, value: record.id };\n  });\n\n  const verticalContentMarkup =\n    fields.length > 0 ? (\n      <LegacyStack spacing=\"extraTight\" alignment=\"center\">\n        {fields.map((field, i) => {\n          const id = getValues(path)[i].id;\n          const option = options.find((option) => option.value === id);\n          return (\n            <Tag\n              key={`option${field.id}`}\n              onRemove={() => {\n                const index = fields.findIndex((entry) => entry.id == field.id);\n                remove(index);\n              }}\n            >\n              {option?.label}\n            </Tag>\n          );\n        })}\n      </LegacyStack>\n    ) : null;\n\n  const textField = (\n    <Autocomplete.TextField\n      onChange={updateText}\n      label={_field.name}\n      value={inputValue}\n      verticalContent={verticalContentMarkup}\n      autoComplete=\"off\"\n    />\n  );\n\n  return (\n    <Autocomplete\n      allowMultiple\n      options={options}\n      selected={fields.map((field, i) => getValues(path)[i].id)}\n      textField={textField}\n      onSelect={(selection) => {\n        replace(selection.map((id) => ({ id: id })));\n      }}\n      listTitle={_field.name}\n    />\n  );\n};\n"]}