{"version":3,"file":"PolarisAutoFileInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisAutoFileInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { DropZoneProps } from \"@shopify/polaris\";\nimport { Box, Button, DropZone, InlineError, InlineStack, Thumbnail } from \"@shopify/polaris\";\nimport { DeleteIcon, NoteIcon } from \"@shopify/polaris-icons\";\nimport { filesize } from \"filesize\";\nimport React, { useMemo } from \"react\";\nimport type { Control } from \"react-hook-form\";\nimport { isAutoFileFieldValue } from \"../../../validationSchema.js\";\nimport { getFileSizeValidationMessage, imageFileTypes, useFileInputController } from \"../../hooks/useFileInputController.js\";\n\nexport const PolarisAutoFileInput = (props: { field: string; control?: Control<any> } & DropZoneProps) => {\n  const { field: fieldApiIdentifier, control, ...rest } = props;\n  const { fieldProps, errorMessage, imageThumbnailURL, onFileUpload, clearFileValue, canClearFileValue, validations, metadata } =\n    useFileInputController({\n      field: fieldApiIdentifier,\n      control,\n    });\n\n  const fileUploadContainer = useMemo(() => {\n    if (fieldProps.value) return null;\n\n    const actionHintParts = [\"Accepts\"];\n    if (validations.onlyImages) {\n      actionHintParts.push(`.jpg, .webp, .svg${validations.onlyImages.allowAnimatedImages ? \", .gif\" : \"\"}, and .png`);\n    }\n\n    if (validations.fileSize) {\n      const validation = validations.fileSize;\n      const message = getFileSizeValidationMessage(validation, {\n        inRange: (min, max) => `between ${filesize(min)} and ${filesize(max)}`,\n        max: (max) => `larger than ${filesize(max)}`,\n        min: (min) => `smaller than ${filesize(min)}`,\n      });\n      if (message) actionHintParts.push(message);\n    }\n\n    return <DropZone.FileUpload actionTitle=\"Add file\" actionHint={actionHintParts.length === 1 ? \"\" : actionHintParts.join(\" \")} />;\n  }, [fieldProps.value, validations.fileSize, validations.onlyImages]);\n\n  let filePreview = null;\n  if (fieldProps.value && isAutoFileFieldValue(fieldProps.value)) {\n    filePreview = (\n      <Box padding=\"100\">\n        <InlineStack align=\"space-between\">\n          <InlineStack gap=\"200\" blockAlign=\"center\">\n            <Thumbnail\n              size=\"small\"\n              alt={fieldProps.value.fileName}\n              source={\n                imageThumbnailURL && [...imageFileTypes, \"image/gif\"].includes(fieldProps.value.mimeType) ? imageThumbnailURL : NoteIcon\n              }\n            />\n            <div>\n              {fieldProps.value.$uploading ? \"(Uploading) \" : \"\"}\n              {fieldProps.value.fileName}\n            </div>\n          </InlineStack>\n          {canClearFileValue && (\n            // <div\n            //   onClick={(event) => {\n            //     event.preventDefault();\n            //     event.stopPropagation();\n            //     clearFileValue();\n            //   }}\n            // >\n            //   Delete file\n            // </div>\n            <Button\n              icon={DeleteIcon}\n              variant=\"plain\"\n              accessibilityLabel=\"Delete file\"\n              onPointerDown={() => {\n                clearFileValue();\n              }}\n              id={`clear-file-${fieldApiIdentifier}`}\n            />\n          )}\n        </InlineStack>\n      </Box>\n    );\n  }\n\n  const inputLabel = (\n    <>\n      {metadata.name} {metadata.requiredArgumentForInput ? <span style={{ color: \"var(--p-color-text-critical)\" }}>*</span> : null}\n    </>\n  );\n\n  return (\n    <>\n      <DropZone\n        variableHeight\n        label={inputLabel}\n        allowMultiple={false}\n        onDrop={(_droppedFiles, acceptedFiles) => {\n          void onFileUpload(acceptedFiles);\n        }}\n        {...rest}\n        accept={validations.onlyImages?.acceptedTypes?.join(\",\")}\n      >\n        {filePreview}\n        {fileUploadContainer}\n      </DropZone>\n      {errorMessage && (\n        <div style={{ marginTop: \"4px\" }}>\n          <InlineError fieldID={fieldApiIdentifier} message={errorMessage} />\n        </div>\n      )}\n    </>\n  );\n};\n"]}