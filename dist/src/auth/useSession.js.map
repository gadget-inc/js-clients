{"version":3,"file":"useSession.js","sourceRoot":"","sources":["../../../src/auth/useSession.ts"],"names":[],"mappings":";;;AAAA,6DAAkD;AAClD,6CAA0C;AAc1C;;;GAGG;AACI,MAAM,UAAU,GAAG,GAAkB,EAAE;IAC5C,MAAM,GAAG,GAAG,IAAA,uBAAM,GAAE,CAAC;IACrB,IAAI,gBAAgB,IAAI,GAAG,IAAI,SAAS,IAAI,GAAG,EAAE;QAC/C,MAAM,MAAM,GAAI,GAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,gBAAgB,CAAC;QAC9D,IAAI,MAAM,IAAI,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;YACrB,MAAM,CAAC,IAAI,GAAG;gBACZ,GAAI,GAAG,CAAC,IAAY,CAAC,QAAQ,CAAC,gBAAgB;aAC/C,CAAC;SACH;QAED,MAAM,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,GAAG,IAAA,eAAM,EAAC,GAAG,CAAC,cAAqB,EAAE;YACnE,QAAQ,EAAE,IAAI;YACd,MAAM;SACP,CAAC,CAAC;QAEH,IAAI,KAAK;YAAE,MAAM,KAAK,CAAC;QACvB,IAAI,CAAC,OAAO;YAAE,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;QAChF,OAAO,OAAO,CAAC;KAChB;SAAM;QACL,MAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;KAC7D;AACH,CAAC,CAAC;AAtBW,QAAA,UAAU,cAsBrB","sourcesContent":["import { useApi } from \"../../src/GadgetProvider\";\nimport { useGet } from \"../../src/useGet\";\n\nexport interface GadgetSession {\n  id: string;\n  userId: string | null;\n  user: GadgetUser | null;\n  [key: string]: any;\n}\n\nexport interface GadgetUser {\n  id: string;\n  [key: string]: any;\n}\n\n/**\n * Used for fetching the current `Session` record from Gadget. Will suspend while the user is being fetched.\n * @returns The current session\n */\nexport const useSession = (): GadgetSession => {\n  const api = useApi();\n  if (\"currentSession\" in api && \"session\" in api) {\n    const select = (api as any).session.findMany.defaultSelection;\n    if (\"user\" in api) {\n      select.userId = true;\n      select.user = {\n        ...(api.user as any).findMany.defaultSelection,\n      };\n    }\n\n    const [{ data: session, error }] = useGet(api.currentSession as any, {\n      suspense: true,\n      select,\n    });\n\n    if (error) throw error;\n    if (!session) throw new Error(\"currentSession not found but should be present\");\n    return session;\n  } else {\n    throw new Error(\"api client does not have a Session model\");\n  }\n};\n"]}