{"version":3,"file":"GadgetProvider.js","sourceRoot":"","sources":["../../src/GadgetProvider.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AACA,gEAA+E;AAC/E,+CAAqD;AAErD,+BAAgD;AAEhD;;;;IAII;AACS,QAAA,uBAAuB,GAAG,eAAK,CAAC,aAAa,CAAyB,SAAS,CAAC,CAAC;AAE9F;;GAEG;AACU,QAAA,mBAAmB,GAAG,eAAK,CAAC,aAAa,CAAwB,SAAS,CAAC,CAAC;AA6BzF;;;;;;;;;;;;;;;;GAgBG;AACH,SAAgB,QAAQ,CAAC,KAA8C;IACrE,IAAI,YAAY,GAA0B,SAAS,CAAC;IACpD,IAAI,UAAsB,CAAC;IAC3B,IAAI,KAAK,IAAI,KAAK,EAAE;QAClB,IAAI,CAAC,IAAA,gCAAc,EAAC,KAAK,CAAC,GAAG,CAAC,EAAE;YAC9B,MAAM,IAAI,KAAK,CACb,8IAA8I,CAC/I,CAAC;SACH;QACD,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC;QACzB,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC;KACjD;SAAM,IAAI,KAAK,CAAC,KAAK,EAAE;QACtB,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC;KAC1B;SAAM;QACL,MAAM,IAAI,KAAK,CACb,yIAAyI,CAC1I,CAAC;KACH;IAED,OAAO,CACL,8BAAC,+BAAuB,CAAC,QAAQ,IAAC,KAAK,EAAE,UAAU;QACjD,8BAAC,2BAAmB,CAAC,QAAQ,IAAC,KAAK,EAAE,YAAY;YAC/C,8BAAC,eAAY,IAAC,KAAK,EAAE,UAAU,IAAG,KAAK,CAAC,QAAQ,CAAgB,CACnC,CACE,CACpC,CAAC;AACJ,CAAC;AA1BD,4BA0BC;AAED;;;IAGI;AACG,MAAM,aAAa,GAAG,GAAG,EAAE;IAChC,MAAM,UAAU,GAAG,IAAA,kBAAU,EAAC,+BAAuB,CAAC,CAAC;IACvD,IAAI,CAAC,UAAU,EAAE;QACf,MAAM,IAAI,KAAK,CAAC,iHAAiH,CAAC,CAAC;KACpI;IACD,MAAM,UAAU,GAAI,UAAkB,CAAC,mCAAiB,CAAiC,CAAC;IAC1F,IAAI,CAAC,UAAU,EAAE;QACf,MAAM,IAAI,KAAK,CACb;;;;;0GAKoG,CACrG,CAAC;KACH;IAED,OAAO,UAAU,CAAC;AACpB,CAAC,CAAC;AAlBW,QAAA,aAAa,iBAkBxB;AAEF;;;IAGI;AACG,MAAM,MAAM,GAAG,GAAG,EAAE;IACzB,MAAM,GAAG,GAAG,IAAA,kBAAU,EAAC,2BAAmB,CAAC,CAAC;IAC5C,MAAM,UAAU,GAAG,IAAA,kBAAU,EAAC,+BAAuB,CAAC,CAAC;IACvD,IAAI,CAAC,GAAG,EAAE;QACR,IAAI,UAAU,EAAE;YACd,MAAM,IAAI,KAAK,CACb;;2KAEmK,CACpK,CAAC;SACH;aAAM;YACL,MAAM,IAAI,KAAK,CACb;;;;;0GAKkG,CACnG,CAAC;SACH;KACF;IACD,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AAtBW,QAAA,MAAM,UAsBjB","sourcesContent":["import type { AnyClient, GadgetConnection } from \"@gadgetinc/api-client-core\";\nimport { $gadgetConnection, isGadgetClient } from \"@gadgetinc/api-client-core\";\nimport React, { ReactNode, useContext } from \"react\";\nimport type { Client as UrqlClient } from \"urql\";\nimport { Provider as UrqlProvider } from \"urql\";\n\n/**\n * React context that stores the current urql client\n *\n * urql doesn't have its own useClient hook, so we store it on our own context to get at the client object later\n **/\nexport const GadgetUrqlClientContext = React.createContext<UrqlClient | undefined>(undefined);\n\n/**\n * React context that stores an instance of the JS Client for an app (AKA the `api` object)\n */\nexport const GadgetClientContext = React.createContext<AnyClient | undefined>(undefined);\n\nexport interface ProviderProps {\n  /**\n   * An instance of your app's api client, often named `api`. This is the object that contains all of your generated query/mutation/subscription functions.\n   *\n   * @example\n   * import { Client } from \"@gadget-client/example-app\"\n   * const api = new Client();\n   * const App = () => {\n   *   return <Provider api={api}>\n   *     <Routes/>\n   *   </Provider>;\n   * }\n   */\n  api: AnyClient;\n  children: ReactNode;\n}\n\n/** @deprecated -- pass an instance of your app's api client instead with the `api` prop */\nexport interface DeprecatedProviderProps {\n  /**\n   * an urql client object from your current Gadget client, like `api.connection.currentClient`\n   * @deprecated -- pass an instance of your app's api client instead with the `api` prop\n   */\n  value: UrqlClient;\n  children: ReactNode;\n}\n\n/**\n * Provider wrapper component that passes an api client instance to the other hooks.\n *\n * This component is __required__ as a wrapper around any React components using the other hooks in this library, like `useFindMany` or `useAction`.\n *\n * Pass an instance of your app's api client to the `value` prop.\n *\n * @example\n * <Provider value={api}>\n *   <MyApp />\n * </Provider>\n *\n * @example the Provider accepts the deprecated form of passing an urql client object right in -- this is deprecated and will be removed in a future version. Instead, just pass the whole api instance.\n * <Provider value={api.connection.currentClient}>\n *   <MyApp />\n * </Provider>\n */\nexport function Provider(props: ProviderProps | DeprecatedProviderProps) {\n  let gadgetClient: AnyClient | undefined = undefined;\n  let urqlClient: UrqlClient;\n  if (\"api\" in props) {\n    if (!isGadgetClient(props.api)) {\n      throw new Error(\n        \"Invalid Gadget API client passed to <Provider /> component -- please pass an instance of your generated client, like <Provider api={api} />!\"\n      );\n    }\n    gadgetClient = props.api;\n    urqlClient = props.api.connection.currentClient;\n  } else if (props.value) {\n    urqlClient = props.value;\n  } else {\n    throw new Error(\n      \"No Gadget API client passed to <Provider /> component -- please pass an instance of your generated client, like <Provider api={api} />!\"\n    );\n  }\n\n  return (\n    <GadgetUrqlClientContext.Provider value={urqlClient}>\n      <GadgetClientContext.Provider value={gadgetClient}>\n        <UrqlProvider value={urqlClient}>{props.children}</UrqlProvider>\n      </GadgetClientContext.Provider>\n    </GadgetUrqlClientContext.Provider>\n  );\n}\n\n/**\n * Get the current `GadgetConnection` object from React context.\n * Must be called within a component wrapped by the `<Provider api={...} />` component.\n **/\nexport const useConnection = () => {\n  const urqlClient = useContext(GadgetUrqlClientContext);\n  if (!urqlClient) {\n    throw new Error(\"No urql client object in React context, have you added the <Provider/> wrapper component from @gadgetinc/react?\");\n  }\n  const connection = (urqlClient as any)[$gadgetConnection] as GadgetConnection | undefined;\n  if (!connection) {\n    throw new Error(\n      `urql client found in context was not set up by the Gadget API client. Please ensure you are wrapping this hook with the <Provider/> component from @gadgetinc/react. \n      \n      Possible remedies: \n       - ensuring you have the <Provider/> component wrapped around your hook invocation\n       - ensuring you are passing a value to the provider, usually <Provider api={api}>\n       - ensuring your @gadget-client/<your-app> package and your @gadgetinc/react package are up to date`\n    );\n  }\n\n  return connection;\n};\n\n/**\n * Get the current `api` object from React context\n * Must be called within a component wrapped by the `<Provider api={...} />` component.\n **/\nexport const useApi = () => {\n  const api = useContext(GadgetClientContext);\n  const urqlClient = useContext(GadgetUrqlClientContext);\n  if (!api) {\n    if (urqlClient) {\n      throw new Error(\n        `useApi hook called in context with deprecated <Provider/> convention. Please ensure you are wrapping this hook with the <Provider/> component from @gadgetinc/react and passing it an instance of your api client, like <Provider api={api} />.\n\n        The <Provider /> component is currently being passed a value, like <Provider value={api.connection.currentClient}/>. Please update this to <Provider api={api} />.`\n      );\n    } else {\n      throw new Error(\n        `useApi hook called in context where no Gadget API client is available. Please ensure you are wrapping this hook with the <Provider/> component from @gadgetinc/react.\n      \n      Possible remedies:\n       - ensuring you have the <Provider/> component wrapped around your hook invocation\n       - ensuring you are passing an api client instance to the provider, usually <Provider api={api}>\n       - ensuring your @gadget-client/<your-app> package and your @gadgetinc/react package are up to date`\n      );\n    }\n  }\n  return api;\n};\n"]}