{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  ActionFunction,\n  AnyModelManager,\n  BulkActionFunction,\n  FieldSelection,\n  GadgetError,\n  InvalidFieldError,\n  InvalidRecordError,\n} from \"@gadgetinc/api-client-core\";\nimport { gadgetErrorFor, getNonNullableError } from \"@gadgetinc/api-client-core\";\nimport type { CombinedError, RequestPolicy } from \"@urql/core\";\nimport { GraphQLError } from \"graphql\";\nimport { useMemo } from \"react\";\nimport type { AnyVariables, Operation, OperationContext, UseQueryArgs, UseQueryState } from \"urql\";\n\n/**\n * All the options controlling how this query will be managed by urql\n * */\nexport declare type ReadOperationOptions = {\n  /** Updates the {@link RequestPolicy} for the executed GraphQL query operation.\n   *\n   * @remarks\n   * `requestPolicy` modifies the {@link RequestPolicy} of the GraphQL query operation\n   * that `useQuery` executes, and indicates a caching strategy for cache exchanges.\n   *\n   * For example, when set to `'cache-and-network'`, {@link useQuery} will\n   * receive a cached result with `stale: true` and an API request will be\n   * sent in the background.\n   *\n   * @see {@link OperationContext.requestPolicy} for where this value is set.\n   */\n  requestPolicy?: RequestPolicy;\n  /** Updates the {@link OperationContext} for the executed GraphQL query operation.\n   *\n   * @remarks\n   * `context` may be passed to {@link useQuery}, to update the {@link OperationContext}\n   * of a query operation. This may be used to update the `context` that exchanges\n   * will receive for a single hook.\n   *\n   * Hint: This should be wrapped in a `useMemo` hook, to make sure that your\n   * component doesn’t infinitely update.\n   *\n   * @example\n   * ```ts\n   * const [result, reexecute] = useQuery({\n   *   query,\n   *   context: useMemo(() => ({\n   *     additionalTypenames: ['Item'],\n   *   }), [])\n   * });\n   * ```\n   */\n  context?: Partial<OperationContext>;\n  /** Prevents {@link useQuery} from automatically executing GraphQL query operations.\n   *\n   * @remarks\n   * `pause` may be set to `true` to stop {@link useQuery} from executing\n   * automatically. The hook will stop receiving updates from the {@link Client}\n   * and won’t execute the query operation, until either it’s set to `false`\n   * or the {@link UseQueryExecute} function is called.\n   *\n   * @see {@link https://urql.dev/goto/docs/basics/react-preact/#pausing-usequery} for\n   * documentation on the `pause` option.\n   */\n  pause?: boolean;\n  /**\n   * Marks this query as one that should suspend the react component rendering while executing, instead of returning `{fetching: true}` to the caller.\n   * Useful if you want to allow components higher in the tree to show spinners instead of having every component manage its own loading state.\n   */\n  suspense?: boolean;\n  /**\n   * Marks this query as a live query that will subscribe to changes from the backend and re-render when backend data changes with the newest data.\n   *\n   * This option is currently only available for Gadget apps in the Realtime Queries beta!\n   * Please contact Gadget for access to this beta in order to use Realtime queries.\n   * @experimental\n   */\n  live?: boolean;\n};\n\n/**\n * The inner result object returned from a query result\n **/\nexport interface ReadHookState<Data = any, Variables extends AnyVariables = Record<string, any>> {\n  fetching: boolean;\n  stale: boolean;\n  data?: Data;\n  error?: ErrorWrapper;\n  extensions?: Record<string, any>;\n  operation?: Operation<Data, Variables>;\n}\n\n/**\n * The return value of a `useGet`, `useFindMany`, `useFindOne` etc hook.\n * Includes the data result object and a refetch function.\n **/\nexport declare type ReadHookResult<Data = any, Variables extends AnyVariables = AnyVariables> = [\n  ReadHookState<Data, Variables>,\n  (opts?: Partial<OperationContext>) => void\n];\n\n/**\n * The inner result object returned from a mutation result\n */\nexport interface ActionHookState<Data = any, Variables extends AnyVariables = Record<string, any>> {\n  fetching: boolean;\n  stale: boolean;\n  data?: Data;\n  error?: ErrorWrapper;\n  extensions?: Record<string, any>;\n  operation?: Operation<Data, Variables>;\n}\n\nexport type RequiredKeysOf<BaseType> = Exclude<\n  {\n    [Key in keyof BaseType]: BaseType extends Record<Key, BaseType[Key]> ? Key : never;\n  }[keyof BaseType],\n  undefined\n>;\n\n/**\n * The return value of a `useAction`, `useGlobalAction`, `useBulkAction` etc hook.\n * Includes the data result object and a function for running the mutation.\n **/\nexport type ActionHookResult<Data = any, Variables extends AnyVariables = AnyVariables> = RequiredKeysOf<Variables> extends never\n  ? [\n      ActionHookState<Data, Variables>,\n      (variables?: Variables, context?: Partial<OperationContext>) => Promise<ActionHookState<Data, Variables>>\n    ]\n  : [\n      ActionHookState<Data, Variables>,\n      (variables: Variables, context?: Partial<OperationContext>) => Promise<ActionHookState<Data, Variables>>\n    ];\n\nexport const noProviderErrorMessage = `Could not find a client in the context of Provider. Please ensure you wrap the root component in a <Provider>`;\n\nconst generateErrorMessage = (networkErr?: Error, graphQlErrs?: GraphQLError[]) => {\n  let error = \"\";\n  if (networkErr !== undefined) {\n    error = `[Network] ${networkErr.message}`;\n  } else if (graphQlErrs !== undefined) {\n    graphQlErrs.forEach((err) => {\n      error += `[GraphQL] ${err.message}\\n`;\n    });\n  } else {\n    error = \"Unknown error\";\n  }\n\n  return error.trim();\n};\n\nconst rehydrateGraphQlError = (error: any): GraphQLError => {\n  if (typeof error === \"string\") {\n    return new GraphQLError(error);\n  } else if (error?.message && !error.code) {\n    return new GraphQLError(error.message, error.nodes, error.source, error.positions, error.path, error, error.extensions || {});\n  } else {\n    return error;\n  }\n};\n\n/**\n * An error returned by any of the Gadget react hooks.\n * Always has a message, but can be inspected to retrieve more detailed errors from either the network, the raw GraphQL layer, or Gadget specific errors like validation errors.\n * Not intended for creating outside of Gadget-owned code.\n **/\nexport class ErrorWrapper extends Error {\n  /** @private */\n  static forClientSideError(error: Error, response?: any) {\n    return new ErrorWrapper({\n      executionErrors: [error],\n      response,\n    });\n  }\n  /** @private */\n  static forErrorsResponse(errors: Record<string, any>[], response?: any) {\n    return new ErrorWrapper({\n      executionErrors: errors.map(gadgetErrorFor),\n      response,\n    });\n  }\n  /** @private */\n  static forMaybeCombinedError(error?: CombinedError | null) {\n    if (!error) return undefined;\n    return new ErrorWrapper({\n      networkError: error.networkError,\n      executionErrors: error.graphQLErrors,\n      response: error.response,\n    });\n  }\n  /** @private */\n  static errorIfDataAbsent(result: UseQueryState<any>, dataPath: string[], paused = false) {\n    const nonNullableError = getNonNullableError(result, dataPath);\n    let error = ErrorWrapper.forMaybeCombinedError(result.error);\n    if (!error && nonNullableError && !paused) {\n      error = ErrorWrapper.forClientSideError(nonNullableError);\n    }\n    return error;\n  }\n\n  /** Error message for this error. Derived from the other errors this wraps. */\n  public message: string;\n  /**\n   * A list of errors encountered by the backend when processing a request. Populated if the client successfully communicated with the backend, but the backend was unable to process the request and rejected it with an error.\n   * Includes GraphQL syntax errors, missing or invalid argument errors, data validation errors, or unexpected errors encountered when running backend logic.\n   **/\n  public executionErrors: (GraphQLError | GadgetError)[];\n  /**\n   * An error encountered when trying to communicate with the backend from the client. Includes things like connection timeouts, connection interrupts, or no internet connection errors\n   **/\n  public networkError?: Error;\n\n  /**\n   * A list of errors encountered by the backend when processing a request. Populated if the client successfully communicated with the backend, but the backend was unable to process the request and rejected it with an error.\n   * Includes GraphQL syntax errors, missing or invalid argument errors, data validation errors, or unexpected errors encountered when running backend logic.\n   *\n   * This property allows this object to match the interface of urql's `CombinedError` object.\n   *\n   * @deprecated use `executionErrors` instead for a list of the errors that the GraphQL backend API returned *and* client side errors from unexpected responses.\n   **/\n  public graphQLErrors: GraphQLError[];\n\n  /**\n   * The response from the server, if any was retrieved.\n   */\n  public response?: any;\n\n  constructor({\n    networkError,\n    executionErrors,\n    response,\n  }: {\n    networkError?: Error;\n    executionErrors?: Array<string | Partial<GraphQLError> | Error>;\n    validationErrors?: InvalidFieldError[];\n    response?: any;\n  }) {\n    const normalizedExecutionErrors = (executionErrors || []).map(rehydrateGraphQlError);\n    const message = generateErrorMessage(networkError, normalizedExecutionErrors);\n\n    super(message);\n\n    this.message = message;\n    this.executionErrors = normalizedExecutionErrors;\n    this.graphQLErrors = normalizedExecutionErrors;\n    this.networkError = networkError;\n    this.response = response;\n  }\n\n  /** Class name of this error -- always `ErrorWrapper` */\n  get name() {\n    return \"ErrorWrapper\";\n  }\n\n  toString() {\n    return this.message;\n  }\n\n  /**\n   * A list of errors the backend reported for specific fields being invalid for the records touched by an action. Is a shortcut for accessing the validation errors of a `GadgetInvalidRecordError` if that's what is in the `executionErrors`.\n   **/\n  public get validationErrors(): InvalidFieldError[] | null {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n    const firstInvalidRecordError = this.executionErrors.find((err) => (err as any).code == \"GGT_INVALID_RECORD\") as\n      | InvalidRecordError\n      | undefined;\n\n    return firstInvalidRecordError?.validationErrors ?? null;\n  }\n}\n\ninterface QueryPlan {\n  variables: any;\n  query: string;\n}\n\ninterface QueryOptions {\n  context?: Partial<OperationContext>;\n  pause?: boolean;\n  requestPolicy?: RequestPolicy;\n  suspense?: boolean;\n}\n\n/**\n * Generate the args for an `urql` useQuery hook, applying Gadget's defaults\n *\n * Gadget's React hooks support using the `suspense: true` option to enable React Suspense selectively per query. This means suspense is on at the client level, and then disabled by default for each hook until you opt in with `suspense: true`. This differs from urql, which has suspense on for hooks by default when it is enabled at the client level. So, this hook applies Gadget's (we think better) default to turn suspense off for each hook until you opt in, even when enabled at the client level.\n */\nexport const useMemoizedQueryOptions = <Options extends QueryOptions>(options?: Options): Options => {\n  const { context: _context, suspense: _suspense, ...rest } = options ?? {};\n\n  // use a memo as urql rerenders on context identity changes\n  const context = useMemo(() => {\n    return {\n      suspense: !!options?.suspense,\n      ...options?.context,\n    };\n  }, [options?.suspense, options?.context]);\n\n  return {\n    ...rest,\n    context,\n  } as unknown as Options;\n};\n\n/**\n * Given a plan from a gadget query plan generator, create the query options object to pass to `urql`'s `useQuery` hook\n **/\nexport const useQueryArgs = <Plan extends QueryPlan, Options extends QueryOptions>(plan: Plan, options?: Options): UseQueryArgs => ({\n  query: plan.query,\n  variables: plan.variables,\n  ...options,\n});\n\nexport type OptionsType = {\n  [key: string]: any;\n  /** What fields to select from the resulting object */\n  select?: FieldSelection;\n  /** Subscribe to changes from the backend and return a new result as it changes */\n  live?: boolean;\n};\n\n/**\n * Processes the flexible, convenient JS-land inputs for an action to the fully qualified GraphQL API inputs\n * @internal */\nexport const disambiguateActionVariables = (\n  action: ActionFunction<any, any, any, any, any> | BulkActionFunction<any, any, any, any, any>,\n  variables: Record<string, any> | undefined\n) => {\n  variables ??= {};\n  if (action.hasAmbiguousIdentifier) {\n    if (\n      Object.keys(variables).some((key) => key !== \"id\" && !action.paramOnlyVariables?.includes(key) && key !== action.modelApiIdentifier)\n    ) {\n      throw Error(`Invalid arguments found in variables. Did you mean to use ({ ${action.modelApiIdentifier}: { ... } })?`);\n    }\n  }\n\n  let newVariables: Record<string, any>;\n\n  if (action.acceptsModelInput ?? action.hasCreateOrUpdateEffect) {\n    if (\n      action.modelApiIdentifier in variables &&\n      typeof variables[action.modelApiIdentifier] === \"object\" &&\n      variables[action.modelApiIdentifier] != null\n    ) {\n      newVariables = variables;\n    } else {\n      newVariables = {\n        [action.modelApiIdentifier]: {},\n      };\n      for (const [key, value] of Object.entries(variables)) {\n        if (action.paramOnlyVariables?.includes(key)) {\n          newVariables[key] = value;\n        } else {\n          if (key == \"id\") {\n            newVariables.id = value;\n          } else {\n            newVariables[action.modelApiIdentifier][key] = value;\n          }\n        }\n      }\n    }\n  } else {\n    newVariables = variables;\n  }\n\n  return newVariables;\n};\n\n/**\n * Get a list of path segments from a dot-separated path\n */\nconst pathToPathArray = (path: string | string[]) => {\n  // Check if path is string or array. Regex : ensure that we do not have '.' and brackets.\n  // Regex explained: https://regexr.com/58j0k\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return Array.isArray(path) ? path : path.match(/([^[.\\]])+/g)!;\n};\n\n/**\n * Get a dot-separated path from an object\n * From https://youmightnotneed.com/lodash\n */\nexport const get = (obj: any, path: string | string[]) => {\n  if (!path) return undefined;\n  return pathToPathArray(path).reduce((prevObj, key) => prevObj && prevObj[key], obj);\n};\n\n/**\n * Set a dot-separated path to a value on an object\n * From https://youmightnotneed.com/lodash\n */\nexport const set = (obj: any, path: string, value: any) => {\n  const pathArray = pathToPathArray(path);\n  pathArray.reduce((acc, key, i) => {\n    if (acc[key] === undefined) acc[key] = {};\n    if (i === pathArray.length - 1) acc[key] = value;\n    return acc[key];\n  }, obj);\n};\n\nexport function hasNested(data: any) {\n  if (data == null) {\n    return false;\n  }\n\n  return Object.values(data).some((value) => {\n    return typeof value === \"object\" && value !== undefined && Array.isArray(value);\n  });\n}\n\nexport async function transformDataRedux(modelManager: AnyModelManager | undefined, defaultValues: any, data: any) {\n  const referencedTypes = await modelManager?.connection.getCurrentModels();\n  console.log(\"referencedTypes\", JSON.stringify(referencedTypes, null, 2));\n\n  if (!referencedTypes) {\n    throw new Error(\"No referenced types found\");\n  }\n\n  console.log(\"defaultValues\", JSON.stringify(defaultValues, null, 2));\n  console.log(\"data\", JSON.stringify(data, null, 2));\n  const updates = getUpdates(defaultValues);\n\n  function transform(\n    input: any,\n    updates: Record<string, number[]>,\n    depth = 0,\n    path: string | undefined = undefined,\n    fieldType: { type: string; model: string } | null = null,\n    fieldRelationships: Record<string, { type: string; model: string }> | null = null\n  ): any {\n    if (Array.isArray(input)) {\n      const results: any[] = [];\n      const edge = updates[path!];\n      const handled: number[] = [];\n\n      if (edge) {\n        results.push(\n          edge.map((nodeId: any, nodeIndex: number) => {\n            const item = input.find((item: any) => item.id == nodeId);\n\n            if (!item) {\n              const updateEntries = Object.entries(updates);\n              const updateEntry = updateEntries.find(([key, _ids]) => key.includes(path! + \".\" + nodeIndex));\n              if (updateEntry) {\n                const { 0: updatePath, 1: _ } = updateEntry;\n                delete updates[updatePath];\n              }\n              return { delete: { id: nodeId } };\n            } else {\n              const index = input.findIndex((item: any) => item.id == nodeId);\n\n              handled.push(index);\n\n              const currentPath = path ? `${path}.${index}` : index.toString();\n              return transform(item, updates, depth + 1, currentPath, fieldType, fieldRelationships);\n            }\n          })\n        );\n      }\n\n      // handle the rest of the array\n      results.push(\n        input\n          .filter((_item, index) => !handled.includes(index))\n          .map((item: any, index) => {\n            const currentPath = path ? `${path}.${index}` : index.toString();\n            return transform(item, updates, depth + 1, currentPath, fieldType, fieldRelationships);\n          })\n      );\n\n      return results.flatMap((result) => result);\n    } else if (input != null && typeof input === \"object\") {\n      const result: any = {};\n\n      for (const key of Object.keys(input)) {\n        const currentPath = path ? `${path}.${key}` : key;\n\n        const fieldType = fieldRelationships ? fieldRelationships[key] : null;\n        const relationships = fieldType ? referencedTypes?.[fieldType.model] : referencedTypes?.[key];\n\n        result[key] = transform(input[key], updates, depth + 1, currentPath, fieldType, relationships as any);\n      }\n\n      const { __typename, ...rest } = result;\n\n      let belongsTo = null;\n      const belongsToRelationships: Record<string, { type: string; model: string }> | null = fieldRelationships\n        ? Object.entries(fieldRelationships)\n            .filter(([_key, value]) => value.type === \"BelongsTo\")\n            .reduce((obj, [key, value]) => {\n              obj[key] = value;\n              return obj;\n            }, {} as Record<string, { type: string; model: string }>)\n        : null;\n\n      for (const key of Object.keys(belongsToRelationships ?? {})) {\n        // TODO - handle multiple ambiguous identifiers\n        if (`${key}Id` in input) {\n          if (belongsTo == null) {\n            belongsTo = {};\n          }\n\n          belongsTo = { ...belongsTo, [key]: { _link: input[`${key}Id`] } };\n          delete rest[`${key}Id`];\n        }\n      }\n\n      if (belongsTo) {\n        return depth <= 1 ? { ...rest, ...belongsTo } : { ...rest, create: { ...belongsTo } };\n      }\n\n      if (depth <= 1) {\n        return { ...rest };\n      }\n\n      if (fieldType == null) {\n        throw new Error(\n          `Can't transform input, no field type found. ${JSON.stringify(\n            {\n              input,\n              path,\n              referencedTypes,\n            },\n            null,\n            2\n          )}`\n        );\n      }\n\n      const inputHasId = \"id\" in input;\n\n      switch (fieldType.type) {\n        case \"HasMany\":\n        case \"HasOne\":\n          return inputHasId ? { update: { ...rest } } : { create: { ...rest } };\n        case \"BelongsTo\":\n          return inputHasId ? { _link: input[\"id\"] } : { create: { ...rest } };\n        default:\n          throw new Error(\n            `Can't transform input, Unknown field type ${fieldType}. ${JSON.stringify(\n              {\n                input,\n                path,\n                referencedTypes,\n              },\n              null,\n              2\n            )}`\n          );\n      }\n    }\n\n    return input;\n  }\n\n  const result = transform(data, updates);\n\n  // console.log(\"transformedData\", JSON.stringify(result, null, 2));\n\n  return result;\n}\n\nfunction getUpdates(data: any): Record<string, number[]> {\n  const updateList: Record<string, number[]> = {};\n\n  function go(input: any, path: string | undefined = undefined, depth = 0): any {\n    if (Array.isArray(input)) {\n      return input.map((item: any, index) => {\n        const currentPath = path ? `${path}.${index}` : index.toString();\n        return go(item, currentPath, depth + 1);\n      });\n    } else if (input !== undefined && input !== null && typeof input === \"object\") {\n      const result: any = {};\n\n      for (const key of Object.keys(input)) {\n        const currentPath = path ? `${path}.${key}` : key;\n        result[key] = go(input[key], currentPath, depth + 1);\n      }\n\n      if (depth > 1) {\n        const newPath = path?.substring(0, path.length - 2);\n\n        if (\"id\" in input) {\n          if (!updateList[newPath!]) {\n            updateList[newPath!] = [];\n          }\n\n          updateList[newPath!].push(input[\"id\"]);\n        }\n      }\n\n      return result;\n    }\n\n    return input;\n  }\n\n  go(data);\n  return updateList;\n}\n"]}