{"version":3,"file":"PolarisAutoBulkActionModal.js","sourceRoot":"","sources":["../../../../src/auto/polaris/PolarisAutoBulkActionModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Banner, Button, ButtonGroup, Modal, Spinner, Text } from \"@shopify/polaris\";\nimport React, { useCallback, useEffect, useMemo } from \"react\";\nimport { useBulkAction } from \"../../useBulkAction.js\";\nimport { TableRow } from \"../../useTableUtils/types.js\";\nimport { humanizeCamelCase } from \"../../utils.js\";\nimport { ModelActionDetails } from \"../hooks/useTableBulkActions.js\";\n\nexport const PolarisAutoBulkActionModal = (props: {\n  model: any;\n  modelActionDetails?: ModelActionDetails;\n  ids: string[];\n  selectedRows: TableRow[];\n}) => {\n  const { model, modelActionDetails, ids, selectedRows } = props;\n\n  const [showModal, setShowModal] = React.useState(!!modelActionDetails);\n  const [actionName, setActionName] = React.useState(modelActionDetails?.apiIdentifier);\n\n  useEffect(() => {\n    if (!modelActionDetails) {\n      return;\n    }\n    setShowModal(true);\n    setActionName(modelActionDetails.apiIdentifier);\n  }, [modelActionDetails]);\n\n  const actionIsLoaded = modelActionDetails && actionName;\n  const isBulkGadgetAction = actionIsLoaded && model[actionName] && modelActionDetails.isGadgetAction && modelActionDetails.isBulk;\n\n  const modalTitle = useMemo(() => humanizeCamelCase(actionName ?? \"\"), [actionName]);\n\n  const closeModal = useCallback(() => setShowModal(false), [setShowModal]);\n\n  if (!actionIsLoaded) {\n    return null;\n  }\n\n  return (\n    <>\n      <Modal onClose={() => setShowModal(false)} title={modalTitle} open={showModal}>\n        {isBulkGadgetAction ? (\n          <GadgetBulkActionModalContent model={model} modelActionDetails={modelActionDetails} ids={ids} close={closeModal} />\n        ) : (\n          <CustomBulkActionModalContent modelActionDetails={modelActionDetails} ids={ids} close={closeModal} selectedRows={selectedRows} />\n        )}\n      </Modal>\n    </>\n  );\n};\n\n/**\n * Modal content for executing Gadget bulk actions\n */\nconst GadgetBulkActionModalContent = (props: { model: any; modelActionDetails: ModelActionDetails; ids: string[]; close: () => void }) => {\n  const { model, modelActionDetails, ids, close } = props;\n\n  const [hasRun, setHasRun] = React.useState(false);\n\n  // eslint-disable-next-line\n  // @ts-ignore:next-line\n  const [{ fetching, data, error }, runBulkAction] = useBulkAction(model[modelActionDetails.apiIdentifier], {});\n\n  const hasError = !!(error || (data && (data as any).success === false));\n  const errorMessage = error\n    ? error.message\n    : data && (data as any)?.success === false\n    ? (data as any)?.errors?.map((e: { message: string }) => e.message).join(\", \")\n    : \"\";\n\n  const actionResultBanner = useMemo(\n    () => (hasError ? <Banner title={errorMessage} tone=\"critical\" /> : <Banner title={ActionSuccessMessage} tone=\"success\" />),\n    [hasError, errorMessage]\n  );\n\n  const runAction = useCallback(() => {\n    void runBulkAction(ids);\n    setHasRun(true);\n  }, [runBulkAction, ids]);\n\n  return (\n    <>\n      <Modal.Section>\n        {fetching && <CenteredSpinner />}\n        {!fetching && (hasRun ? actionResultBanner : <RunActionConfirmationText count={ids.length} />)}\n      </Modal.Section>\n      <Modal.Section>\n        <div style={{ float: \"right\", paddingBottom: \"16px\" }}>\n          <ButtonGroup>\n            <Button variant=\"secondary\" onClick={close}>\n              Close\n            </Button>\n            {((!hasError && !hasRun) || fetching) && (\n              <Button variant=\"primary\" onClick={runAction} loading={fetching}>\n                Run\n              </Button>\n            )}\n          </ButtonGroup>\n        </div>\n      </Modal.Section>\n    </>\n  );\n};\n\nconst CenteredSpinner = () => (\n  <div style={{ textAlign: \"center\" }}>\n    <Spinner accessibilityLabel=\"Spinner example\" size=\"large\" />\n  </div>\n);\n\nconst ActionCompletedMessage = `Action completed`;\nconst ActionSuccessMessage = `${ActionCompletedMessage} successfully`;\n\nconst CustomBulkActionModalContent = (props: {\n  modelActionDetails: ModelActionDetails;\n  ids: string[];\n  close: () => void;\n  selectedRows: TableRow[];\n}) => {\n  const { modelActionDetails, ids, selectedRows, close } = props;\n\n  if (modelActionDetails.isGadgetAction) {\n    throw new Error(`Custom callback \"${modelActionDetails.apiIdentifier}\" is invalid`);\n  }\n\n  if (!modelActionDetails.render) {\n    throw new Error(`Failed to render custom bulk action modal content. Property \"render\" must be provided`);\n  }\n\n  return (\n    <>\n      <Modal.Section>{modelActionDetails.render(ids, selectedRows)}</Modal.Section>\n      <Modal.Section>\n        <div style={{ float: \"right\", paddingBottom: \"16px\" }}>\n          <ButtonGroup>\n            <Button variant=\"secondary\" onClick={close}>\n              Close\n            </Button>\n          </ButtonGroup>\n        </div>\n      </Modal.Section>\n    </>\n  );\n};\n\nconst RunActionConfirmationText = (props: { count: number }) => {\n  const { count } = props;\n  return useMemo(\n    () => <Text as=\"p\">{`Are you sure you want to run this action on ${count} record${count === 1 ? \"\" : `s`}?`}</Text>,\n    [count]\n  );\n};\n"]}