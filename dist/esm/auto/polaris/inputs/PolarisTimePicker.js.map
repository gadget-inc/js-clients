{"version":3,"file":"PolarisTimePicker.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisTimePicker.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { TextFieldProps } from \"@shopify/polaris\";\nimport { Box, Icon, Listbox, Popover, Scrollable, TextField } from \"@shopify/polaris\";\nimport { ClockIcon } from \"@shopify/polaris-icons\";\nimport { zonedTimeToUtc } from \"date-fns-tz\";\nimport React, { useState } from \"react\";\nimport type { ControllerRenderProps, FieldValues } from \"react-hook-form\";\nimport { copyTime, getDateFromDateTimeObject, getDateTimeObjectFromDate } from \"./PolarisDateTimePicker.js\";\n\nconst createMarkup = (items: string[], selectedState: string) => {\n  return items.map((item, i) => {\n    return (\n      <div key={i} style={{ textAlign: \"center\", cursor: \"default\", padding: \"0px 4px\" }}>\n        <Listbox.Option value={item}>\n          {selectedState.padStart(2, \"0\") === item.padStart(2, \"0\") ? (\n            <Box padding=\"100\" background=\"bg-surface-secondary-selected\" borderRadius=\"200\" minHeight=\"30px\" minWidth=\"30px\">\n              {item}\n            </Box>\n          ) : (\n            <Box minHeight=\"30px\" minWidth=\"30px\" padding=\"100\">\n              {item}\n            </Box>\n          )}\n        </Listbox.Option>\n      </div>\n    );\n  });\n};\n\nconst getTimeString = (dateTime: DateTimeState) => {\n  return `${dateTime.hour}:${dateTime.minute.padStart(2, \"0\")} ${dateTime.ampm}`;\n};\n\nconst hoursArr = Array.from({ length: 12 }, (_, i) => (i + 1).toString().padStart(2, \"0\"));\nconst minsArr = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, \"0\"));\nconst ampmArr = [\"AM\", \"PM\"];\n\nconst timeFormatRegex = new RegExp(/((1[0-2]|0?[1-9]):([0-5][0-9]) ?([AaPp][Mm]))/);\n\nexport interface DateTimeState {\n  month: number;\n  year: number;\n  day: number;\n  hour: string;\n  minute: string;\n  ampm: string;\n}\n\nconst PolarisTimePicker = (props: {\n  fieldProps: ControllerRenderProps<FieldValues, string>;\n  onChange?: (value: Date) => void;\n  localTime?: Date;\n  id?: string;\n  timeLabel?: string;\n  timePickerProps?: Partial<TextFieldProps>;\n  hideTimePopover?: boolean;\n  localTz?: string;\n}) => {\n  const [timeString, setTimeString] = useState(\n    props.fieldProps.value ? getTimeString(getDateTimeObjectFromDate(props.fieldProps.value)) : \"\"\n  );\n  const [timePopoverActive, setTimePopoverActive] = useState(false);\n  const [timeParseError, setTimeParseError] = useState(false);\n  const setHourSelected = (hour: string) =>\n    props.fieldProps.onChange(getDateFromDateTimeObject({ ...getDateTimeObjectFromDate(props.fieldProps.value), hour }));\n  const setMinSelected = (minute: string) =>\n    props.fieldProps.onChange(getDateFromDateTimeObject({ ...getDateTimeObjectFromDate(props.fieldProps.value), minute }));\n  const setAmpmSelected = (ampm: string) =>\n    props.fieldProps.onChange(getDateFromDateTimeObject({ ...getDateTimeObjectFromDate(props.fieldProps.value), ampm }));\n\n  const onTimeStringChange = (value: string) => {\n    setTimeString(value);\n    const trimmedValue = value.trim();\n\n    const result = timeFormatRegex.test(trimmedValue);\n\n    if (!result) {\n      setTimeParseError(true);\n      return;\n    }\n\n    setTimeParseError(false);\n\n    let hours = parseInt(trimmedValue.split(\":\")[0], 10);\n    const minutes = parseInt(trimmedValue.split(\":\")[1], 10);\n    const newAmpm = trimmedValue.slice(-2).toUpperCase();\n    const hoursStr = hours.toString();\n    const paddedMins = minutes.toString().padStart(2, \"0\");\n    setHourSelected(hoursStr);\n    setMinSelected(paddedMins);\n    setAmpmSelected(newAmpm);\n\n    const parsedDate = new Date();\n    if (newAmpm === \"PM\" && hours < 12) {\n      hours += 12;\n    } else if (newAmpm === \"AM\" && hours === 12) {\n      hours = 0;\n    }\n\n    parsedDate.setHours(hours, minutes, 0, 0);\n    const date = props.localTime ? new Date(props.localTime) : new Date();\n\n    copyTime(date, parsedDate);\n\n    props.onChange?.(zonedTimeToUtc(date, props.localTz ?? \"UTC\"));\n    props.fieldProps.onChange(zonedTimeToUtc(date, props.localTz ?? \"UTC\"));\n\n    setTimeString(`${hoursStr}:${paddedMins} ${newAmpm}`);\n  };\n  return (\n    <>\n      <Popover\n        active={timePopoverActive}\n        onClose={() => setTimePopoverActive(false)}\n        activator={\n          <TextField\n            prefix={<Icon source={ClockIcon} />}\n            id={props.id ? `${props.id}-time` : undefined}\n            data-testid={props.id ? `${props.id}-time` : undefined}\n            label={props.timeLabel ?? \"Time\"}\n            autoComplete=\"off\"\n            value={timeString}\n            onChange={onTimeStringChange}\n            onFocus={() => setTimePopoverActive(true)}\n            error={timeParseError && `Invalid time format`}\n            {...props.timePickerProps}\n          />\n        }\n      >\n        {!props.hideTimePopover && (\n          <div style={{ overflow: \"hidden\", padding: \"15px 8px\" }}>\n            <div style={{ display: \"flex\" }}>\n              <Scrollable style={{ overflowY: \"scroll\", height: \"250px\" }}>\n                <Listbox\n                  onSelect={(value: string) =>\n                    onTimeStringChange(\n                      `${value}:${getDateTimeObjectFromDate(props.fieldProps.value).minute.toString().padStart(2, \"0\")} ${\n                        getDateTimeObjectFromDate(props.fieldProps.value).ampm\n                      }`\n                    )\n                  }\n                >\n                  {createMarkup(\n                    hoursArr,\n                    props.fieldProps.value ? getDateTimeObjectFromDate(props.fieldProps.value).hour.toString() : hoursArr[0]\n                  )}\n                </Listbox>\n              </Scrollable>\n              <div style={{ overflowY: \"scroll\", height: \"250px\" }}>\n                <Listbox\n                  onSelect={(value: string) =>\n                    onTimeStringChange(\n                      `${getDateTimeObjectFromDate(props.fieldProps.value).hour}:${value.padStart(2, \"0\")} ${\n                        getDateTimeObjectFromDate(props.fieldProps.value).ampm\n                      }`\n                    )\n                  }\n                >\n                  {createMarkup(\n                    minsArr,\n                    props.fieldProps.value\n                      ? getDateTimeObjectFromDate(props.fieldProps.value).minute.toString().padStart(2, \"0\")\n                      : minsArr[0]\n                  )}\n                </Listbox>\n              </div>\n              <div style={{ overflowY: \"scroll\", height: \"250px\" }}>\n                <Listbox\n                  onSelect={(value: string) =>\n                    onTimeStringChange(\n                      `${getDateTimeObjectFromDate(props.fieldProps.value).hour}:${getDateTimeObjectFromDate(props.fieldProps.value)\n                        .minute.toString()\n                        .padStart(2, \"0\")} ${value}`\n                    )\n                  }\n                >\n                  {createMarkup(ampmArr, props.fieldProps.value ? getDateTimeObjectFromDate(props.fieldProps.value).ampm : ampmArr[0])}\n                </Listbox>\n              </div>\n            </div>\n          </div>\n        )}\n      </Popover>\n    </>\n  );\n};\n\nexport default PolarisTimePicker;\n"]}