{"version":3,"file":"PolarisAutoHasManyThroughForm.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris/inputs/relationships/PolarisAutoHasManyThroughForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AutoSelection, BlockStack, Box, Button, Icon, InlineGrid, InlineStack, Listbox, Text } from \"@shopify/polaris\";\nimport { PlusIcon, XCircleIcon } from \"@shopify/polaris-icons\";\nimport React, { useState } from \"react\";\nimport { useHasManyThroughForm } from \"../../../../useHasManyThroughForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport { getRecordAsOption } from \"../../../hooks/useRelatedModel.js\";\nimport type { AutoHasManyThroughFormProps, DisplayedRecordOption } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { RelatedModelOptionsPopover, RelatedModelOptionsSearch } from \"./RelatedModelOptions.js\";\nimport { renderOptionLabel } from \"./utils.js\";\n\nexport const PolarisAutoHasManyThroughForm = autoRelationshipForm((props: AutoHasManyThroughFormProps) => {\n  const [addingSibling, setAddingSibling] = useState(false);\n  const {\n    append,\n    remove,\n    joinRecords,\n    listboxId,\n    pathPrefix,\n    metaDataPathPrefix,\n    recordLabel,\n    siblingModelName,\n    siblingRecordsLoading,\n    siblingRecords,\n    siblingPagination,\n    search,\n    joinModelField,\n    joinModelApiIdentifier,\n    siblingModelOptions,\n    inverseRelatedModelField,\n    fieldArray,\n  } = useHasManyThroughForm(props);\n\n  return (\n    <BlockStack gap=\"300\">\n      <InlineGrid columns=\"1fr auto\" alignItems=\"center\">\n        {props.label ?? (\n          <Text as=\"h2\" variant=\"headingSm\">\n            {siblingModelName}\n          </Text>\n        )}\n        <RelatedModelOptionsPopover\n          active={addingSibling}\n          activator={\n            <Button onClick={() => setAddingSibling((prev) => !prev)} disclosure>\n              Add {siblingModelName ?? \"related model\"}\n            </Button>\n          }\n          onClose={() => setAddingSibling(false)}\n          onScrolledToBottom={siblingPagination.loadNextPage}\n          search={\n            <RelatedModelOptionsSearch modelName={siblingModelName} value={search.value} onChange={search.set} ariaControls={listboxId} />\n          }\n          options={siblingModelOptions}\n          records={siblingRecords}\n          onSelect={(record) => {\n            inverseRelatedModelField && append({ [inverseRelatedModelField]: { ...record, _link: record.id } });\n          }}\n          isLoading={siblingRecordsLoading}\n          autoSelection={AutoSelection.None}\n          renderOption={(option) => <SiblingOption option={option} />}\n        />\n      </InlineGrid>\n\n      {joinRecords.length > 0 ? (\n        <BlockStack as=\"ul\" gap=\"300\">\n          {joinRecords.map(([fieldKey, idx, record]) => {\n            const siblingRecord = inverseRelatedModelField && record[inverseRelatedModelField];\n\n            const siblingOption = getRecordAsOption(siblingRecord, {\n              primary: recordLabel.primary,\n              secondary: recordLabel.secondary,\n              tertiary: recordLabel.tertiary,\n            });\n\n            return (\n              <Box key={fieldKey}>\n                <InlineGrid columns=\"1fr auto\" alignItems=\"center\">\n                  <Box borderColor=\"border\" borderWidth=\"025\" borderRadius=\"200\">\n                    <div style={{ display: \"flex\", padding: \"8px\" }}>\n                      <Box>\n                        <InlineStack gap=\"200\">\n                          {renderOptionLabel(siblingOption.primary, \"primary\")}\n                          {siblingOption?.tertiary && renderOptionLabel(siblingOption.tertiary, \"tertiary\")}\n                        </InlineStack>\n                        {siblingOption?.secondary && renderOptionLabel(siblingOption.secondary, \"secondary\")}\n                      </Box>\n                      <div style={{ marginLeft: \"auto\", alignSelf: \"center\", height: \"100%\" }}>\n                        <Button\n                          id={`deleteButton_${pathPrefix}.${idx}`}\n                          variant=\"tertiary\"\n                          icon={XCircleIcon}\n                          onClick={() => remove(idx)}\n                        ></Button>\n                      </div>\n                    </div>\n                    {props.children && (\n                      <Box borderColor=\"border\" borderBlockStartWidth=\"025\">\n                        <Box padding=\"200\">\n                          <RelationshipContext.Provider\n                            value={{\n                              transformPath: (path) => `${joinModelField}.${idx}.${path.replace(`${joinModelApiIdentifier}.`, \"\")}`,\n                              transformMetadataPath: (path) => `${metaDataPathPrefix}.${path}`,\n                              fieldArray,\n                              hasManyThrough: { joinModelApiIdentifier, inverseRelatedModelField },\n                            }}\n                          >\n                            {props.children}\n                          </RelationshipContext.Provider>\n                        </Box>\n                      </Box>\n                    )}\n                  </Box>\n                </InlineGrid>\n              </Box>\n            );\n          })}\n        </BlockStack>\n      ) : (\n        <Box borderColor=\"border\" borderWidth=\"025\" borderRadius=\"200\">\n          <Box padding=\"300\">\n            <InlineStack align=\"center\">\n              <Text as=\"p\" variant=\"bodyMd\" tone=\"subdued\">\n                No {siblingModelName} yet\n              </Text>\n            </InlineStack>\n          </Box>\n        </Box>\n      )}\n    </BlockStack>\n  );\n});\n\nconst SiblingOption = (props: { option: DisplayedRecordOption }) => {\n  const { option } = props;\n\n  return (\n    <Listbox.Action key={option.id} value={option.id}>\n      <div style={{ display: \"flex\", gap: \"200\", width: \"100%\" }}>\n        <BlockStack gap=\"050\">\n          {renderOptionLabel(option.primary, \"primary\")}\n          {option.secondary && renderOptionLabel(option.secondary, \"secondary\")}\n        </BlockStack>\n        <div style={{ marginLeft: \"auto\", alignSelf: \"center\" }}>\n          <Icon source={PlusIcon} />\n        </div>\n      </div>\n    </Listbox.Action>\n  );\n};\n"]}