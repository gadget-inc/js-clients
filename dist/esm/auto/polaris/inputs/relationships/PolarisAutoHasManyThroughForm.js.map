{"version":3,"file":"PolarisAutoHasManyThroughForm.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris/inputs/relationships/PolarisAutoHasManyThroughForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AutoSelection, BlockStack, Box, Button, Icon, InlineGrid, InlineStack, Listbox, Text } from \"@shopify/polaris\";\nimport { PlusIcon, XCircleIcon } from \"@shopify/polaris-icons\";\nimport React, { useState } from \"react\";\nimport { useHasManyThroughForm } from \"../../../../useHasManyThroughForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport { getRecordAsOption } from \"../../../hooks/useRelatedModel.js\";\nimport type { Option, OptionLabel } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { RelatedModelOptionsPopover, RelatedModelOptionsSearch } from \"./RelatedModelOptions.js\";\nimport { renderOptionLabel } from \"./utils.js\";\n\nexport const PolarisAutoHasManyThroughForm = autoRelationshipForm(\n  (props: {\n    field: string;\n    label?: React.ReactNode;\n    children: React.ReactNode;\n    primaryLabel?: OptionLabel;\n    secondaryLabel?: OptionLabel;\n    tertiaryLabel?: OptionLabel;\n  }) => {\n    const [addingSibling, setAddingSibling] = useState(false);\n    const {\n      append,\n      remove,\n      joinRecords,\n      primaryLabel,\n      hasChildForm,\n      listboxId,\n      pathPrefix,\n      metaDataPathPrefix,\n      siblingModelName,\n      siblingRecordsLoading,\n      siblingRecords,\n      siblingPagination,\n      search,\n      joinModelField,\n      joinModelApiIdentifier,\n      siblingModelOptions,\n      inverseRelatedModelField,\n      fieldArray,\n    } = useHasManyThroughForm(props);\n\n    return (\n      <BlockStack gap=\"200\">\n        <InlineGrid columns=\"1fr auto\">\n          {props.label ?? (\n            <Text as=\"h2\" variant=\"headingSm\">\n              {siblingModelName}\n            </Text>\n          )}\n          <RelatedModelOptionsPopover\n            active={addingSibling}\n            activator={\n              <Button onClick={() => setAddingSibling((prev) => !prev)} disclosure>\n                Add {siblingModelName ?? \"related model\"}\n              </Button>\n            }\n            onClose={() => setAddingSibling(false)}\n            onScrolledToBottom={siblingPagination.loadNextPage}\n            search={\n              <RelatedModelOptionsSearch modelName={siblingModelName} value={search.value} onChange={search.set} ariaControls={listboxId} />\n            }\n            options={siblingModelOptions}\n            records={siblingRecords}\n            onSelect={(record) => {\n              inverseRelatedModelField && append({ [inverseRelatedModelField]: { ...record, _link: record.id } });\n            }}\n            isLoading={siblingRecordsLoading}\n            autoSelection={AutoSelection.None}\n            renderOption={(option) => <SiblingOption option={option} />}\n          />\n        </InlineGrid>\n\n        {joinRecords.length > 0 ? (\n          <BlockStack as=\"ul\">\n            {joinRecords.map(([fieldKey, idx, record]) => {\n              const siblingRecord = inverseRelatedModelField && record[inverseRelatedModelField];\n\n              const siblingOption = getRecordAsOption(siblingRecord, primaryLabel, props.secondaryLabel, props.tertiaryLabel);\n\n              return (\n                <Box key={fieldKey} padding=\"300\">\n                  <InlineGrid columns=\"1fr auto\" gap=\"200\" alignItems=\"center\">\n                    <Box borderColor=\"border\" borderWidth=\"025\" borderRadius=\"200\">\n                      <div style={{ display: \"flex\", padding: \"8px\" }}>\n                        <Box>\n                          <InlineStack gap=\"200\">\n                            {renderOptionLabel(siblingOption.label, \"primary\")}\n                            {siblingOption?.tertiaryLabel && renderOptionLabel(siblingOption.tertiaryLabel, \"tertiary\")}\n                          </InlineStack>\n                          {siblingOption?.secondaryLabel && renderOptionLabel(siblingOption.secondaryLabel, \"secondary\")}\n                        </Box>\n                        <div style={{ marginLeft: \"auto\", alignSelf: \"center\" }}>\n                          <Button\n                            id={`deleteButton_${pathPrefix}.${idx}`}\n                            variant=\"tertiary\"\n                            icon={XCircleIcon}\n                            onClick={() => remove(idx)}\n                          />\n                        </div>\n                      </div>\n                      {hasChildForm && (\n                        <Box borderColor=\"border\" borderBlockStartWidth=\"025\">\n                          <Box padding=\"200\">\n                            <RelationshipContext.Provider\n                              value={{\n                                transformPath: (path) => `${joinModelField}.${idx}.${path.replace(`${joinModelApiIdentifier}.`, \"\")}`,\n                                transformMetadataPath: (path) => `${metaDataPathPrefix}.${path}`,\n                                fieldArray,\n                                hasManyThrough: { joinModelApiIdentifier, inverseRelatedModelField },\n                              }}\n                            >\n                              {props.children}\n                            </RelationshipContext.Provider>\n                          </Box>\n                        </Box>\n                      )}\n                    </Box>\n                  </InlineGrid>\n                </Box>\n              );\n            })}\n          </BlockStack>\n        ) : (\n          <Box borderColor=\"border\" borderWidth=\"025\" borderRadius=\"200\">\n            <Box padding=\"300\">\n              <InlineStack align=\"center\">\n                <Text as=\"p\" variant=\"bodyMd\" tone=\"subdued\">\n                  No {siblingModelName} yet\n                </Text>\n              </InlineStack>\n            </Box>\n          </Box>\n        )}\n      </BlockStack>\n    );\n  }\n);\n\nconst SiblingOption = (props: { option: Option }) => {\n  const { option } = props;\n\n  return (\n    <Listbox.Action key={option.id} value={option.id}>\n      <div style={{ display: \"flex\", gap: \"200\", width: \"100%\" }}>\n        <BlockStack gap=\"050\">\n          {renderOptionLabel(option.label, \"primary\")}\n          {option.secondaryLabel && renderOptionLabel(option.secondaryLabel, \"secondary\")}\n        </BlockStack>\n        <div style={{ marginLeft: \"auto\", alignSelf: \"center\" }}>\n          <Icon source={PlusIcon} />\n        </div>\n      </div>\n    </Listbox.Action>\n  );\n};\n"]}