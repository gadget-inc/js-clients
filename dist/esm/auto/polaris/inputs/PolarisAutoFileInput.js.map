{"version":3,"file":"PolarisAutoFileInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisAutoFileInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { DropZoneProps } from \"@shopify/polaris\";\nimport { Box, Button, DropZone, InlineError, InlineStack, Thumbnail } from \"@shopify/polaris\";\nimport { DeleteIcon, NoteIcon } from \"@shopify/polaris-icons\";\nimport React, { useMemo } from \"react\";\nimport { isAutoFileFieldValue } from \"../../../validationSchema.js\";\nimport { autoInput } from \"../../AutoInput.js\";\nimport { imageFileTypes, useFileInputController } from \"../../hooks/useFileInputController.js\";\nimport { type AutoFileInputProps } from \"../../shared/AutoInputTypes.js\";\n\nexport type PolarisAutoFileInputProps = AutoFileInputProps & Omit<DropZoneProps, \"allowMultiple\">;\n\n/**\n * A file input within AutoForm.\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoFileInput field=\"fileField\" />\n * </AutoForm>\n * ```\n * @param props.field - The API identifier of the File field.\n * @param props.label - Label of the File input.\n * @param props.onChange - Called when the file input changes.\n * @returns The AutoFileInput component.\n */\nexport const PolarisAutoFileInput = autoInput((props: PolarisAutoFileInputProps) => {\n  const { field: fieldApiIdentifier, control, ...rest } = props;\n\n  const {\n    fieldProps,\n    errorMessage,\n    imageThumbnailURL,\n    onFileUpload,\n    clearFileValue,\n    canClearFileValue,\n    validations,\n    metadata,\n    actionHintParts,\n  } = useFileInputController({\n    field: fieldApiIdentifier,\n    control,\n  });\n\n  const fileUploadContainer = useMemo(() => {\n    if (!actionHintParts) {\n      return null;\n    }\n\n    return <DropZone.FileUpload actionTitle=\"Add file\" actionHint={actionHintParts.length === 1 ? \"\" : actionHintParts.join(\" \")} />;\n  }, [actionHintParts]);\n\n  const filePreview = useMemo(() => {\n    const value = fieldProps.value;\n    if (!value || !isAutoFileFieldValue(value)) return null;\n\n    return (\n      <Box padding=\"100\" paddingInlineEnd={\"400\"}>\n        <InlineStack align=\"space-between\" gap=\"400\">\n          <InlineStack gap=\"200\" blockAlign=\"center\">\n            <Thumbnail\n              size=\"small\"\n              alt={value.fileName}\n              source={imageThumbnailURL && [...imageFileTypes, \"image/gif\"].includes(value.mimeType) ? imageThumbnailURL : NoteIcon}\n            />\n            <div>\n              {value.$uploading ? \"(Uploading) \" : \"\"}\n              {value.fileName}\n            </div>\n          </InlineStack>\n          {canClearFileValue && (\n            <Button\n              icon={DeleteIcon}\n              variant=\"plain\"\n              accessibilityLabel=\"Delete file\"\n              onPointerDown={() => {\n                clearFileValue();\n              }}\n              id={`clear-file-${fieldApiIdentifier}`}\n            />\n          )}\n        </InlineStack>\n      </Box>\n    );\n  }, [canClearFileValue, clearFileValue, fieldApiIdentifier, fieldProps.value, imageThumbnailURL]);\n\n  const inputLabel = props.label ?? (\n    <div style={{ display: \"flex\", gap: \"4px\" }}>\n      {metadata.name}\n      {metadata.requiredArgumentForInput ? <span style={{ color: \"var(--p-color-text-critical)\" }}>{\"*\"}</span> : null}\n    </div>\n  );\n\n  return (\n    <>\n      {inputLabel}\n      <DropZone\n        variableHeight\n        allowMultiple={false}\n        onDrop={(_droppedFiles, acceptedFiles) => {\n          void onFileUpload(acceptedFiles);\n        }}\n        {...rest}\n        accept={validations.onlyImages?.acceptedTypes?.join(\",\")}\n      >\n        {filePreview}\n        {fileUploadContainer}\n      </DropZone>\n      {errorMessage && (\n        <div style={{ marginTop: \"4px\" }}>\n          <InlineError fieldID={fieldApiIdentifier} message={errorMessage} />\n        </div>\n      )}\n    </>\n  );\n});\n"]}