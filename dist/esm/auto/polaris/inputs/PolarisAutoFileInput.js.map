{"version":3,"file":"PolarisAutoFileInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisAutoFileInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { DropZoneProps } from \"@shopify/polaris\";\nimport { Box, Button, DropZone, InlineError, InlineStack, Thumbnail } from \"@shopify/polaris\";\nimport { DeleteIcon, NoteIcon } from \"@shopify/polaris-icons\";\nimport { filesize } from \"filesize\";\nimport React, { useMemo } from \"react\";\nimport type { Control } from \"../../../useActionForm.js\";\nimport { isAutoFileFieldValue } from \"../../../validationSchema.js\";\nimport { autoInput } from \"../../AutoInput.js\";\nimport { getFileSizeValidationMessage, imageFileTypes, useFileInputController } from \"../../hooks/useFileInputController.js\";\n\nexport const PolarisAutoFileInput = autoInput((props: { field: string; control?: Control<any> } & Omit<DropZoneProps, \"allowMultiple\">) => {\n  const { field: fieldApiIdentifier, control, ...rest } = props;\n  const { fieldProps, errorMessage, imageThumbnailURL, onFileUpload, clearFileValue, canClearFileValue, validations, metadata } =\n    useFileInputController({\n      field: fieldApiIdentifier,\n      control,\n    });\n\n  const fileUploadContainer = useMemo(() => {\n    if (fieldProps.value) return null;\n\n    const actionHintParts = [\"Accepts\"];\n    if (validations.onlyImages) {\n      actionHintParts.push(`.jpg, .webp, .svg${validations.onlyImages.allowAnimatedImages ? \", .gif\" : \"\"}, and .png`);\n    }\n\n    if (validations.fileSize) {\n      const validation = validations.fileSize;\n      const message = getFileSizeValidationMessage(validation, {\n        inRange: (min, max) => `between ${filesize(min)} and ${filesize(max)}`,\n        max: (max) => `smaller than ${filesize(max)}`,\n        min: (min) => `larger than ${filesize(min)}`,\n      });\n      if (message) actionHintParts.push(message);\n    }\n\n    return <DropZone.FileUpload actionTitle=\"Add file\" actionHint={actionHintParts.length === 1 ? \"\" : actionHintParts.join(\" \")} />;\n  }, [fieldProps.value, validations.fileSize, validations.onlyImages]);\n\n  const filePreview = useMemo(() => {\n    const value = fieldProps.value;\n    if (!value || !isAutoFileFieldValue(value)) return null;\n\n    return (\n      <Box padding=\"100\" paddingInlineEnd={\"400\"}>\n        <InlineStack align=\"space-between\" gap=\"400\">\n          <InlineStack gap=\"200\" blockAlign=\"center\">\n            <Thumbnail\n              size=\"small\"\n              alt={value.fileName}\n              source={imageThumbnailURL && [...imageFileTypes, \"image/gif\"].includes(value.mimeType) ? imageThumbnailURL : NoteIcon}\n            />\n            <div>\n              {value.$uploading ? \"(Uploading) \" : \"\"}\n              {value.fileName}\n            </div>\n          </InlineStack>\n          {canClearFileValue && (\n            <Button\n              icon={DeleteIcon}\n              variant=\"plain\"\n              accessibilityLabel=\"Delete file\"\n              onPointerDown={() => {\n                clearFileValue();\n              }}\n              id={`clear-file-${fieldApiIdentifier}`}\n            />\n          )}\n        </InlineStack>\n      </Box>\n    );\n  }, [canClearFileValue, clearFileValue, fieldApiIdentifier, fieldProps.value, imageThumbnailURL]);\n\n  const inputLabel = (\n    <>\n      {metadata.name} {metadata.requiredArgumentForInput ? <span style={{ color: \"var(--p-color-text-critical)\" }}>*</span> : null}\n    </>\n  );\n\n  return (\n    <>\n      <DropZone\n        variableHeight\n        label={inputLabel}\n        allowMultiple={false}\n        onDrop={(_droppedFiles, acceptedFiles) => {\n          void onFileUpload(acceptedFiles);\n        }}\n        {...rest}\n        accept={validations.onlyImages?.acceptedTypes?.join(\",\")}\n      >\n        {filePreview}\n        {fileUploadContainer}\n      </DropZone>\n      {errorMessage && (\n        <div style={{ marginTop: \"4px\" }}>\n          <InlineError fieldID={fieldApiIdentifier} message={errorMessage} />\n        </div>\n      )}\n    </>\n  );\n});\n"]}