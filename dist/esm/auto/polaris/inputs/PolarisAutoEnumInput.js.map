{"version":3,"file":"PolarisAutoEnumInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris/inputs/PolarisAutoEnumInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { ComboboxProps } from \"@shopify/polaris\";\nimport { AutoSelection, Combobox, EmptySearchResult, Icon, InlineStack, Listbox, Tag, Text } from \"@shopify/polaris\";\nimport { SearchIcon } from \"@shopify/polaris-icons\";\nimport React, { useEffect, useMemo } from \"react\";\nimport { type Control } from \"react-hook-form\";\nimport { useEnumInputController } from \"../../hooks/useEnumInputController.js\";\n\nexport const PolarisAutoEnumInput = (props: { field: string; control?: Control<any> } & Partial<ComboboxProps>) => {\n  const { field: fieldApiIdentifier, control, ...comboboxProps } = props;\n  const {\n    allowMultiple,\n    allowOther,\n    onSelectionChange,\n    selectedOptions,\n    allOptions,\n    filteredOptions,\n    searchQuery,\n    label,\n    metadata,\n    isError,\n    errorMessage,\n  } = useEnumInputController({ field: fieldApiIdentifier, control });\n  const { value: searchValue, setValue: setSearchValue } = searchQuery;\n\n  const selectedTagsElement = useMemo(\n    () =>\n      allowMultiple && selectedOptions.length > 0 ? (\n        <InlineStack gap=\"150\">\n          {selectedOptions.map((tag) => (\n            <Tag key={`option-${tag}`} onRemove={() => onSelectionChange(tag)}>\n              {tag}\n            </Tag>\n          ))}\n        </InlineStack>\n      ) : null,\n    [allowMultiple, onSelectionChange, selectedOptions]\n  );\n\n  const optionItemElement = useMemo(() => {\n    if (allOptions.length === 0) return null;\n\n    const formatOptionText = (option: string) => {\n      const trimValue = searchValue.trim().toLocaleLowerCase();\n      const matchIndex = option.toLocaleLowerCase().indexOf(trimValue);\n\n      if (!searchValue || matchIndex === -1) return option;\n\n      const start = option.slice(0, matchIndex);\n      const highlight = option.slice(matchIndex, matchIndex + trimValue.length);\n      const end = option.slice(matchIndex + trimValue.length, option.length);\n\n      return (\n        <p>\n          {start}\n          <Text fontWeight=\"bold\" as=\"span\">\n            {highlight}\n          </Text>\n          {end}\n        </p>\n      );\n    };\n\n    return filteredOptions.map((option) => {\n      return (\n        <Listbox.Option key={option} value={option} selected={selectedOptions.includes(option)} accessibilityLabel={option}>\n          <Listbox.TextOption selected={selectedOptions.includes(option)}>{formatOptionText(option)}</Listbox.TextOption>\n        </Listbox.Option>\n      );\n    });\n  }, [allOptions.length, filteredOptions, searchValue, selectedOptions]);\n\n  const addExtraOptionElement = useMemo(() => {\n    if (!allowOther) return null;\n\n    const noResults = searchValue && !allOptions.includes(searchValue);\n    return noResults ? <Listbox.Action value={searchValue}>{`Add \"${searchValue}\"`}</Listbox.Action> : null;\n  }, [allOptions, allowOther, searchValue]);\n\n  const emptyStateElement = useMemo(() => {\n    if (allowOther || (optionItemElement && optionItemElement.length > 0) || !searchValue) return null;\n    return <EmptySearchResult title=\"\" description={`No  found matching \"${searchValue}\"`} />;\n  }, [allowOther, optionItemElement, searchValue]);\n\n  useEffect(() => {\n    if (allowMultiple) {\n      setSearchValue(\"\");\n      return;\n    }\n\n    if (selectedOptions.length > 0) {\n      // Set the search value to show the selected option in the input field\n      setSearchValue(selectedOptions[0]);\n    } else {\n      setSearchValue(\"\");\n    }\n  }, [allowMultiple, selectedOptions, setSearchValue]);\n\n  const listBoxElement = useMemo(\n    () =>\n      optionItemElement || addExtraOptionElement || emptyStateElement ? (\n        <Listbox\n          autoSelection={AutoSelection.None}\n          onSelect={(selected) => {\n            onSelectionChange(selected);\n            console.log(\"selectedOptions:\", selectedOptions);\n            if (allowMultiple) {\n              setSearchValue(\"\");\n            } else if (selectedOptions.length > 0) {\n              setSearchValue(selectedOptions[0]);\n            }\n          }}\n        >\n          {emptyStateElement}\n          {addExtraOptionElement}\n          {optionItemElement}\n        </Listbox>\n      ) : null,\n    [addExtraOptionElement, allowMultiple, emptyStateElement, onSelectionChange, optionItemElement, selectedOptions, setSearchValue]\n  );\n\n  const inputLabel = (\n    <>\n      {label} {metadata.requiredArgumentForInput ? <span style={{ color: \"var(--p-color-text-critical)\" }}>*</span> : null}\n    </>\n  );\n\n  return (\n    <Combobox\n      {...comboboxProps}\n      allowMultiple={allowMultiple}\n      activator={\n        <Combobox.TextField\n          autoComplete=\"off\"\n          prefix={<Icon source={SearchIcon} />}\n          label={inputLabel}\n          value={searchValue}\n          placeholder=\"Search\"\n          verticalContent={selectedTagsElement}\n          onChange={setSearchValue}\n          id={`${props.field}-combobox-textfield`}\n          error={isError}\n          helpText={errorMessage}\n        />\n      }\n    >\n      {listBoxElement}\n    </Combobox>\n  );\n};\n"]}