{"version":3,"file":"PolarisWCPopover.js","sourceRoot":"","sources":["../../../../../src/auto/polaris-wc/commonComponents/PolarisWCPopover.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useLayoutEffect, useRef, useState, type ReactNode } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nconst FADE_IN_DURATION_MS = 150;\nconst FADE_OUT_DURATION_MS = 250;\n\n/** Position of the popover panel relative to the anchor. */\nexport type PolarisWCPopoverPosition = \"below-start\" | \"below-end\" | \"above-start\" | \"above-end\";\n\nconst IS_END_POSITION: Record<PolarisWCPopoverPosition, boolean> = {\n  \"below-start\": false,\n  \"below-end\": true,\n  \"above-start\": false,\n  \"above-end\": true,\n};\n\nexport interface PolarisWCPopoverProps {\n  /**\n   * Whether the popover panel is open.\n   */\n  open: boolean;\n  /**\n   * Callback when the popover is closed. Receives the reason when closed by user action.\n   */\n  onClose?: (reason?: \"escape\" | \"click-outside\") => void;\n  /**\n   * The element to anchor the popover panel to (e.g. an input or button).\n   * The panel is positioned relative to this element per the `position` prop.\n   */\n  anchor: ReactNode;\n  /**\n   * Content to render inside the popover panel.\n   */\n  children?: ReactNode;\n  /**\n   * ID for the panel element (e.g. for aria-controls).\n   */\n  contentId?: string;\n  /**\n   * Ref forwarded to the panel wrapper so parents can attach scroll listeners etc.\n   */\n  contentRef?: React.RefObject<HTMLDivElement | null>;\n  /**\n   * Optional max height for the panel (default 300px).\n   */\n  maxHeight?: string | number;\n  /**\n   * Optional props to spread onto the panel div (e.g. role, aria-multiselectable).\n   */\n  contentProps?: React.HTMLAttributes<HTMLDivElement>;\n  /**\n   * Position of the panel relative to the anchor. Defaults to \"below-start\".\n   * - below-start: below anchor, start (left in LTR) edge aligned\n   * - below-end: below anchor, end (right in LTR) edge aligned\n   * - above-start: above anchor, start edge aligned\n   * - above-end: above anchor, end edge aligned\n   */\n  position?: PolarisWCPopoverPosition;\n}\n\n/** z-index for the portaled panel so it appears above page content and stacking contexts */\nconst POPOVER_Z_INDEX = 9999;\n\nconst basePanelStyle: React.CSSProperties = {\n  position: \"fixed\",\n  zIndex: POPOVER_Z_INDEX,\n  marginTop: \"4px\",\n  marginBottom: \"4px\",\n  maxHeight: \"300px\",\n  overflowY: \"auto\",\n  padding: \"8px 0\",\n  background: \"var(--p-color-bg-surface, #ffffff)\",\n  borderRadius: \"var(--p-border-radius-200, 8px)\",\n  boxShadow: \"var(--p-shadow-300, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06))\",\n  border: \"1px solid var(--p-color-border, #e1e3e5)\",\n};\n\n/**\n * A general popover component using Polaris styling.\n * Portals the panel to document.body to avoid clipping. Positions using the anchor rect.\n */\nexport const PolarisWCPopover = (props: PolarisWCPopoverProps) => {\n  const {\n    open,\n    onClose,\n    anchor,\n    children,\n    contentId,\n    contentRef: contentRefProp,\n    maxHeight = \"300px\",\n    contentProps = {},\n    position = \"below-start\",\n  } = props;\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const internalContentRef = useRef<HTMLDivElement>(null);\n  const contentRef = contentRefProp ?? internalContentRef;\n  const isEnd = IS_END_POSITION[position];\n\n  const [anchorRect, setAnchorRect] = useState<{\n    top: number;\n    left: number;\n    right: number;\n    bottom: number;\n    width: number;\n  } | null>(null);\n  const [shouldRender, setShouldRender] = useState(false);\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    if (open) {\n      setShouldRender(true);\n      requestAnimationFrame(() => setIsVisible(true));\n    } else {\n      setIsVisible(false);\n    }\n  }, [open]);\n\n  const handleTransitionEnd = () => {\n    if (!open) setShouldRender(false);\n  };\n\n  const updateRect = () => {\n    const el = containerRef.current;\n    if (!el) return;\n    const rect = el.getBoundingClientRect();\n    setAnchorRect({\n      top: rect.top,\n      left: rect.left,\n      right: typeof window !== \"undefined\" ? window.innerWidth - rect.right : 0,\n      bottom: rect.bottom,\n      width: rect.width,\n    });\n  };\n\n  useLayoutEffect(() => {\n    if (!shouldRender) {\n      setAnchorRect(null);\n      return;\n    }\n    updateRect();\n    const container = containerRef.current;\n    const resizeObserver = typeof window !== \"undefined\" && container ? new ResizeObserver(() => updateRect()) : null;\n    if (resizeObserver && container) {\n      resizeObserver.observe(container);\n    }\n    if (typeof window !== \"undefined\") {\n      document.addEventListener(\"scroll\", updateRect, true);\n      window.addEventListener(\"resize\", updateRect);\n    }\n    return () => {\n      resizeObserver?.disconnect();\n      if (typeof window !== \"undefined\") {\n        document.removeEventListener(\"scroll\", updateRect, true);\n        window.removeEventListener(\"resize\", updateRect);\n      }\n    };\n  }, [shouldRender]);\n\n  useEffect(() => {\n    if (!shouldRender || !onClose) return;\n\n    const handleMouseDown = (event: MouseEvent) => {\n      if (!open) return;\n      const path = event.composedPath();\n      if (containerRef.current && path.includes(containerRef.current)) return;\n      if (contentRef.current && path.includes(contentRef.current)) return;\n      onClose(\"click-outside\");\n    };\n\n    document.addEventListener(\"mousedown\", handleMouseDown);\n    return () => document.removeEventListener(\"mousedown\", handleMouseDown);\n  }, [shouldRender, open, onClose, contentRef]);\n\n  // Close on Escape\n  useEffect(() => {\n    if (!open || !onClose) return;\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        onClose(\"escape\");\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [open, onClose]);\n\n  const maxHeightPx = typeof maxHeight === \"number\" ? `${maxHeight}px` : maxHeight;\n  const opacity = shouldRender ? (isVisible ? 1 : 0) : 0;\n  const transition = `opacity ${isVisible ? FADE_IN_DURATION_MS : FADE_OUT_DURATION_MS}ms ease-out`;\n\n  const panelStyle: React.CSSProperties =\n    anchorRect === null\n      ? { ...basePanelStyle, opacity: 0, maxHeight: maxHeightPx, transition }\n      : (() => {\n          const r = anchorRect;\n          const isBelow = position === \"below-start\" || position === \"below-end\";\n          return {\n            ...basePanelStyle,\n            top: isBelow ? `${r.bottom + 4}px` : undefined,\n            bottom: isBelow ? undefined : `calc(100vh - ${r.top}px + 4px)`,\n            left: isEnd ? undefined : `${r.left}px`,\n            right: isEnd ? `${r.right}px` : undefined,\n            width: isEnd ? undefined : `${r.width}px`,\n            maxHeight: maxHeightPx,\n            opacity,\n            transition,\n          };\n        })();\n\n  const panelElement = shouldRender ? (\n    <div\n      ref={contentRef as React.Ref<HTMLDivElement>}\n      id={contentId}\n      onTransitionEnd={handleTransitionEnd}\n      {...contentProps}\n      style={{\n        ...panelStyle,\n        ...contentProps.style,\n      }}\n    >\n      {children}\n    </div>\n  ) : null;\n\n  return (\n    <div ref={containerRef} style={{ position: \"relative\" }}>\n      {anchor}\n      {panelElement != null && createPortal(panelElement, document.body)}\n    </div>\n  );\n};\n"]}