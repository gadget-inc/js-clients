{"version":3,"file":"PolarisWCAutoFileInput.js","sourceRoot":"","sources":["../../../../../src/auto/polaris-wc/inputs/PolarisWCAutoFileInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo } from \"react\";\nimport { isAutoFileFieldValue } from \"../../../validationSchema.js\";\nimport { autoInput } from \"../../AutoInput.js\";\nimport { imageFileTypes, useFileInputController } from \"../../hooks/useFileInputController.js\";\nimport { type AutoFileInputProps } from \"../../shared/AutoInputTypes.js\";\n\nexport type PolarisWCAutoFileInputProps = AutoFileInputProps & {\n  disabled?: boolean;\n};\n\n/**\n * A file input within AutoForm using Polaris Web Components.\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoFileInput field=\"fileField\" />\n * </AutoForm>\n * ```\n * @param props.field - The API identifier of the File field.\n * @param props.label - Label of the File input.\n * @returns The AutoFileInput component.\n */\nexport const PolarisWCAutoFileInput = autoInput((props: PolarisWCAutoFileInputProps) => {\n  const { field: fieldApiIdentifier, control, disabled, ...rest } = props;\n\n  const {\n    fieldProps,\n    errorMessage,\n    imageThumbnailURL,\n    onFileUpload,\n    clearFileValue,\n    canClearFileValue,\n    validations,\n    metadata,\n    actionHintParts,\n  } = useFileInputController({\n    field: fieldApiIdentifier,\n    control,\n  });\n\n  const handleChange = useCallback(\n    (event: Event) => {\n      const target = event.currentTarget as any;\n      const files = target.files || [];\n      if (files.length > 0) {\n        void onFileUpload([files[0]]);\n      }\n    },\n    [onFileUpload]\n  );\n\n  const filePreview = useMemo(() => {\n    const value = fieldProps.value;\n    if (!value || !isAutoFileFieldValue(value)) return null;\n\n    const isImage = imageThumbnailURL && [...imageFileTypes, \"image/gif\"].includes(value.mimeType);\n\n    return (\n      <>\n        {isImage && imageThumbnailURL ? (\n          <s-thumbnail size=\"small\" src={imageThumbnailURL} alt={value.fileName} />\n        ) : (\n          <s-thumbnail size=\"small\" alt={value.fileName} />\n        )}\n        <div style={{ flex: 1 }}>\n          {value.$uploading ? \"(Uploading) \" : \"\"}\n          {value.fileName}\n        </div>\n        {canClearFileValue && (\n          <s-button\n            variant=\"tertiary\"\n            onClick={(e) => {\n              e.stopPropagation();\n              e.preventDefault();\n              clearFileValue();\n            }}\n            icon=\"delete\"\n          />\n        )}\n      </>\n    );\n  }, [canClearFileValue, clearFileValue, fieldProps.value, imageThumbnailURL]);\n\n  // Ensure label is always a string\n  const label: string = typeof props.label === \"string\" ? props.label : String(metadata.name ?? \"\");\n\n  return (\n    <div style={{ position: \"relative\" }}>\n      <s-drop-zone\n        accept={validations.onlyImages?.acceptedTypes?.join(\",\")}\n        onChange={handleChange}\n        disabled={disabled}\n        label={label}\n        error={errorMessage}\n        required={metadata.requiredArgumentForInput}\n      >\n        {!filePreview && actionHintParts ? (\n          <>\n            <s-text>Add file</s-text>\n            {actionHintParts && <s-text color=\"subdued\">{actionHintParts.length === 1 ? \"\" : actionHintParts.join(\" \")}</s-text>}\n          </>\n        ) : (\n          // Need this stack here since s-drop-zone will automatically add content otherwise.\n          // The file preview can't be in here because s-drop-zone will prevent pointer events from reaching custom content\n          <s-stack></s-stack>\n        )}\n      </s-drop-zone>\n      {filePreview && (\n        <div\n          style={{\n            position: \"absolute\",\n            inset: 0,\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: \"12px\",\n            padding: \"16px\",\n            zIndex: 2,\n            pointerEvents: \"auto\",\n            background: \"transparent\",\n          }}\n        >\n          {filePreview}\n        </div>\n      )}\n    </div>\n  );\n});\n"]}