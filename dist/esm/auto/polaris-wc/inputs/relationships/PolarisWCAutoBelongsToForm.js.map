{"version":3,"file":"PolarisWCAutoBelongsToForm.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCAutoBelongsToForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useId } from \"react\";\nimport { useBelongsToForm } from \"../../../../useBelongsToForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport type { AutoRelationshipFormProps } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCModal } from \"../../commonComponents/PolarisWCModal.js\";\nimport { PolarisWCSearchableSingleRelatedModelRecordSelector } from \"./PolarisWCSearchableSingleRelatedModelRecordSelector.js\";\nimport { renderOptionLabel } from \"./utils.js\";\n\n/**\n * A belongsTo field form component for use within <AutoForm></AutoForm> components using Polaris Web Components.\n * This component allows related model records to be created or updated from the current model.\n * Fields on the related model record are controlled with the nested <AutoInput/> child components.\n *\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoBelongsToForm field=\"parentModel\" >\n *     <AutoInput field=\"parentModelField\" />\n *   </AutoBelongsToForm>\n * </AutoForm>\n * ```\n * @param props.field - The belongsTo field API identifier\n * @param props.label - The label of the belongTo form component\n * @param props.children - The child components to be rendered within the form. This is intended to be used with <AutoInput/>.\n * @param props.optionLabel - Controls how records on the related model are displayed as options in the relationship field input component.\n *                            When using a string, the string will indicate the field on the related model record to be displayed as the option label.\n *                            When using a function, the function will be called with the record to return a ReactNode to be displayed as the option label\n * @returns The belongsTo field form component\n */\nexport const PolarisWCAutoBelongsToForm = autoRelationshipForm((props: AutoRelationshipFormProps) => {\n  const belongsToForm = useBelongsToForm(props);\n\n  const {\n    record,\n    actionsOpen,\n    isEditing,\n    setActionsOpen,\n    setIsEditing,\n    pathPrefix,\n    hasRecord,\n    recordOption,\n    relatedModelName: parentName,\n    path,\n    setValue,\n    getValues,\n    metaDataPathPrefix,\n  } = belongsToForm;\n\n  const handleEdit = useCallback(() => {\n    setIsEditing(true);\n    setActionsOpen(false);\n  }, [setIsEditing, setActionsOpen]);\n\n  const handleRemove = useCallback(() => {\n    const { __typename, ...rest } = record;\n    const nulledValues = Object.fromEntries(Object.keys(rest).map((key) => [key, null]));\n    setValue(path, { ...nulledValues, __typename, _unlink: true });\n    setActionsOpen(false);\n  }, [record, setValue, path, setActionsOpen]);\n\n  const handleSave = useCallback(() => {\n    const { _unlink, _link, id: recordId, ...rest } = getValues(path);\n\n    if (recordId) {\n      setValue(path, { ...rest, id: recordId });\n    } else {\n      setValue(path, rest);\n    }\n    setIsEditing(false);\n  }, [getValues, path, setValue, setIsEditing]);\n\n  const handleCancel = useCallback(() => {\n    setIsEditing(false);\n  }, [setIsEditing]);\n\n  const menuId = useId();\n  return (\n    <>\n      <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n          {props.label ?? <s-text>{parentName}</s-text>}\n          {hasRecord && (\n            <>\n              <s-button commandFor={`related-record-menu-${menuId}`} icon=\"menu-vertical\" variant=\"tertiary\" />\n              <s-menu id={`related-record-menu-${menuId}`} accessibilityLabel=\"Customer actions\">\n                <s-button onClick={handleEdit}>Edit {parentName.toLocaleLowerCase()}</s-button>\n                <s-button onClick={handleRemove} tone=\"critical\">\n                  Remove {parentName.toLocaleLowerCase()}\n                </s-button>\n              </s-menu>\n            </>\n          )}\n        </div>\n        {hasRecord ? (\n          <>\n            <hr style={{ border: \"none\", borderTop: \"1px solid var(--p-color-border, #dfe3e8)\", margin: 0 }} />\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"flex-start\" }}>\n              <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"4px\" }}>\n                {renderOptionLabel(recordOption!.primary, \"primary\")}\n                {recordOption!.secondary && renderOptionLabel(recordOption!.secondary, \"secondary\")}\n              </div>\n              {recordOption!.tertiary && renderOptionLabel(recordOption!.tertiary, \"tertiary\")}\n            </div>\n          </>\n        ) : (\n          <PolarisWCSearchableSingleRelatedModelRecordSelector form={belongsToForm} />\n        )}\n      </div>\n\n      <PolarisWCModal open={isEditing} onOpenChange={(open) => !open && setIsEditing(false)} heading={`Add ${parentName}`}>\n        <RelationshipContext.Provider\n          value={{\n            transformPath: (path) => pathPrefix + \".\" + path,\n            transformMetadataPath: (path) => metaDataPathPrefix + \".\" + path,\n          }}\n        >\n          <div style={{ padding: \"16px\" }}>{props.children}</div>\n          <div\n            style={{\n              padding: \"16px\",\n              borderTop: \"1px solid var(--p-color-border, #dfe3e8)\",\n              display: \"flex\",\n              justifyContent: \"flex-end\",\n              gap: \"8px\",\n            }}\n          >\n            <s-button variant=\"secondary\" onClick={handleCancel}>\n              Cancel\n            </s-button>\n            <s-button variant=\"primary\" onClick={handleSave}>\n              Save\n            </s-button>\n          </div>\n        </RelationshipContext.Provider>\n      </PolarisWCModal>\n    </>\n  );\n});\n"]}