{"version":3,"file":"PolarisWCAutoHasManyThroughForm.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCAutoHasManyThroughForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useHasManyThroughForm } from \"../../../../useHasManyThroughForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport { getRecordAsOption } from \"../../../hooks/useRelatedModel.js\";\nimport type { AutoHasManyThroughFormProps, DisplayedRecordOption } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCRelatedModelOptionsPopover, PolarisWCRelatedModelOptionsSearch } from \"./PolarisWCRelatedModelOptions.js\";\nimport { renderOptionLabel } from \"./utils.js\";\n\n/**\n * A hasManyThrough field form component for use within <AutoForm></AutoForm> components using Polaris Web Components.\n * This component allows sibling model relationships to be defined through creating, updating, or deleting records on the sibling model.\n * Fields on the related model record are controlled with the nested <AutoInput/> child components.\n *\n * @example\n * ```tsx\n * <AutoForm action={api.course.create}>\n *   <AutoInput // `name` field on `course` model\n *     field=\"name\"\n *   />\n *   <AutoHasManyThroughForm // `students` field on `course` model - `course` hasMany `students` through `registration`\n *     field=\"students\"\n *   >\n *     <AutoHasManyThroughJoinModelForm // Join model field inputs\n *     >\n *       <AutoInput // `isTuitionPaid` field on `registration` model\n *         field=\"isTuitionPaid\"\n *       />\n *     </AutoHasManyThroughJoinModelForm>\n *     <AutoInput // Sibling model field inputs\n *       field=\"firstName\"\n *     />\n *   </AutoHasManyThroughForm>\n *   <AutoSubmit />\n * </AutoForm>\n * ```\n * @param props.field - The hasMany field API identifier\n * @param props.label - The label of the hasMany form component\n * @param props.children - The child components to be rendered within the form. This is intended to be used with <AutoInput/> and will be rendered for each sibling model record.\n * @param props.recordLabel - Controls how records on the related model are displayed as options in the relationship field input component.\n *                            When using a string, the string will indicate the field on the related model record to be displayed as the option label.\n *                            When using a function, the function will be called with the record to return a ReactNode to be displayed as the option label\n * @returns The hasManyThrough field form component\n */\nexport const PolarisWCAutoHasManyThroughForm = autoRelationshipForm((props: AutoHasManyThroughFormProps) => {\n  const [addingSibling, setAddingSibling] = useState(false);\n  const {\n    append,\n    remove,\n    joinRecords,\n    listboxId,\n    pathPrefix,\n    metaDataPathPrefix,\n    recordLabel,\n    siblingModelName,\n    siblingRecordsLoading,\n    siblingRecords,\n    siblingPagination,\n    search,\n    joinModelField,\n    joinModelApiIdentifier,\n    siblingModelOptions,\n    inverseRelatedModelField,\n    fieldArray,\n  } = useHasManyThroughForm(props);\n\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n        {props.label ?? <s-heading>{siblingModelName}</s-heading>}\n        <PolarisWCRelatedModelOptionsPopover\n          active={addingSibling}\n          activator={<s-button onClick={() => setAddingSibling((prev) => !prev)}>Add {siblingModelName ?? \"related model\"}</s-button>}\n          onClose={() => setAddingSibling(false)}\n          onScrolledToBottom={siblingPagination.loadNextPage}\n          search={\n            <PolarisWCRelatedModelOptionsSearch\n              modelName={siblingModelName}\n              value={search.value}\n              onChange={search.set}\n              ariaControls={listboxId}\n            />\n          }\n          options={siblingModelOptions}\n          records={siblingRecords}\n          onSelect={(record) => {\n            inverseRelatedModelField && append({ [inverseRelatedModelField]: { ...record, _link: record.id } });\n          }}\n          isLoading={siblingRecordsLoading}\n          renderOption={(option) => (\n            <SiblingOption\n              option={option}\n              onClick={() => {\n                const record = siblingRecords?.find((r) => r.id === option.id) ?? {\n                  id: option.id,\n                };\n                inverseRelatedModelField && append({ [inverseRelatedModelField]: { ...record, _link: record.id } });\n                setAddingSibling(false);\n              }}\n            />\n          )}\n          listboxId={listboxId}\n        />\n      </div>\n\n      {joinRecords.length > 0 ? (\n        <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\n          {joinRecords.map(([fieldKey, idx, record]) => {\n            const siblingRecord = inverseRelatedModelField && record[inverseRelatedModelField];\n\n            const siblingOption = getRecordAsOption(siblingRecord, {\n              primary: recordLabel.primary,\n              secondary: recordLabel.secondary,\n              tertiary: recordLabel.tertiary,\n            });\n\n            return (\n              <div key={fieldKey}>\n                <div\n                  style={{\n                    border: \"1px solid var(--p-color-border, #dfe3e8)\",\n                    borderRadius: \"var(--p-border-radius-200, 8px)\",\n                  }}\n                >\n                  <div\n                    style={{\n                      display: \"flex\",\n                      padding: \"8px\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <div style={{ flex: 1, minWidth: 0 }}>\n                      <div style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}>\n                        {renderOptionLabel(siblingOption.primary, \"primary\")}\n                        {siblingOption?.tertiary && renderOptionLabel(siblingOption.tertiary, \"tertiary\")}\n                      </div>\n                      {siblingOption?.secondary && renderOptionLabel(siblingOption.secondary, \"secondary\")}\n                    </div>\n                    <s-button id={`deleteButton_${pathPrefix}.${idx}`} variant=\"tertiary\" onClick={() => remove(idx)} icon={\"x\"} />\n                  </div>\n                  {props.children && (\n                    <div\n                      style={{\n                        borderTop: \"1px solid var(--p-color-border, #dfe3e8)\",\n                        padding: \"8px\",\n                      }}\n                    >\n                      <RelationshipContext.Provider\n                        value={{\n                          transformPath: (path) => `${joinModelField}.${idx}.${path.replace(`${joinModelApiIdentifier}.`, \"\")}`,\n                          transformMetadataPath: (path) => `${joinModelField}.${path.replace(`${joinModelApiIdentifier}.`, \"\")}`,\n                          fieldArray,\n                          hasManyThrough: { joinModelApiIdentifier, inverseRelatedModelField },\n                        }}\n                      >\n                        {props.children}\n                      </RelationshipContext.Provider>\n                    </div>\n                  )}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <div\n          style={{\n            border: \"1px solid var(--p-color-border, #dfe3e8)\",\n            borderRadius: \"var(--p-border-radius-200, 8px)\",\n            padding: \"12px\",\n            textAlign: \"center\",\n          }}\n        >\n          <s-text tone=\"neutral\">No {siblingModelName} yet</s-text>\n        </div>\n      )}\n    </div>\n  );\n});\n\nconst SiblingOption = (props: { option: DisplayedRecordOption; onClick: () => void }) => {\n  const { option, onClick } = props;\n\n  return (\n    <button\n      key={option.id}\n      type=\"button\"\n      onClick={onClick}\n      style={{\n        display: \"flex\",\n        width: \"100%\",\n        padding: \"8px 12px\",\n        border: \"none\",\n        background: \"transparent\",\n        cursor: \"pointer\",\n        textAlign: \"left\",\n        alignItems: \"center\",\n        gap: \"8px\",\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = \"var(--p-color-bg-surface-hover, #f9fafb)\";\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = \"transparent\";\n      }}\n    >\n      <div style={{ flex: 1, display: \"flex\", flexDirection: \"column\", gap: \"2px\" }}>\n        {renderOptionLabel(option.primary, \"primary\")}\n        {option.secondary && renderOptionLabel(option.secondary, \"secondary\")}\n      </div>\n      <s-icon type=\"plus\" />\n    </button>\n  );\n};\n"]}