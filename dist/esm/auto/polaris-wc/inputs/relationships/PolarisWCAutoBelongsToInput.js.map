{"version":3,"file":"PolarisWCAutoBelongsToInput.js","sourceRoot":"","sources":["../../../../../../src/auto/polaris-wc/inputs/relationships/PolarisWCAutoBelongsToInput.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useMemo } from \"react\";\nimport { autoInput } from \"../../../AutoInput.js\";\nimport { useBelongsToInputController } from \"../../../hooks/useBelongsToController.js\";\nimport { getRecordAsOption, optionRecordsToLoadCount, useOptionLabelForField } from \"../../../hooks/useRelatedModel.js\";\nimport type { AutoRelationshipInputProps } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport { PolarisWCDismissibleBadge } from \"../../commonComponents/PolarisWCDismissibleBadge.js\";\nimport { PolarisWCCombobox } from \"../PolarisWCCombobox.js\";\nimport { PolarisWCRelatedModelOptions } from \"./PolarisWCRelatedModelOptions.js\";\n\n/**\n * A belongsTo field input component for use within <AutoForm></AutoForm> components using Polaris Web Components.\n * This component is used to configure relationships with records from a related model\n * @example\n * ```tsx\n * <AutoForm action={api.modelA.create}>\n *   <AutoBelongsToInput field=\"parentModel\" label=\"Parent\" />\n * </AutoForm>\n * ```\n * @param props.field - The belongsTo field API identifier\n * @param props.label - The label of the belongTo field input component\n * @param props.optionLabel - Controls how records on the related model are displayed as options in the relationship field input component.\n *                            When using a string, the string will indicate the field on the related model record to be displayed as the option label.\n *                            When using a function, the function will be called with the record to return a ReactNode to be displayed as the option label\n * @returns The belongsTo field input component\n */\nexport const PolarisWCAutoBelongsToInput = autoInput((props: AutoRelationshipInputProps) => {\n  const { field, label, placeholder } = props;\n  const {\n    fieldMetadata: { metadata, path },\n    relatedModelOptions: { options, searchFilterOptions, pagination, search, relatedModel },\n    isLoading,\n    errorMessage,\n    selectedRecord,\n    danglingSelectedRecordId,\n    onSelectRecord,\n    onRemoveRecord,\n  } = useBelongsToInputController(props);\n\n  const optionLabel = useOptionLabelForField(field, props.optionLabel);\n  const selectedOption = selectedRecord ? getRecordAsOption(selectedRecord, { primary: optionLabel }) : null;\n\n  const selectedRecordTag = useMemo(() => {\n    const tagConfig =\n      selectedOption && selectedOption.id\n        ? { content: selectedOption.primary, key: `selectedRecordTag_${selectedOption.id}` }\n        : danglingSelectedRecordId\n          ? {\n              content: <span style={{ color: \"red\" }}>id: {danglingSelectedRecordId}</span>,\n              key: `selectedRecordTag_${danglingSelectedRecordId}`,\n            }\n          : undefined;\n\n    return tagConfig ? (\n      <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: \"4px\", marginTop: \"8px\" }}>\n        <PolarisWCDismissibleBadge onDismiss={onRemoveRecord} key={tagConfig.key}>\n          {tagConfig.content}\n        </PolarisWCDismissibleBadge>\n      </div>\n    ) : undefined;\n  }, [selectedOption, danglingSelectedRecordId, onRemoveRecord]);\n\n  const onSelect = (record: Record<string, any>) => {\n    const recordId = record.id;\n    const idIsAlreadySelected = selectedRecord?.id === recordId;\n\n    if (idIsAlreadySelected) {\n      onRemoveRecord(); // clear selection\n    } else {\n      onSelectRecord(record); // make single selection\n    }\n  };\n\n  // Ensure label is always a string for the web component\n  const inputLabel: string = typeof label === \"string\" ? label : typeof metadata.name === \"string\" ? metadata.name : \"\";\n\n  return (\n    <PolarisWCCombobox\n      id={path}\n      label={inputLabel}\n      placeholder={placeholder ?? \"Search\"}\n      value={search.value}\n      onChange={search.set}\n      required={metadata.requiredArgumentForInput}\n      onScrolledToBottom={pagination.loadNextPage}\n      willLoadMoreOptions={pagination.hasNextPage && options.length >= optionRecordsToLoadCount}\n      error={errorMessage}\n      verticalContent={selectedRecordTag}\n    >\n      <PolarisWCRelatedModelOptions\n        isLoading={isLoading}\n        errorMessage={errorMessage}\n        checkSelected={(id) => id === selectedRecord?.id}\n        onSelect={onSelect}\n        options={searchFilterOptions}\n        records={relatedModel.records}\n        canLoadMore={pagination.hasNextPage && options.length >= optionRecordsToLoadCount}\n        onLoadMore={pagination.loadNextPage}\n      />\n    </PolarisWCCombobox>\n  );\n});\n"]}