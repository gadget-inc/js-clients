{"version":3,"file":"PolarisWCCombobox.js","sourceRoot":"","sources":["../../../../../src/auto/polaris-wc/inputs/PolarisWCCombobox.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useId, useLayoutEffect, useRef, useState, type ReactElement, type ReactNode } from \"react\";\nimport { createRoot, type Root } from \"react-dom/client\";\nimport { PolarisWCPopover } from \"../commonComponents/PolarisWCPopover.js\";\nimport { PolarisWCTruncatedTextWithTooltip } from \"../commonComponents/PolarisWCTruncatedTextWithTooltip.js\";\n\nexport interface PolarisWCComboboxProps {\n  /**\n   * Callback fired when the bottom of the listbox is reached. Use to lazy load when listbox option data is paginated.\n   */\n  onScrolledToBottom?: () => void;\n  /**\n   * Allows more than one option to be selected\n   */\n  allowMultiple?: boolean;\n  /**\n   * Whether or not more options are available to lazy load when the bottom of the listbox is reached.\n   */\n  willLoadMoreOptions?: boolean;\n  /**\n   * Whether the field is required\n   */\n  required?: boolean;\n  /**s\n   * Label for the combobox\n   */\n  label?: ReactNode;\n  /**\n   * Placeholder text for the search input\n   */\n  placeholder?: string;\n  /**\n   * Whether the combobox is disabled\n   */\n  disabled?: boolean;\n  /**\n   * Error message to display\n   */\n  error?: string;\n  /**\n   * Vertical content to display above the text input (e.g., selected tags)\n   */\n  verticalContent?: ReactElement;\n  /**\n   * The options content to display inside the popover\n   */\n  children?: ReactNode;\n  /**\n   * Controlled input value\n   */\n  value?: string;\n  /**\n   * Callback when input value changes\n   */\n  onChange?: (value: string) => void;\n  /**\n   * Callback when the popover opens\n   */\n  onOpen?: () => void;\n  /**\n   * Callback when the popover closes\n   */\n  onClose?: () => void;\n  /**\n   * The HTML ID of the combobox\n   */\n  id?: string;\n}\n\n/**\n * A combobox component using Polaris Web Components.\n * Combines a text input with a popover dropdown for searchable option selection.\n *\n * @example\n * ```tsx\n * <PolarisWCCombobox\n *   label=\"Select an option\"\n *   placeholder=\"Search...\"\n *   onScrolledToBottom={() => loadMore()}\n * >\n *   <s-option value=\"1\">Option 1</s-option>\n *   <s-option value=\"2\">Option 2</s-option>\n * </PolarisWCCombobox>\n * ```\n */\nexport const PolarisWCCombobox = (props: PolarisWCComboboxProps) => {\n  const {\n    onScrolledToBottom,\n    allowMultiple,\n    willLoadMoreOptions,\n    required,\n    label,\n    placeholder,\n    disabled,\n    error,\n    verticalContent,\n    children,\n    value: controlledValue,\n    onChange,\n    onOpen,\n    onClose,\n    id: propId,\n  } = props;\n\n  const generatedId = useId();\n  const id = propId ?? generatedId;\n  const inputId = `${id}-input`;\n\n  const [isOpen, setIsOpen] = useState(false);\n  const [internalValue, setInternalValue] = useState(\"\");\n  const containerRef = useRef<HTMLDivElement>(null);\n  const listboxRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLElement>(null);\n  const isMouseDownInsideRef = useRef(false);\n\n  // Refs for injecting vertical content into shadow DOM\n  const verticalContentRootRef = useRef<Root | null>(null);\n  const verticalContentContainerRef = useRef<HTMLDivElement | null>(null);\n\n  const value = controlledValue !== undefined ? controlledValue : internalValue;\n\n  // HACK: Inject vertical content into the shadow DOM of s-text-field\n  // This injects the verticalContent React element into the .input-wrapper div\n  useLayoutEffect(() => {\n    const inputElement = inputRef.current;\n    if (!inputElement) return;\n\n    const setupContainer = () => {\n      const shadowRoot = inputElement.shadowRoot;\n      if (!shadowRoot) return false;\n\n      const inputWrapper = shadowRoot.querySelector(\".input-wrapper\") as HTMLDivElement;\n      if (!inputWrapper) return false;\n\n      // HACK: Apply styles to shadow DOM elements\n      inputWrapper.style.flexDirection = \"column\";\n\n      const contentDiv = inputWrapper.querySelector(\".content\") as HTMLDivElement;\n      if (contentDiv) {\n        contentDiv.style.width = \"100%\";\n        contentDiv.style.paddingBottom = \"8px\";\n      }\n\n      // Create container if it doesn't exist\n      if (!verticalContentContainerRef.current) {\n        const container = document.createElement(\"div\");\n        container.className = \"vertical-content-container\";\n        container.style.cssText = \"width: 100%; box-sizing: border-box;\";\n        inputWrapper.insertBefore(container, inputWrapper.firstChild);\n        verticalContentContainerRef.current = container;\n        verticalContentRootRef.current = createRoot(container);\n      }\n\n      return true;\n    };\n\n    // Try to set up immediately\n    if (!setupContainer()) {\n      // Shadow DOM might not be ready yet, poll for it\n      const interval = setInterval(() => {\n        if (setupContainer()) {\n          clearInterval(interval);\n          // Render after setup\n          verticalContentRootRef.current?.render(verticalContent ?? null);\n        }\n      }, 10);\n\n      return () => clearInterval(interval);\n    }\n\n    // Render the vertical content\n    verticalContentRootRef.current?.render(verticalContent ?? null);\n  }, [verticalContent]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      // Unmount the React root\n      verticalContentRootRef.current?.unmount();\n      verticalContentRootRef.current = null;\n      // Remove the container element from the shadow DOM\n      verticalContentContainerRef.current?.remove();\n      verticalContentContainerRef.current = null;\n    };\n  }, []);\n\n  // Open the dropdown\n  const openDropdown = useCallback(() => {\n    if (isOpen) return;\n    setIsOpen(true);\n    onOpen?.();\n  }, [isOpen, onOpen]);\n\n  // Close the dropdown (reason when closed by popover: escape or click-outside)\n  const closeDropdown = useCallback(\n    (reason?: \"escape\" | \"click-outside\") => {\n      if (!isOpen) return;\n      setIsOpen(false);\n      onClose?.();\n      if (reason === \"escape\") {\n        const input = inputRef.current;\n        if (input) {\n          const actualInput = input.shadowRoot?.querySelector(\"input\") || input.querySelector(\"input\");\n          actualInput?.focus();\n        }\n      }\n    },\n    [isOpen, onClose]\n  );\n\n  const handleInputChange = useCallback(\n    (event: Event) => {\n      const target = event.currentTarget as HTMLInputElement;\n      const newValue = target.value ?? \"\";\n\n      if (onChange) {\n        onChange(newValue);\n      } else {\n        setInternalValue(newValue);\n      }\n\n      // Open dropdown when typing\n      openDropdown();\n    },\n    [onChange, openDropdown]\n  );\n\n  const handleInputFocus = useCallback(() => {\n    openDropdown();\n  }, [openDropdown]);\n\n  const handleInputBlur = useCallback(\n    (event: FocusEvent) => {\n      // Don't close if clicking inside the dropdown or container\n      if (isMouseDownInsideRef.current) {\n        isMouseDownInsideRef.current = false;\n        // Refocus the input to maintain focus\n        const input = inputRef.current;\n        if (input) {\n          // Find the actual input element inside s-text-field\n          const actualInput = input.shadowRoot?.querySelector(\"input\") || input.querySelector(\"input\");\n          actualInput?.focus();\n        }\n        return;\n      }\n\n      // Check if focus is moving to something inside our container\n      const relatedTarget = event.relatedTarget as HTMLElement | null;\n      if (relatedTarget && containerRef.current?.contains(relatedTarget)) {\n        return;\n      }\n\n      // Check if focus is moving into the dropdown\n      if (relatedTarget && listboxRef.current?.contains(relatedTarget)) {\n        return;\n      }\n\n      // Close with a small delay to allow click events to fire first\n      requestAnimationFrame(() => {\n        // Double-check we're still not focused inside\n        const activeElement = document.activeElement;\n        if (containerRef.current?.contains(activeElement)) {\n          return;\n        }\n        closeDropdown();\n      });\n    },\n    [closeDropdown]\n  );\n\n  // Track mousedown to prevent blur from closing popover when clicking options\n  const handleContainerMouseDown = useCallback(() => {\n    isMouseDownInsideRef.current = true;\n  }, []);\n\n  const handleContainerMouseUp = useCallback(() => {\n    // Reset the flag after a short delay\n    requestAnimationFrame(() => {\n      isMouseDownInsideRef.current = false;\n    });\n  }, []);\n\n  // Handle scroll for infinite loading\n  const handleScroll = useCallback(() => {\n    if (!listboxRef.current || !willLoadMoreOptions || !onScrolledToBottom) {\n      return;\n    }\n\n    const { scrollTop, scrollHeight, clientHeight } = listboxRef.current;\n    const isNearBottom = scrollTop + clientHeight >= scrollHeight - 50;\n\n    if (isNearBottom) {\n      onScrolledToBottom();\n    }\n  }, [willLoadMoreOptions, onScrolledToBottom]);\n\n  // Set up scroll listener (re-run when isOpen so we attach once panel is mounted)\n  useEffect(() => {\n    const listbox = listboxRef.current;\n    if (listbox && onScrolledToBottom) {\n      listbox.addEventListener(\"scroll\", handleScroll);\n      return () => {\n        listbox.removeEventListener(\"scroll\", handleScroll);\n      };\n    }\n  }, [handleScroll, onScrolledToBottom, isOpen]);\n\n  // Set up blur listener on the input element\n  useEffect(() => {\n    const inputElement = inputRef.current;\n    if (!inputElement) return;\n\n    // The actual input is inside the shadow DOM of s-text-field\n    // We need to listen on the host element for blur events that bubble\n    inputElement.addEventListener(\"focusout\", handleInputBlur as EventListener);\n\n    return () => {\n      inputElement.removeEventListener(\"focusout\", handleInputBlur as EventListener);\n    };\n  }, [handleInputBlur]);\n\n  // Ensure label is always a string for the web component\n  const inputLabel: string = typeof label === \"string\" ? label : \"\";\n\n  const dropdownId = `${id}-listbox`;\n\n  return (\n    <div\n      ref={containerRef}\n      onMouseDown={handleContainerMouseDown}\n      onMouseUp={handleContainerMouseUp}\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        position: \"relative\",\n      }}\n    >\n      {/* Label if it's a ReactElement */}\n      {label && typeof label !== \"string\" && <div style={{ marginBottom: \"4px\" }}>{label}</div>}\n\n      {/* NOTE: verticalContent is now injected directly into the s-text-field shadow DOM */}\n\n      <PolarisWCPopover\n        open={isOpen}\n        onClose={closeDropdown}\n        anchor={\n          <s-text-field\n            ref={inputRef as any}\n            id={inputId}\n            label={inputLabel}\n            value={value}\n            placeholder={placeholder}\n            disabled={disabled}\n            required={required}\n            error={error}\n            autocomplete=\"off\"\n            onInput={handleInputChange}\n            onFocus={handleInputFocus}\n            onBlur={handleInputBlur}\n            {...({\n              \"aria-expanded\": isOpen,\n              \"aria-controls\": dropdownId,\n              \"aria-autocomplete\": \"list\",\n              role: \"combobox\",\n            } as any)}\n          />\n        }\n        contentId={dropdownId}\n        contentRef={listboxRef}\n        contentProps={{\n          role: \"listbox\",\n          ...(allowMultiple && { \"aria-multiselectable\": true }),\n        }}\n      >\n        {children}\n      </PolarisWCPopover>\n    </div>\n  );\n};\n\nexport interface PolarisWCComboboxOptionProps {\n  /** Display text for the option (must be a string). */\n  text: string;\n  /** Whether this option is selected. */\n  selected?: boolean;\n  /** Callback when the option is clicked. */\n  onClick?: () => void;\n  /** When true, shows a checkbox to indicate selected state instead of only background color. */\n  multiselect?: boolean;\n}\n\n/**\n * A clickable option row for use inside PolarisWCCombobox listbox.\n * Use `text` for the label and set `multiselect` when the combobox allows multiple selection.\n */\nexport const PolarisWCComboboxOption = ({ text, selected, onClick, multiselect }: PolarisWCComboboxOptionProps) => (\n  <div\n    role=\"option\"\n    aria-selected={selected}\n    onClick={onClick}\n    style={{\n      display: \"flex\",\n      alignItems: \"center\",\n      gap: \"8px\",\n      padding: \"8px 12px\",\n      cursor: \"pointer\",\n      fontSize: \"14px\",\n      lineHeight: \"20px\",\n      backgroundColor: !multiselect && selected ? \"var(--p-color-bg-surface-selected, #f1f2f4)\" : \"transparent\",\n      color: \"var(--p-color-text, #1a1a1a)\",\n    }}\n    onMouseEnter={(e) => {\n      e.currentTarget.style.backgroundColor = \"var(--p-color-bg-surface-hover, #f7f7f7)\";\n    }}\n    onMouseLeave={(e) => {\n      e.currentTarget.style.backgroundColor = !multiselect && selected ? \"var(--p-color-bg-surface-selected, #f1f2f4)\" : \"transparent\";\n    }}\n  >\n    {multiselect && <s-checkbox checked={selected}></s-checkbox>}\n    <PolarisWCTruncatedTextWithTooltip text={text} />\n  </div>\n);\n"]}