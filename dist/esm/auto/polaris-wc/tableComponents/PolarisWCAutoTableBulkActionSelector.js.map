{"version":3,"file":"PolarisWCAutoTableBulkActionSelector.js","sourceRoot":"","sources":["../../../../../src/auto/polaris-wc/tableComponents/PolarisWCAutoTableBulkActionSelector.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { GadgetRecord } from \"@gadgetinc/core\";\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport type { TableRow } from \"../../../use-table/types.js\";\nimport type { RecordSelection } from \"../../../useSelectedRecordsController.js\";\nimport { getBulkActionOptionCallback, type BulkActionOption } from \"../../hooks/useTableBulkActions.js\";\nimport { PolarisWCPopover } from \"../commonComponents/PolarisWCPopover.js\";\n\nconst MORE_ACTIONS_LABEL = \"Actions...\";\n\nfunction PolarisWCBulkActionButton(props: {\n  action: BulkActionOption;\n  selectedRows: TableRow[];\n  clearSelection: () => void;\n  rawRecords: GadgetRecord<any>[] | null;\n}) {\n  const { action, selectedRows, clearSelection, rawRecords } = props;\n  const ref = useRef<HTMLElement>(null);\n  const onAction = getBulkActionOptionCallback({\n    option: action,\n    selectedRows,\n    clearSelection,\n    rawRecords,\n  });\n\n  const destructive = \"isDeleter\" in action ? action.isDeleter : false;\n  return (\n    <s-button ref={ref as any} variant={\"secondary\"} tone={destructive ? \"critical\" : \"neutral\"} onClick={onAction}>\n      {action.humanizedName}\n    </s-button>\n  );\n}\n\nfunction PolarisWCMoreActionsTrigger(props: { open: boolean; onToggle: () => void }) {\n  const { open, onToggle } = props;\n  const ref = useRef<HTMLElement>(null);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) return;\n    el.addEventListener(\"click\", onToggle);\n    return () => el.removeEventListener(\"click\", onToggle);\n  }, [onToggle]);\n\n  return (\n    <s-button ref={ref as any} variant=\"secondary\" aria-expanded={open} aria-label={MORE_ACTIONS_LABEL}>\n      {MORE_ACTIONS_LABEL}\n    </s-button>\n  );\n}\n\nfunction NonPromotedActionsDropdown(props: {\n  nonPromotedActions: BulkActionOption[];\n  selection: RecordSelection;\n  rows: TableRow[];\n  rawRecords: GadgetRecord<any>[] | null;\n}) {\n  const { nonPromotedActions, selection, rows, rawRecords } = props;\n  const selectedRows = rows.filter((row) => selection.recordIds.includes(row.id as string));\n  const [open, setOpen] = useState(false);\n\n  if (nonPromotedActions.length === 0) {\n    return null;\n  }\n\n  return (\n    <PolarisWCPopover\n      open={open}\n      onClose={() => setOpen(false)}\n      anchor={<PolarisWCMoreActionsTrigger open={open} onToggle={() => setOpen((prev) => !prev)} />}\n      contentProps={{ style: { minWidth: \"260px\" } }}\n      position=\"below-end\"\n    >\n      <div style={{ display: \"flex\", flexDirection: \"column\", minWidth: \"260px\" }}>\n        {nonPromotedActions.map((action) => (\n          <NonPromotedActionItem\n            key={action.humanizedName}\n            action={action}\n            selectedRows={selectedRows}\n            clearSelection={selection.clearAll}\n            rawRecords={rawRecords}\n            onSelect={() => {\n              setOpen(false);\n              const callback = getBulkActionOptionCallback({\n                option: action,\n                selectedRows,\n                clearSelection: selection.clearAll,\n                rawRecords,\n              });\n            }}\n          />\n        ))}\n      </div>\n    </PolarisWCPopover>\n  );\n}\n\nfunction NonPromotedActionItem(props: {\n  action: BulkActionOption;\n  selectedRows: TableRow[];\n  clearSelection: () => void;\n  rawRecords: GadgetRecord<any>[] | null;\n  onSelect: () => void;\n}) {\n  const { action, selectedRows, clearSelection, rawRecords, onSelect } = props;\n  const callback = getBulkActionOptionCallback({\n    option: action,\n    selectedRows,\n    clearSelection,\n    rawRecords,\n  });\n\n  const handleClick = () => {\n    callback();\n    onSelect();\n  };\n\n  return (\n    <button\n      type=\"button\"\n      onClick={handleClick}\n      style={{\n        display: \"block\",\n        width: \"100%\",\n        padding: \"8px 12px\",\n        textAlign: \"left\",\n        border: \"none\",\n        background: \"transparent\",\n        cursor: \"pointer\",\n        fontSize: \"14px\",\n        color: \"var(--p-color-text, #202223)\",\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = \"var(--p-color-bg-surface-hover, #f6f6f7)\";\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = \"transparent\";\n      }}\n    >\n      {action.humanizedName}\n    </button>\n  );\n}\n\nexport function PolarisWCAutoTableBulkActionSelector(props: {\n  bulkActionOptions: BulkActionOption[];\n  selection: RecordSelection;\n  rows: TableRow[];\n  rawRecords: GadgetRecord<any>[] | null;\n}) {\n  const { bulkActionOptions, selection, rows, rawRecords } = props;\n  const selectedRows = rows.filter((row) => selection.recordIds.includes(row.id as string));\n\n  const { promotedActions, nonPromotedActions } = useMemo(() => {\n    const promoted: BulkActionOption[] = [];\n    const nonPromoted: BulkActionOption[] = [];\n    for (const option of bulkActionOptions) {\n      if (option.promoted) {\n        promoted.push(option);\n      } else {\n        nonPromoted.push(option);\n      }\n    }\n    return { promotedActions: promoted, nonPromotedActions: nonPromoted };\n  }, [bulkActionOptions]);\n\n  return (\n    <>\n      {promotedActions.map((action) => (\n        <PolarisWCBulkActionButton\n          key={action.humanizedName}\n          action={action}\n          selectedRows={selectedRows}\n          clearSelection={selection.clearAll}\n          rawRecords={rawRecords}\n        />\n      ))}\n      <NonPromotedActionsDropdown nonPromotedActions={nonPromotedActions} selection={selection} rows={rows} rawRecords={rawRecords} />\n    </>\n  );\n}\n"]}