{"version":3,"file":"AutoFormActionValidators.js","sourceRoot":"","sources":["../../../src/auto/AutoFormActionValidators.ts"],"names":[],"mappings":"AAIA,MAAM,CAAC,MAAM,qBAAqB,GAAG,CAAC,MAA2E,EAAE,EAAE;IACnH,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;QAClB,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;IACjE,CAAC;AACH,CAAC,CAAC;AAEF,MAAM,sBAAsB,GAAG,4BAA4B,CAAC;AAE5D,MAAM,CAAC,MAAM,6BAA6B,GAAG,+CAA+C,CAAC;AAC7F,MAAM,CAAC,MAAM,yBAAyB,GAAG,uCAAuC,CAAC;AACjF,MAAM,CAAC,MAAM,6BAA6B,GAAG,yDAAyD,CAAC;AAEvG,MAAM,gBAAgB,GAAG,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;AAEpD,MAAM,CAAC,MAAM,6BAA6B,GAAG,CAAC,MAA2E,EAAE,EAAE;IAC3H,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC;QAC5C,wGAAwG;QACxG,qHAAqH;QACrH,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;IACjD,CAAC;AACH,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,qBAAqB,GAAG,CAAC,KAAwC,EAAE,EAAE;IAChF,IAAI,CAAC,CAAC,QAAQ,IAAI,KAAK,CAAC,EAAE,CAAC;QACzB,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;IACjD,CAAC;IAED,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QAClB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;IAC7C,CAAC;IAED,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;QACnB,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;YAClB,MAAM,IAAI,KAAK,CAAC,iEAAiE,CAAC,CAAC;QACrF,CAAC;QACD,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;YAClB,MAAM,IAAI,KAAK,CAAC,iEAAiE,CAAC,CAAC;QACrF,CAAC;IACH,CAAC;AACH,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,4BAA4B,GAAG,CAAC,QAAgD,EAAE,EAAE;IAC/F,IAAI,QAAQ,EAAE,CAAC;QACb,8KAA8K;QAE9K,MAAM,eAAe,GACnB,CAAC,QAAQ,CAAC,UAAU,KAAK,oBAAoB;YAC3C,CAAC,CAAC,QAAQ,CAAC,QAAQ;YACnB,CAAC,CAAC,QAAQ,CAAC,UAAU,KAAK,aAAa;gBACvC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ;gBAC1B,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;QAEhB,MAAM,aAAa,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,MAAM,KAAK,sBAAsB,CAAC,CAAC;QACnG,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;QACjD,CAAC;IACH,CAAC;AACH,CAAC,CAAC","sourcesContent":["import type { ActionFunction, GlobalActionFunction } from \"@gadgetinc/api-client-core\";\nimport type { ActionMetadata, GlobalActionMetadata } from \"../metadata.js\";\nimport type { useAutoForm } from \"./AutoForm.js\";\n\nexport const validateNonBulkAction = (action: ActionFunction<any, any, any, any, any> | GlobalActionFunction<any>) => {\n  if (action.isBulk) {\n    throw new Error(\"Bulk actions are not supported in AutoForms\");\n  }\n};\n\nconst GadgetApiTriggerSpecId = \"gadget/trigger/graphql_api\";\n\nexport const MissingActionPropErrorMessage = \"Specify a valid Gagdet action to use AutoForm\";\nexport const InvalidActionErrorMessage = `\"action\" is not a valid Gadget action`;\nexport const MissingApiTriggerErrorMessage = `\"action\" requires an API trigger to be used in AutoForm`;\n\nconst validActionTypes = [\"globalAction\", \"action\"];\n\nexport const validateTriggersFromApiClient = (action: ActionFunction<any, any, any, any, any> | GlobalActionFunction<any>) => {\n  if (!validActionTypes.includes(action.type)) {\n    // When the API client is built with an action without the API trigger, the type will be \"stubbedAction\"\n    // action.type === \"globalAction\" | \"action\" // Only when the action has the API trigger when the api client is built\n    throw new Error(MissingApiTriggerErrorMessage);\n  }\n};\n\nexport const validateAutoFormProps = (props: Parameters<typeof useAutoForm>[0]) => {\n  if (!(\"action\" in props)) {\n    throw new Error(MissingActionPropErrorMessage);\n  }\n\n  if (!props.action) {\n    throw new Error(InvalidActionErrorMessage);\n  }\n\n  if (props.children) {\n    if (props.include) {\n      throw new Error(`AutoForm components with children cannot use the include option`);\n    }\n    if (props.exclude) {\n      throw new Error(`AutoForm components with children cannot use the exclude option`);\n    }\n  }\n};\n\nexport const validateTriggersFromMetadata = (metadata?: ActionMetadata | GlobalActionMetadata) => {\n  if (metadata) {\n    // When an action's API trigger is removed but the referenced API client still uses the old api-triggered action, the presence of the trigger shall be checked in the metadata\n\n    const triggersAsArray =\n      (metadata.__typename === \"GadgetGlobalAction\"\n        ? metadata.triggers\n        : metadata.__typename === \"GadgetModel\"\n        ? metadata.action.triggers\n        : []) ?? [];\n\n    const hasApiTrigger = triggersAsArray.some((trigger) => trigger.specID === GadgetApiTriggerSpecId);\n    if (!hasApiTrigger) {\n      throw new Error(MissingApiTriggerErrorMessage);\n    }\n  }\n};\n"]}