{"version":3,"file":"useEnumInputController.js","sourceRoot":"","sources":["../../../../src/auto/hooks/useEnumInputController.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { GadgetFieldType } from \"../../internal/gql/graphql.js\";\nimport { useController } from \"../../useActionForm.js\";\nimport { type AutoEnumInputProps } from \"../shared/AutoInputTypes.js\";\nimport { useFieldMetadata } from \"./useFieldMetadata.js\";\nimport { assertFieldType } from \"./utils.js\";\n\nexport const useEnumInputController = (props: AutoEnumInputProps) => {\n  const { field: fieldApiIdentifier, control } = props;\n  const { path, metadata } = useFieldMetadata(fieldApiIdentifier);\n  assertFieldType({\n    fieldApiIdentifier,\n    actualFieldType: metadata.fieldType,\n    expectedFieldType: GadgetFieldType.Enum,\n  });\n\n  const config = metadata.configuration;\n  if (config.__typename !== \"GadgetEnumConfig\") {\n    throw new Error(\"Field is not an enum type\");\n  }\n\n  const {\n    field: fieldProps,\n    fieldState: { error },\n  } = useController({\n    control,\n    name: path,\n  });\n  const [searchValue, setSearchValue] = useState(\"\");\n\n  const selectedOptions = useMemo(\n    () => (typeof fieldProps.value === \"string\" ? [fieldProps.value] : (fieldProps.value ?? [])) as string[],\n    [fieldProps.value]\n  );\n  const providedOptions = useMemo(() => config.options.map((option) => option.name), [config.options]);\n  const allOptions = useMemo(() => [...new Set([...selectedOptions, ...providedOptions])], [providedOptions, selectedOptions]);\n  const filteredOptions = useMemo(\n    () =>\n      allOptions.filter((option) => {\n        return !searchValue || option.toLocaleLowerCase().includes(searchValue.trim().toLocaleLowerCase());\n      }),\n    [allOptions, searchValue]\n  );\n\n  const onChange = useCallback(\n    (...args: any[]) => {\n      fieldProps.onChange(...args);\n      props.afterChange?.(...args);\n    },\n    [fieldProps.onChange, props.afterChange]\n  );\n\n  const onSelectionChange = useCallback(\n    (selected: string | null) => {\n      setSearchValue(\"\");\n      if (config.allowMultiple) {\n        if (selected === null) {\n          onChange([]);\n          return;\n        }\n\n        const nextSelectedTags = new Set([...selectedOptions]);\n        if (nextSelectedTags.has(selected)) {\n          nextSelectedTags.delete(selected);\n        } else {\n          nextSelectedTags.add(selected);\n        }\n\n        onChange([...nextSelectedTags]);\n      } else {\n        if (selected === null || selectedOptions.includes(selected)) {\n          onChange(null);\n        } else {\n          onChange(selected);\n        }\n      }\n    },\n    [config.allowMultiple, onChange, selectedOptions]\n  );\n\n  return {\n    path,\n    allowMultiple: config.allowMultiple,\n    allowOther: config.allowOther,\n    /** The list of selected options. */\n    selectedOptions,\n    /** The list of options that are provided by the configuration. */\n    providedOptions,\n    /** The list of options that are currently visible based on the search query. */\n    filteredOptions,\n    /** The list of all options that are available to select by combining the selected and provided options. */\n    allOptions,\n    searchQuery: {\n      value: searchValue,\n      setValue: setSearchValue,\n    },\n    /** The callback to handle the selection change */\n    onSelectionChange,\n    label: metadata.name,\n    metadata,\n    fieldProps,\n    isError: !!error,\n    errorMessage: error?.message,\n  };\n};\n"]}