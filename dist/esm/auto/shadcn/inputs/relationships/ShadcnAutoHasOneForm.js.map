{"version":3,"file":"ShadcnAutoHasOneForm.js","sourceRoot":"","sources":["../../../../../../src/auto/shadcn/inputs/relationships/ShadcnAutoHasOneForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import { PlusCircleIcon } from \"lucide-react\";\nimport React, { useCallback } from \"react\";\nimport { useHasOneForm } from \"../../../../useHasOneForm.js\";\nimport { autoRelationshipForm } from \"../../../AutoInput.js\";\nimport { RelationshipContext } from \"../../../hooks/useAutoRelationship.js\";\nimport type { OptionLabel } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport type { ShadcnElements } from \"../../elements.js\";\nimport { makeShadcnRenderOptionLabel } from \"../../utils.js\";\nimport { makeSearchableSingleRelatedModelRecordSelector } from \"./SearchableSingleRelatedModelRecordSelector.js\";\n\nexport const makeShadcnAutoHasOneForm = ({\n  Badge,\n  Button,\n  Command,\n  CommandItem,\n  CommandInput,\n  CommandLoading,\n  Label,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  Checkbox,\n  ScrollArea,\n  Accordion,\n  AccordionItem,\n  AccordionTrigger,\n}: Pick<\n  ShadcnElements,\n  | \"Badge\"\n  | \"Button\"\n  | \"Command\"\n  | \"CommandItem\"\n  | \"CommandInput\"\n  | \"CommandLoading\"\n  | \"Label\"\n  | \"CommandList\"\n  | \"CommandEmpty\"\n  | \"CommandGroup\"\n  | \"Checkbox\"\n  | \"ScrollArea\"\n  | \"Accordion\"\n  | \"AccordionItem\"\n  | \"AccordionTrigger\"\n>) => {\n  const renderOptionLabel = makeShadcnRenderOptionLabel({ Label, Badge, Button });\n\n  const SearchableSingleRelatedModelRecordSelector = makeSearchableSingleRelatedModelRecordSelector({\n    Command,\n    CommandItem,\n    CommandInput,\n    CommandLoading,\n    Label,\n    CommandList,\n    CommandEmpty,\n    CommandGroup,\n    Checkbox,\n    ScrollArea,\n  });\n\n  function ShadcnHasOneForm(props: {\n    field: string;\n    children: React.ReactNode;\n    primaryLabel?: OptionLabel;\n    secondaryLabel?: OptionLabel;\n    tertiaryLabel?: OptionLabel;\n  }) {\n    const { field } = props;\n    const form = useHasOneForm(props);\n    const {\n      record,\n      isEditing,\n      setIsEditing,\n      pathPrefix,\n      metaDataPathPrefix,\n      hasRecord,\n      recordOption,\n      isCreatingRecord,\n      confirmEdit,\n      removeRecord,\n      relatedModelName,\n    } = form;\n\n    const clickConfirmEdit = useCallback(\n      (e: React.MouseEvent<HTMLButtonElement>) => {\n        e.preventDefault();\n        e.stopPropagation();\n        confirmEdit();\n      },\n      [confirmEdit]\n    );\n\n    const clickRemoveRecord = useCallback(\n      (e: React.MouseEvent<HTMLButtonElement>) => {\n        e.preventDefault();\n        e.stopPropagation();\n        removeRecord();\n      },\n      [removeRecord]\n    );\n\n    return (\n      <RelationshipContext.Provider\n        value={{ transformPath: (path) => pathPrefix + \".\" + path, transformMetadataPath: (path) => metaDataPathPrefix + \".\" + path }}\n      >\n        <div>\n          <div className=\"flex flex-row justify-between items-center\">\n            <h2 className=\"text-lg font-medium\">{relatedModelName}</h2>\n          </div>\n          {hasRecord || isCreatingRecord ? (\n            <Accordion type=\"single\" collapsible className=\"w-full\">\n              {!isEditing ? (\n                <AccordionItem value={`${pathPrefix}.${record?.id ? `update-${record.id}` : `create`}`}>\n                  <AccordionTrigger\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setIsEditing(true);\n                    }}\n                  >\n                    <div className=\"flex justify-between w-full items-center\">\n                      <div className=\"flex flex-col gap-1 items-start\">\n                        {recordOption?.label && renderOptionLabel(recordOption?.label, \"primary\")}\n                        {recordOption?.secondaryLabel && renderOptionLabel(recordOption?.secondaryLabel, \"secondary\")}\n                      </div>\n\n                      {recordOption?.tertiaryLabel && (\n                        <div className=\"flex items-center\">{renderOptionLabel(recordOption?.tertiaryLabel, \"tertiary\")}</div>\n                      )}\n                    </div>\n                  </AccordionTrigger>\n                </AccordionItem>\n              ) : (\n                <>\n                  <div className=\"border border-gray-300 rounded-md p-3\">\n                    {props.children}\n                    <div className=\"flex justify-between p-4\">\n                      <Button variant=\"destructive\" id={`deleteButton_${metaDataPathPrefix}`} onClick={clickRemoveRecord}>\n                        Remove\n                      </Button>\n                      <Button variant=\"default\" type=\"button\" id={`confirmButton_${metaDataPathPrefix}`} onClick={clickConfirmEdit}>\n                        Confirm\n                      </Button>\n                    </div>\n                  </div>\n                </>\n              )}\n            </Accordion>\n          ) : (\n            <>\n              <EmptyFormComponent form={form} field={field} />\n            </>\n          )}\n        </div>\n      </RelationshipContext.Provider>\n    );\n  }\n\n  function EmptyFormComponent(props: { field: string; form: ReturnType<typeof useHasOneForm> }) {\n    const { field, form } = props;\n\n    if (canSelectExistingRecord) {\n      return <SearchableSingleRelatedModelRecordSelector field={field} form={form} override={{ addNewRecord: form.startCreatingRecord }} />;\n    }\n    return <CreateNewChildButton form={form} />;\n  }\n\n  function CreateNewChildButton(props: { form: ReturnType<typeof useHasOneForm> }) {\n    const { startCreatingRecord, relatedModelName } = props.form;\n    return (\n      <>\n        <Button\n          type=\"button\"\n          variant=\"default\"\n          className=\"flex gap-1 border border-gray-300 rounded-md p-2 cursor-pointer\"\n          onClick={startCreatingRecord}\n        >\n          <PlusCircleIcon className=\"w-4 h-4\" />\n          <Label className=\"text-sm font-semibold\">Add {relatedModelName}</Label>\n        </Button>\n      </>\n    );\n  }\n\n  return autoRelationshipForm(ShadcnHasOneForm);\n};\n\n/**\n * TODO - If this gets enabled fix this:\n *    - Workflow\n *      - existingSelectedRecord\n *      - removeSelection\n *      - reselectTheSameRecordInDropdown\n *      - removeSelection\n *      - send\n *    - Right now, this workflow sends null as the hasOne field value, which does nothing. It should be _unlink\n */\nconst canSelectExistingRecord = false;\n"]}