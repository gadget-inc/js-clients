{"version":3,"file":"SearchableSingleRelatedModelRecordSelector.js","sourceRoot":"","sources":["../../../../../../src/auto/shadcn/inputs/relationships/SearchableSingleRelatedModelRecordSelector.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,MAAM,CAAC;AACxC,OAAO,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AACxC,OAAO,EAAE,OAAO,IAAI,KAAK,EAAE,WAAW,EAAE,MAAM,OAAO,CAAC;AAEtD,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAChD,OAAO,EAAE,wBAAwB,EAAE,MAAM,mCAAmC,CAAC;AAE7E,OAAO,EAAE,wBAAwB,EAAE,MAAM,4BAA4B,CAAC;AAEtE,MAAM,CAAC,MAAM,8CAA8C,GAAG,CAAC,EAC7D,OAAO,EACP,WAAW,EACX,YAAY,EACZ,cAAc,EACd,KAAK,EACL,WAAW,EACX,YAAY,EACZ,YAAY,EACZ,QAAQ,EACR,UAAU,GAaX,EAAE,EAAE;IACH,MAAM,gBAAgB,GAAG,wBAAwB,CAAC;QAChD,OAAO;QACP,YAAY;QACZ,KAAK;QACL,WAAW;QACX,WAAW;QACX,YAAY;QACZ,cAAc;QACd,YAAY;QACZ,QAAQ;QACR,UAAU;KACX,CAAC,CAAC;IAEH,SAAS,0CAA0C,CAAC,KAMnD;QACC,MAAM,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC;QACxB,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,IAAI,EAAE,QAAQ,EAAE,YAAY,EAAE,GAC7H,KAAK,CAAC,IAAI,CAAC;QAEb,MAAM,sBAAsB,GAAG,WAAW,CACxC,QAAQ,CAAC,GAAG,EAAE;YACZ,IAAI,UAAU,CAAC,WAAW,IAAI,mBAAmB,CAAC,MAAM,IAAI,wBAAwB,EAAE,CAAC;gBACrF,UAAU,CAAC,YAAY,EAAE,CAAC;YAC5B,CAAC;QACH,CAAC,EAAE,GAAG,CAAC,EACP,CAAC,UAAU,EAAE,mBAAmB,CAAC,MAAM,CAAC,CACzC,CAAC;QAEF,OAAO,CACL,oBAAC,gBAAgB,IACf,iBAAiB,EAAE,IAAI,EACvB,IAAI,EAAE,IAAI,EACV,SAAS,QACT,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,KAAK,EACZ,OAAO,EAAE,mBAAmB,EAC5B,QAAQ,EAAE,CAAC,MAAM,EAAE,EAAE;gBACnB,QAAQ,CAAC,IAAI,EAAE,EAAE,GAAG,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC;YAClD,CAAC,EACD,SAAS,EAAE,SAAS,EACpB,YAAY,EAAE,EAAE,EAChB,OAAO,EAAE;gBACP,oBAAC,YAAY,IAAC,GAAG,EAAE,YAAY;oBAC7B,oBAAC,WAAW,IACV,QAAQ,EAAE,GAAG,EAAE;4BACb,KAAK,CAAC,QAAQ,EAAE,YAAY,EAAE,EAAE,IAAI,YAAY,CAAC,IAAI,CAAC,CAAC;wBACzD,CAAC;wBAED,6BAAK,SAAS,EAAC,kCAAkC;4BAC/C,oBAAC,QAAQ,IAAC,SAAS,EAAC,SAAS,GAAG;;4BAC3B,gBAAgB,CACjB,CACM;oBACd,oBAAC,gBAAgB,OAAG,CACP;aAChB,EACD,OAAO,EAAE,OAAO,EAChB,aAAa,EAAE,GAAG,EAAE,CAAC,KAAK,EAC1B,aAAa,EAAE,KAAK,EACpB,mBAAmB,EAAE,UAAU,CAAC,WAAW,IAAI,mBAAmB,CAAC,MAAM,IAAI,wBAAwB,EACrG,kBAAkB,EAAE,sBAAsB,EAC1C,QAAQ,EAAE,MAAM,CAAC,GAAG,EACpB,YAAY,EAAE,MAAM,CAAC,KAAK,GAC1B,CACH,CAAC;IACJ,CAAC;IAED,OAAO,0CAA0C,CAAC;AACpD,CAAC,CAAC","sourcesContent":["import { CommandSeparator } from \"cmdk\";\nimport { PlusIcon } from \"lucide-react\";\nimport { default as React, useCallback } from \"react\";\nimport { type useSingleRelatedRecordRelationshipForm } from \"src/useSingleRelatedRecordRelationshipForm.js\";\nimport { debounce } from \"../../../../utils.js\";\nimport { optionRecordsToLoadCount } from \"../../../hooks/useRelatedModel.js\";\nimport type { ShadcnElements } from \"../../elements.js\";\nimport { makeShadcnAutoComboInput } from \"../ShadcnAutoComboInput.js\";\n\nexport const makeSearchableSingleRelatedModelRecordSelector = ({\n  Command,\n  CommandItem,\n  CommandInput,\n  CommandLoading,\n  Label,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  Checkbox,\n  ScrollArea,\n}: Pick<\n  ShadcnElements,\n  | \"Command\"\n  | \"CommandItem\"\n  | \"CommandInput\"\n  | \"CommandLoading\"\n  | \"Label\"\n  | \"CommandList\"\n  | \"CommandEmpty\"\n  | \"CommandGroup\"\n  | \"Checkbox\"\n  | \"ScrollArea\"\n>) => {\n  const ShadcnComboInput = makeShadcnAutoComboInput({\n    Command,\n    CommandInput,\n    Label,\n    CommandItem,\n    CommandList,\n    CommandEmpty,\n    CommandLoading,\n    CommandGroup,\n    Checkbox,\n    ScrollArea,\n  });\n\n  function SearchableSingleRelatedModelRecordSelector(props: {\n    form: ReturnType<typeof useSingleRelatedRecordRelationshipForm>;\n    field: string;\n    override?: {\n      addNewRecord?: () => void;\n    };\n  }) {\n    const { field } = props;\n    const { search, metadata, pagination, records, isLoading, searchFilterOptions, relatedModelName, path, setValue, setIsEditing } =\n      props.form;\n\n    const handleScrolledToBottom = useCallback(\n      debounce(() => {\n        if (pagination.hasNextPage && searchFilterOptions.length >= optionRecordsToLoadCount) {\n          pagination.loadNextPage();\n        }\n      }, 300),\n      [pagination, searchFilterOptions.length]\n    );\n\n    return (\n      <ShadcnComboInput\n        selectedRecordTag={null}\n        path={path}\n        hideLabel\n        metadata={metadata}\n        field={field}\n        options={searchFilterOptions}\n        onSelect={(record) => {\n          setValue(path, { ...record, _link: record.id });\n        }}\n        isLoading={isLoading}\n        errorMessage={\"\"}\n        actions={[\n          <CommandGroup key={\"add-record\"}>\n            <CommandItem\n              onSelect={() => {\n                props.override?.addNewRecord?.() ?? setIsEditing(true);\n              }}\n            >\n              <div className=\"flex flex-row items-center gap-2\">\n                <PlusIcon className=\"w-4 h-4\" />\n                Add {relatedModelName}\n              </div>\n            </CommandItem>\n            <CommandSeparator />\n          </CommandGroup>,\n        ]}\n        records={records}\n        checkSelected={() => false}\n        allowMultiple={false}\n        willLoadMoreOptions={pagination.hasNextPage && searchFilterOptions.length >= optionRecordsToLoadCount}\n        onScrolledToBottom={handleScrolledToBottom}\n        onChange={search.set}\n        defaultValue={search.value}\n      />\n    );\n  }\n\n  return SearchableSingleRelatedModelRecordSelector;\n};\n"]}