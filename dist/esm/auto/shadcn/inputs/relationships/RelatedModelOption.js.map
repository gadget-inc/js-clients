{"version":3,"file":"RelatedModelOption.js","sourceRoot":"","sources":["../../../../../../src/auto/shadcn/inputs/relationships/RelatedModelOption.tsx"],"names":[],"mappings":"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","sourcesContent":["import { LoaderIcon } from \"lucide-react\";\nimport React, { useEffect, useMemo, useRef } from \"react\";\nimport type { DisplayedRecordOption } from \"../../../interfaces/AutoRelationshipInputProps.js\";\nimport type { ShadcnElements } from \"../../elements.js\";\nimport { makeShadcnListMessages } from \"./ShadcnListMessages.js\";\n\nexport type RelatedModelOptionsProps = {\n  options: DisplayedRecordOption[];\n  records?: Record<string, any>[];\n  isLoading?: boolean;\n  errorMessage?: string;\n  checkSelected?: (id: string) => boolean;\n  onSelect: (record: Record<string, any>) => void;\n  actions?: React.ReactNode[];\n  renderOption?: (option: DisplayedRecordOption) => React.ReactNode;\n  allowMultiple?: boolean;\n  allowOther?: boolean;\n  searchValue?: string;\n  onAddExtraOption?: (value: string) => void;\n  formatOptionText?: (option: string) => React.ReactNode;\n  setSearchValue?: (value: string) => void;\n  emptyMessage?: string;\n  canLoadMore?: boolean;\n  onLoadMore?: () => void;\n};\n\nexport const makeRelatedModelOption = (\n  elements: Pick<ShadcnElements, \"CommandItem\" | \"CommandList\" | \"CommandEmpty\" | \"CommandGroup\" | \"Checkbox\" | \"Label\">\n) => {\n  const { CommandList, CommandEmpty, CommandGroup, CommandItem } = elements;\n\n  function RelatedModelOption(props: RelatedModelOptionsProps) {\n    const { checkSelected, onSelect, isLoading, errorMessage, options, records, actions } = props;\n\n    const { NoRecordsMessage, ShadcnSelectableOption, getErrorMessage, AddExtraOption } = makeShadcnListMessages(elements);\n\n    const listBoxOptions = useMemo(\n      () => [\n        ...(actions ?? []),\n        ...options.map((option) => {\n          return props.renderOption ? (\n            props.renderOption(option)\n          ) : (\n            <ShadcnSelectableOption\n              {...option}\n              label={option.primary}\n              selected={checkSelected?.(option.id) ?? false}\n              allowMultiple={props.allowMultiple}\n              onSelect={(id) => {\n                const record = records?.find((record) => record.id === id) ?? { id };\n                const { createdAt: _createdAt, updatedAt: _updatedAt, ...recordWithoutTimestamps } = record;\n                onSelect(recordWithoutTimestamps);\n              }}\n              key={option.id}\n            />\n          );\n        }),\n      ],\n      [actions, options, props.renderOption, records, checkSelected, onSelect]\n    );\n\n    const loadMoreRef = useRef<HTMLDivElement | null>(null);\n    useDetectScrolledToBottom({ loadMoreRef, onLoadMore: props.onLoadMore });\n\n    return (\n      <CommandList className=\"absolute top-full w-full bg-background border shadow-md rounded-md z-50\">\n        {isLoading && <CommandEmpty>Loading...</CommandEmpty>}\n        {listBoxOptions.length > 0 ? <CommandGroup>{listBoxOptions}</CommandGroup> : null}\n        {props.allowOther && props.searchValue && (\n          <AddExtraOption\n            message={`Add \"${props.searchValue}\"`}\n            onSelect={() => {\n              props.onAddExtraOption?.(props.searchValue ?? \"\");\n              props.setSearchValue?.(\"\");\n            }}\n          />\n        )}\n        {errorMessage ? (\n          <NoRecordsMessage message={getErrorMessage(errorMessage)} />\n        ) : (\n          !isLoading && <NoRecordsMessage message={props.emptyMessage ?? undefined} />\n        )}\n        {props.canLoadMore && (\n          <CommandItem\n            ref={loadMoreRef}\n            key=\"intersection-trigger\"\n            className=\"p-1 w-full flex items-center justify-center intersection-trigger\"\n          >\n            <LoaderIcon className=\"w-4 h-4 animate-spin\" />\n          </CommandItem>\n        )}\n      </CommandList>\n    );\n  }\n\n  RelatedModelOption.displayName = \"RelatedModelOption\";\n\n  return { RelatedModelOption };\n};\n\nconst useDetectScrolledToBottom = (props: { loadMoreRef: React.RefObject<HTMLDivElement | null>; onLoadMore?: () => void }) => {\n  const { loadMoreRef } = props;\n  useEffect(() => {\n    if (!loadMoreRef?.current) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const [entry] = entries;\n        if (entry.isIntersecting) {\n          props.onLoadMore?.();\n        }\n      },\n      {\n        root: null, // null to use viewport as root\n        threshold: 1,\n      }\n    );\n\n    observer.observe(loadMoreRef.current);\n\n    return () => observer.disconnect();\n  }, [props, loadMoreRef, props.onLoadMore]);\n};\n"]}